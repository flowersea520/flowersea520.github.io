

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="flowersea">
  <meta name="keywords" content="">
  
    <meta name="description" content="瑞吉外卖开发笔记 一软件开发流程 角色分工 软件环境 2、瑞奇外卖项目介绍项目介绍 产品原型展示 技术选型 功能架构 角色 3、环境搭建数据库环境搭建 创建数据库 执行SQL脚本 数据表  maven项目搭建 解决IDEA加载maven工程缓慢VM Options:-DarchetypeCatalog&#x3D;local 添加依赖: 1234567891011121314151617181920">
<meta property="og:type" content="article">
<meta property="og:title" content="麦吉外卖笔记day01-03">
<meta property="og:url" content="http://example.com/2022/08/03/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0%20day1-3/index.html">
<meta property="og:site_name" content="flowersea">
<meta property="og:description" content="瑞吉外卖开发笔记 一软件开发流程 角色分工 软件环境 2、瑞奇外卖项目介绍项目介绍 产品原型展示 技术选型 功能架构 角色 3、环境搭建数据库环境搭建 创建数据库 执行SQL脚本 数据表  maven项目搭建 解决IDEA加载maven工程缓慢VM Options:-DarchetypeCatalog&#x3D;local 添加依赖: 1234567891011121314151617181920">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030026538.jpg">
<meta property="article:published_time" content="2022-08-02T16:53:00.000Z">
<meta property="article:modified_time" content="2022-08-10T05:21:27.416Z">
<meta property="article:author" content="flowersea">
<meta property="article:tag" content="麦吉项目">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030026538.jpg">
  
  
  
  <title>麦吉外卖笔记day01-03 - flowersea</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"uJ813FraAgdWfO9A0C4tCk8w-gzGzoHsz","app_key":"tGt6nPWqmrHkVie023eG0wbU","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>flowersea</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="麦吉外卖笔记day01-03"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-03 00:53" pubdate>
          2022年8月3日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          93k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          774 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">麦吉外卖笔记day01-03</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="瑞吉外卖开发笔记-一"><a href="#瑞吉外卖开发笔记-一" class="headerlink" title="瑞吉外卖开发笔记 一"></a>瑞吉外卖开发笔记 一</h1><h3 id="软件开发流程"><a href="#软件开发流程" class="headerlink" title="软件开发流程"></a>软件开发流程</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727745.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="角色分工"><a href="#角色分工" class="headerlink" title="角色分工"></a>角色分工</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727752.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727673.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="2、瑞奇外卖项目介绍"><a href="#2、瑞奇外卖项目介绍" class="headerlink" title="2、瑞奇外卖项目介绍"></a>2、瑞奇外卖项目介绍</h2><h3 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727798.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="产品原型展示"><a href="#产品原型展示" class="headerlink" title="产品原型展示"></a>产品原型展示</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727757.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727766.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="功能架构"><a href="#功能架构" class="headerlink" title="功能架构"></a>功能架构</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727353.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727275.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="3、环境搭建"><a href="#3、环境搭建" class="headerlink" title="3、环境搭建"></a>3、环境搭建</h2><h3 id="数据库环境搭建"><a href="#数据库环境搭建" class="headerlink" title="数据库环境搭建"></a>数据库环境搭建</h3><ul>
<li><strong>创建数据库</strong><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727306.png" srcset="/img/loading.gif" lazyload alt="image"></li>
<li><strong>执行SQL脚本</strong><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727298.png" srcset="/img/loading.gif" lazyload alt="image"></li>
<li><strong>数据表</strong><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727336.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<h3 id="maven项目搭建"><a href="#maven项目搭建" class="headerlink" title="maven项目搭建"></a>maven项目搭建</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727314.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>解决IDEA加载maven工程缓慢</strong><br>VM Options:-DarchetypeCatalog&#x3D;local</p>
<p><strong>添加依赖:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.ka<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reggie<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.20<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.76<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-lang<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-comment">#应用名称</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-number">1234</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-comment">#address_book-&gt;AddressBook</span><br>    <span class="hljs-comment">#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">ASSIGN_ID</span><br></code></pre></td></tr></table></figure>

<p><strong>配置application启动类</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span> <span class="hljs-comment">// lombook提供的日志注解</span><br><span class="hljs-variable">@SpringBootApplication</span><br>public class ReggieApplication &#123;<br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(ReggieApplication.class,args);<br>        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">&quot;项目启动成功！！！&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>把前端的静态资源放在resource目录<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727744.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>设置静态资源映射</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Configuration</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> void addResourceHandlers(<span class="hljs-type">ResourceHandlerRegistry</span> registry) &#123;<br>        log.info(<span class="hljs-string">&quot;开始静态资源映射&quot;</span>);<br>        registry.addResourceHandler(<span class="hljs-string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/backend/&quot;</span>);<br>        registry.addResourceHandler(<span class="hljs-string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/front/&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>启动项目，访问<a target="_blank" rel="noopener" href="http://localhost:8080/backend/index.html">http://localhost:8080/backend/index.html</a><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727798.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="4、后台登录功能开发"><a href="#4、后台登录功能开发" class="headerlink" title="4、后台登录功能开发"></a>4、后台登录功能开发</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><ul>
<li>登录页面展示(<a target="_blank" rel="noopener" href="http://localhost:8080/backend/page/login/login.html">http://localhost:8080/backend/page/login/login.html</a>)<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727104.png" srcset="/img/loading.gif" lazyload alt="image"></li>
<li>查看登录请求信息<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727913.png" srcset="/img/loading.gif" lazyload alt="image"></li>
<li>数据模型（employee表）<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727890.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<h3 id="代码开发"><a href="#代码开发" class="headerlink" title="代码开发"></a>代码开发</h3><ul>
<li>创建实体类Employee，和employee表进行映射</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final long serialVersionUID = 1L;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> id;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> username;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> password;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> phone;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> sex;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> idNumber;<span class="hljs-comment">//身份证号码</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Integer</span> status;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">LocalDateTime</span> createTime;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">LocalDateTime</span> updateTime;<br><br>    <span class="hljs-meta">@TableField</span>(fill = <span class="hljs-title class_">FieldFill</span>.<span class="hljs-property">INSERT</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> createUser;<br><br>    <span class="hljs-meta">@TableField</span>(fill = <span class="hljs-title class_">FieldFill</span>.<span class="hljs-property">INSERT_UPDATE</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> updateUser;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>创建Controller，Service，Mapper</li>
</ul>
<p>EmployeeMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EmployeeMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Employee&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>EmployeeService</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">//MP提供了一个Service接口和实现类，分别是:IService和ServiceImpl,后者是对前者的一个具体实现。</span><br><span class="hljs-comment">//        MP已经帮我们把业务层的一些基础的增删改查都已经实现了，可以直接进行使用</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">EmployeeService</span> <span class="hljs-title">extends</span> <span class="hljs-title">IService</span>&lt;<span class="hljs-title">Employee</span>&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>EmployeeServiceImpl</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmployeeServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;EmployeeMapper</span>, <span class="hljs-title">Employee&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">EmployeeService</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>EmployeeController</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@RestController</span><br><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/employee&quot;</span>)<br>public class EmployeeController &#123;<br>    <span class="hljs-variable">@Autowired</span><br>    private EmployeeServiceImpl employeeService;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>导入返回结果类R<ul>
<li>此类是一个通用结果类，服务端响应的所有结果最终都会包装成此种类型返回给前端页面</li>
</ul>
</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">R</span>&lt;T&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Integer</span> code; <span class="hljs-comment">//编码：1成功，0和其它数字为失败</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> msg; <span class="hljs-comment">//错误信息</span><br><br>    <span class="hljs-keyword">private</span> T data; <span class="hljs-comment">//数据</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Map</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>(); <span class="hljs-comment">//动态数据</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="hljs-title function_">success</span>(<span class="hljs-params">T <span class="hljs-built_in">object</span></span>) &#123;<br>        R&lt;T&gt; r = <span class="hljs-keyword">new</span> R&lt;T&gt;();<br>        r.<span class="hljs-property">data</span> = <span class="hljs-built_in">object</span>;<br>        r.<span class="hljs-property">code</span> = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="hljs-title function_">error</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> msg</span>) &#123;<br>        R r = <span class="hljs-keyword">new</span> <span class="hljs-title function_">R</span>();<br>        r.<span class="hljs-property">msg</span> = msg;<br>        r.<span class="hljs-property">code</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> R&lt;T&gt; <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> key, <span class="hljs-built_in">Object</span> value</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">put</span>(key, value);<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>在Controller中创建登录方法<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727926.png" srcset="/img/loading.gif" lazyload alt="image"><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727198.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-comment">// 老师使用了RestController = Controller + ResponseBody</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/employee&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmployeeController</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> EmployeeServiceImpl employeeService;<br><br>    <span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;/login&quot;</span>)</span><br>    <span class="hljs-comment">//使用@RequestBody注解将外部传递的json数组数据映射到形参的employee对象中作为数据</span><br>    <span class="hljs-comment">// 使用HttpServletRequest类的request对象，可以将获取到的employee中的id，存到session</span><br>    <span class="hljs-keyword">public</span> R&lt;Employee&gt; logib(HttpServletRequest request, <span class="hljs-meta">@RequestBody</span> Employee employee) &#123;<br><br><br>        <span class="hljs-comment">// 1. 将页面提交的密码password进行m5加密处理</span><br>        String password = employee.getPassword();<br>        <span class="hljs-comment">// getBytes()，可以将字符串类型的数据，转换为字节数组(相当于输入流，被内存读取）</span><br>        password = DigestUtils.md5DigestAsHex(password.getBytes());<br><br>        <span class="hljs-comment">//2、根据页面提交的用户名来查数据库</span><br>        <span class="hljs-comment">// 这个相当于是一个sql语句的条件对象，</span><br>        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();<br>        <span class="hljs-comment">// eq()： 相当于 =,对应的sql语句为：</span><br><span class="hljs-comment">//        例： lqw.eq(User::getName, &quot;Jerry&quot;).eq(User::getPassword, &quot;jerry&quot;);</span><br>        <span class="hljs-comment">// SELECT id,name,password,age,tel FROM user WHERE (name = ? AND password = ?)</span><br>        <span class="hljs-comment">// queryWrapper的中文意思是查询包装器，这里相当于获取查询条件，将获取的username作为条件，放入查询包装器对象中</span><br>        <span class="hljs-comment">// 第一个参数相当于是获取Employee对应的Username字段，第二个值是请求体中的username的值</span><br>        <span class="hljs-comment">// 创建了一个条件 username = 请求体的username，然后根据这个条件查询</span><br>        queryWrapper.eq(Employee::getUsername, employee.getUsername());<span class="hljs-comment">// 这里相当于获取实体类的username</span><br>        <span class="hljs-comment">// 这里根据查询包装器的条件 来得到对象</span><br>        <span class="hljs-comment">// 这里相当于用业务层调用数据层的方法，查询条件的sql是queryWrapper，</span><br>        Employee emp = employeeService.getOne(queryWrapper);<span class="hljs-comment">// 使用业务层：根据实体类的username属性值，来获取Employee对象</span><br><br>        <span class="hljs-comment">//3、如果没有查询到则返回失败结果</span><br>        <span class="hljs-keyword">if</span> (emp == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;登录失败&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//4、比对密码，如果不一致则返回失败结果</span><br>        <span class="hljs-keyword">if</span> (!emp.getPassword().equals(password)) &#123;<br>            <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;密码错误&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//5、查看员工状态，如果已禁用状态，则返回员工已禁用结果</span><br>        <span class="hljs-keyword">if</span> (emp.getStatus() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;账号已禁用&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//6、登录成功，将用户id存入Session（使用setAttribute）并返回成功结果</span><br>        request.getSession().setAttribute(<span class="hljs-string">&quot;employee&quot;</span>, emp.getId());<br>        <span class="hljs-keyword">return</span> R.success(emp);<span class="hljs-comment">// 这个参数是传入R对象，返回给前端</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5、后台退出功能开发"><a href="#5、后台退出功能开发" class="headerlink" title="5、后台退出功能开发"></a>5、后台退出功能开发</h2><p><strong>需求分析</strong><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208021727207.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>代码实现</strong></p>
<p>在Controller中创建退出方法</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//员工退出</span><br><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/logout&quot;</span>)<br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">logout</span>(<span class="hljs-params">HttpServletRequest request</span>)&#123;<br>    <span class="hljs-comment">//清理Session中保存的当前员工登录的id</span><br>    request.<span class="hljs-title function_">getSession</span>().<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-string">&quot;employee&quot;</span>);<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;退出成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>





<h1 id="瑞吉外卖开发笔记-二"><a href="#瑞吉外卖开发笔记-二" class="headerlink" title="瑞吉外卖开发笔记 二"></a>瑞吉外卖开发笔记 二</h1><p>笔记内容为<strong>黑马程序员</strong>视频内容</p>
<h2 id="1、完善登录功能"><a href="#1、完善登录功能" class="headerlink" title="1、完善登录功能"></a>1、完善登录功能</h2><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>前面我们已经完成了后台系统的员工登录功能开发，但是还存在一个问题:用户如果不登录，直接访问系统首页面，照样可以正常访问。</p>
<p>这种设计并不合理，我们希望看到的效果应该是，<strong>只有登录成功后才可以访问系统中的页面</strong>，如果没有登录则跳转到登录页面。</p>
<p>那么，具体应该怎么实现呢?</p>
<p>答案就是使用<strong>过滤器或者拦截器</strong>，在过滤器或者拦截器中<strong>判断用户是否已经完成登录</strong>，如果没有登录则跳转到登录页面</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>实现步骤:</p>
<ul>
<li><strong>创建自定义过滤器LoginCheckFilter</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">										 <span class="hljs-comment">// patterns是模式的意思</span><br><span class="hljs-meta">@WebFilter(filterName = &quot;LoginCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginCheckFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-comment">// 将类型转换成HttpServletRequest，得到请求的URL</span><br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> (HttpServletRequest) servletRequest;<br>        <span class="hljs-comment">// 将类型转换成HttpServletResponse，得到响应的数据然后放行</span><br>        <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> (HttpServletResponse) servletResponse;<br><br>        <span class="hljs-comment">// 这个&#123;&#125; 是一个占位符，可以将逗号, 后面的值填充到占位符中去</span><br>        log.info(<span class="hljs-string">&quot;拦截到请求：&#123;&#125;&quot;</span>,request.getRequestURI());<br>        <span class="hljs-comment">// 放行请求的URL</span><br>        filterChain.doFilter(request,response);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><strong>在启动类上加入注解@ServletComponentScan</strong></li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@SpringBootApplication</span><br><span class="hljs-comment">// 在启动类中配置扫描Servlet组件的注解</span><br><span class="hljs-variable">@ServletComponentScan</span> <span class="hljs-comment">// 扫描WebFilter注解，创建过滤器</span><br>public class ReggieApplication &#123;<br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(ReggieApplication.class,args);<br>        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">&quot;项目启动成功！！！&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><strong>完善过滤器的处理逻辑</strong></li>
</ul>
<p>过滤器具体的处理逻辑如下:</p>
<p>1、获取本次请求的URI</p>
<p>2、判断本次请求是否需要处理</p>
<p>3、如果不需要处理，则直接放行</p>
<p>4、判断登录状态，如果已登录，则直接放行</p>
<p>5、如果未登录则返回未登录结果<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316071.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  检查用户是否已经完成登录</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span>                                     <span class="hljs-comment">// patterns是模式的意思</span><br><span class="hljs-meta">@WebFilter</span>(filterName = <span class="hljs-string">&quot;loginCheckFilter&quot;</span>,urlPatterns = <span class="hljs-string">&quot;/*&quot;</span>) <span class="hljs-comment">// 使用servlet过滤器</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginCheckFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-comment">// 路径匹配器，支持通配符</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">AntPathMatcher</span> <span class="hljs-variable constant_">PATH_MATCHER</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AntPathMatcher</span>();<span class="hljs-comment">// 创建路径匹配器对象</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">doFilter</span>(<span class="hljs-title class_">ServletRequest</span> servletRequest, <span class="hljs-title class_">ServletResponse</span> servletResponse, <span class="hljs-title class_">FilterChain</span> filterChain) throws <span class="hljs-title class_">IOException</span>, <span class="hljs-title class_">ServletException</span> &#123;<br>        <span class="hljs-comment">// 将类型转换成HttpServletRequest，得到请求的URI</span><br>        <span class="hljs-title class_">HttpServletRequest</span> request = (<span class="hljs-title class_">HttpServletRequest</span>) servletRequest;<br>        <span class="hljs-comment">// 将类型转换成HttpServletResponse，得到响应的数据然后放行</span><br>        <span class="hljs-title class_">HttpServletResponse</span> response = (<span class="hljs-title class_">HttpServletResponse</span>) servletResponse;<br><br>        <span class="hljs-comment">// 1. 获取本次请求的URI, URI可以理解为不是完整的URL，得到关键调用的url接口地址</span><br>        <span class="hljs-comment">// URL：http://localhost:8081/test-context/laker/userInfo</span><br>        <span class="hljs-comment">// URI：/test-context/laker/userInfo</span><br>        java.<span class="hljs-property">lang</span>.<span class="hljs-property">String</span> requestURI = request.<span class="hljs-title function_">getRequestURI</span>(); <span class="hljs-comment">// /backend/index.html</span><br><br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;拦截到请求：&#123;&#125;&quot;</span>,requestURI);<br><br>        <span class="hljs-comment">// 创建一个数组，用来存储放行的URI，相当于一个白名单</span><br>        java.<span class="hljs-property">lang</span>.<span class="hljs-property">String</span>[] urls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<br>                <span class="hljs-string">&quot;/employee/login&quot;</span>,<br>                <span class="hljs-string">&quot;/employee/logout&quot;</span>,<br>                <span class="hljs-comment">// 将静态资源放行</span><br>                <span class="hljs-string">&quot;/backend/**&quot;</span>,<br>                <span class="hljs-comment">// 这个是移动端的页面也放行</span><br>                <span class="hljs-string">&quot;front/**&quot;</span><br>                <span class="hljs-comment">// 点击登录按钮会异步请求/employee/page，这个URI，不在白名单，所以拦截</span><br>        &#125;;<br><br>        <span class="hljs-comment">// 2. 判断本次请求是否需要处理</span><br>        <span class="hljs-built_in">boolean</span> check = <span class="hljs-title function_">check</span>(urls, requestURI);<br><br>        <span class="hljs-comment">// 3. 如果不需要处理，则直接放行(就是匹配上了，在白名单里面）</span><br>        <span class="hljs-keyword">if</span> (check)&#123;<br>            log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;本次请求&#123;&#125;不需要处理&quot;</span>,requestURI);<br>            <span class="hljs-comment">// filterChain放行的对象</span><br>            filterChain.<span class="hljs-title function_">doFilter</span>(request,response);<br>            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 结束当前方法</span><br>        &#125;<br><br>        <span class="hljs-comment">// 4. 判断登录状态，如果已登录，则直接放行</span><br>        <span class="hljs-comment">// 如果会话中有参数则 放行</span><br>        <span class="hljs-keyword">if</span> (request.<span class="hljs-title function_">getSession</span>().<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&quot;employee&quot;</span>)!=<span class="hljs-literal">null</span>)&#123;<br>            log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;用户已经登录,用户id为：&#123;&#125;&quot;</span>,request.<span class="hljs-title function_">getSession</span>().<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&quot;employee&quot;</span>));<br>            filterChain.<span class="hljs-title function_">doFilter</span>(request,response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;用户未登录&quot;</span>);<br>        <span class="hljs-comment">// 5. 如果未登录则返回未登录结果，通过输出流方式向客户端页面响应数据</span><br>        <span class="hljs-comment">// 输出流可以理解为：写数据（向外输出到硬盘），输入流可以理解为：读数据（向内读取到内存）</span><br>        response.<span class="hljs-title function_">getWriter</span>().<span class="hljs-title function_">write</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">toJSONString</span>(R.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;NOTLOGIN&quot;</span>)));<span class="hljs-comment">// 写的是一个JSON数据</span><br>        <span class="hljs-keyword">return</span>;<br><br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  路径匹配，检查本次请求是否需要放行</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> urls 白名单（需要放行的URI）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> requestURI (请求的URI）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">check</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] urls,<span class="hljs-built_in">String</span> requestURI</span>)&#123;<br><br>        <span class="hljs-comment">// 使用foreach遍历String数组中的URI，和/backend/index.html这个URI进行匹配，</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> url : urls) &#123;<br>            <span class="hljs-comment">// 使用路径匹配器对象，匹配路径</span><br>            <span class="hljs-built_in">boolean</span> match = <span class="hljs-variable constant_">PATH_MATCHER</span>.<span class="hljs-title function_">match</span>(url, requestURI);<br>            <span class="hljs-comment">// 如果为true就返回true</span><br>            <span class="hljs-keyword">if</span> (match)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// 整个foreach遍历完后还没有匹配上，就返回false</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    &#125;<br><br><br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="2、新增员工"><a href="#2、新增员工" class="headerlink" title="2、新增员工"></a>2、新增员工</h2><h3 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h3><p>后台系统中可以管理员工信息，通过新增员工来添加后台系统用户。点击 <strong>添加员工</strong> 按钮跳转到新增页面，如下:<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316054.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><p>新增员工，其实就是将我们新增页面录入的员工数据插入到employee表。需要注意，employee表中对username字段加入了唯一约束，因为username是员工的登录账号，必须是<strong>唯一</strong>的</p>
<h3 id="代码开发-1"><a href="#代码开发-1" class="headerlink" title="代码开发"></a>代码开发</h3><p>在开发代码之前，需要梳理一下整个程序的执行过程:</p>
<ul>
<li>页面发送ajax请求，将新增员工页面中输入的数据以json的形式提交到服务端</li>
<li>服务端Controller接收页面提交的数据并调用Service将数据进行保存</li>
<li>Service调用Mapper操作数据库，保存数据<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316113.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">    <span class="hljs-comment">//新增员工</span><br> <span class="hljs-meta">@PostMapping</span><span class="hljs-comment">// 这个路径不用写，因为在类上面写了 “/employee”</span><br>    <span class="hljs-comment">// 由于前端传递过来的数据是json格式到Controller表现层，然后要获取这个参数要使用@RequestBody注解</span><br><span class="hljs-comment">//    由于只要返回一个成功的信息给前端，所以R泛型为String</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; save(HttpServletRequest request,<span class="hljs-meta">@RequestBody</span> Employee employee)&#123;<br>        <span class="hljs-comment">// 使用实体类的toString方法，打印对象内容</span><br>        log.info(<span class="hljs-string">&quot;新增员工，员工信息：&#123;&#125;&quot;</span>,employee.toString());<br><br>        <span class="hljs-comment">// 设置初始密码123456，需要进行md5加密处理</span><br>        employee.setPassword(DigestUtils.md5DigestAsHex(<span class="hljs-string">&quot;123456&quot;</span>.getBytes())); <span class="hljs-comment">// 转成字节类型的值，可以给计算机读</span><br><br>        employee.setCreateTime(LocalDateTime.now());<br>        employee.setUpdateTime(LocalDateTime.now());<br><br>        <span class="hljs-comment">// 获取当前登录用户的id，从session中获取，所以方法用要加形参HttpServletRequest</span><br>        <span class="hljs-built_in">Long</span> empId = (<span class="hljs-built_in">Long</span>) request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br><br>        employee.setCreateUser(empId);<br>        employee.setUpdateUser(empId);<br><br>        employeeService.save(employee); <span class="hljs-comment">// 这个save方法继承了Iservice接口（使得业务层快速开发)，</span><br>                                        <span class="hljs-comment">// 这个save方法会调用其数据层的方法，添加到数据库中（这一套都是mp提供的）</span><br><br>        <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;新增员工成功&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>前面的程序还存在一个问题，就是当我们在新增员工时输入的账号已经存在，由于employee表中对该字段加入了唯一约束，此时程序会抛出异常:<br><code>java.sql.SQLIntegrityConstraintViolationException: Duplicate entry &#39;heniang&#39; for key &#39;idx_username&#39;</code></p>
<p>此时需要我们的程序进行异常捕获，通常有两种处理方式:</p>
<p>1、在Controller方法中加入try.catch进行异常捕获</p>
<p>2、使用异常处理器进行全局异常捕获</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 全局异常处理</span><br><span class="hljs-comment"> * annotations 是注释的意思</span><br><span class="hljs-comment"> */</span><br>                    <span class="hljs-comment">// 只要类上面加了这两个注解，就会被这个类处理</span><br><span class="hljs-meta">@ControllerAdvice</span>(annotations = &#123;<span class="hljs-title class_">RestController</span>.<span class="hljs-property">class</span>, <span class="hljs-title class_">Controller</span>.<span class="hljs-property">class</span>&#125;)<br><span class="hljs-meta">@ResponseBody</span> <span class="hljs-comment">// 将响应的数据以json数据返回  注解作用：设置当前控制器方法响应内容为当前返回值（将返回值转换为json），无需解析</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  异常处理方法</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ExceptionHandler</span>(<span class="hljs-title class_">SQLIntegrityConstraintViolationException</span>.<span class="hljs-property">class</span>) <span class="hljs-comment">// 拦截异常，拦截类型为sql异常</span><br>    <span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">exceptionHandler</span>(<span class="hljs-params">SQLIntegrityConstraintViolationException ex</span>)&#123;<br>        <span class="hljs-comment">//  日志输出异常打印信息</span><br>      log.<span class="hljs-title function_">info</span>(ex.<span class="hljs-title function_">getMessage</span>());<br><br>      <span class="hljs-keyword">if</span> (ex.<span class="hljs-title function_">getMessage</span>().<span class="hljs-title function_">contains</span>(<span class="hljs-string">&quot;Duplicate entry&quot;</span>))&#123;<br>          <span class="hljs-comment">// 如果异常信息包含了 Duplicate entry这个字符串信息，就以空格 来分割异常信息，</span><br>          <span class="hljs-title class_">String</span>[] split = ex.<span class="hljs-title function_">getMessage</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot; &quot;</span>);<br>          <span class="hljs-comment">// Duplicate entry &#x27;zhangsan&#x27; for key &#x27;employee.idx_username&#x27;</span><br>          <span class="hljs-comment">// 异常信息中的索引为2的值，就是username账号，提示账号已经存在</span><br>          <span class="hljs-title class_">String</span> mes = split[<span class="hljs-number">2</span>] + <span class="hljs-string">&quot;已存在&quot;</span>;<br>          <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">error</span>(mes);<br>      &#125;<br>        <br>        <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;未知错误&quot;</span>);<br>    &#125;<br><br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<p>1、根据产品原型明确业务需求</p>
<p>2、重点分析数据的流转过程和数据格式</p>
<p>3、通过debug断点调试跟踪程序执行过程</p>
<h2 id="3、员工信息分页查询"><a href="#3、员工信息分页查询" class="headerlink" title="3、员工信息分页查询"></a>3、员工信息分页查询</h2><h3 id="需求分析-2"><a href="#需求分析-2" class="headerlink" title="需求分析"></a>需求分析</h3><p>系统中的员工很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316094.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="代码开发-2"><a href="#代码开发-2" class="headerlink" title="代码开发"></a>代码开发</h3><p>在开发代码之前，需要梳理一下整个程序的执行过程:</p>
<ul>
<li>页面发送ajax请求，将分页查询参数(page.pageSize、name)提交到服务端</li>
<li>服务端Controller接收页面提交的数据并调用Service查询数据</li>
<li>Service调用Mapper操作数据库，查询分页数据</li>
<li>Controller将查询到的分页数据响应给页面</li>
<li>页面接收到分页数据并通过ElementUI的Table组件展示到页面上</li>
</ul>
<p>配置MP分页插件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">mybatisPlusInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        mybatisPlusInterceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>());<br>        <span class="hljs-keyword">return</span>  mybatisPlusInterceptor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>员工信息分页查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  员工信息分页查询</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageSize</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize,String name)</span>&#123; <span class="hljs-comment">// 这里返回对应的是R的data属性对象，因为data的类型是object</span><br>        <span class="hljs-comment">// 这三个值是和占位符一一对应的</span><br>        log.info(<span class="hljs-string">&quot;page = &#123;&#125;,pageSize = &#123;&#125;, name = &#123;&#125;&quot;</span>,page,pageSize,name);<br><br>        <span class="hljs-comment">// 构造分页查询器 // 第一个参数是：当前页码，第二个参数是每页显示的记录数</span><br>        <span class="hljs-type">Page</span> <span class="hljs-variable">pageInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>(page, pageSize);<br><br>        <span class="hljs-comment">// 构造条件构造器</span><br>        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>();<br>        <span class="hljs-comment">// 添加过滤条件 这里.eq对应sql where 。。。= 。。。 等值查询</span><br>        <span class="hljs-comment">// .like 相当于sql： where 。。。 like 。。。 模糊查询</span><br>        <span class="hljs-comment">// 创建了一个条件 这个StringUtils.isNotEmpty(name)可以理解为不为null，就会执行like name = ？</span><br>        queryWrapper.like(StringUtils.isNotEmpty(name),Employee::getName,name);<span class="hljs-comment">// 如果请求的URL中包含name（模糊查询）</span><br>        <span class="hljs-comment">// 添加排序条件</span><br>        <span class="hljs-comment">// 这个条件是倒序排序，按照数据库中的UpdateTime字段倒叙</span><br>        queryWrapper.orderByDesc(Employee::getUpdateTime);<br><br>        <span class="hljs-comment">// 执行查询信息 用业务层调用数据层</span><br>        employeeService.page(pageInfo,queryWrapper);<br>        <span class="hljs-comment">// 将page对象返回 -- 可以理解为将页面返回给前端</span><br>        <span class="hljs-keyword">return</span> R.success(pageInfo);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316066.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="4、启用-x2F-禁用员工账号"><a href="#4、启用-x2F-禁用员工账号" class="headerlink" title="4、启用&#x2F;禁用员工账号"></a>4、启用&#x2F;禁用员工账号</h2><h3 id="需求分析-3"><a href="#需求分析-3" class="headerlink" title="需求分析"></a>需求分析</h3><p>在员工管理列表页面，可以对某个员工账号进行启用或者禁用操作。账号禁用的员工不能登录系统，启用后的员工可以正常登录。</p>
<p>需要注意，只有管理员（admin用户）可以对其他普通用户进行启用、禁用操作，所以普通用户登录系统后启用、禁用按钮不显示。</p>
<h3 id="代码开发-3"><a href="#代码开发-3" class="headerlink" title="代码开发"></a>代码开发</h3><p>页面中是怎么做到只有管理员admin能够看到启用、禁用按钮的？</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316106.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>在开发代码之前，需要梳理一下整个程序的执行过程:</p>
<p>1、页面发送ajax请求，将参数(id、 status)提交到服务端</p>
<p>2、服务端Controller接收页面提交的数据并调用Service更新数据</p>
<p>3、Service调用Mapper操作数据库</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316027.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>页面中的ajax请求是如何发送的？<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316066.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>根据id修改员工信息</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@PutMapping</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; update(HttpServletRequest request,<span class="hljs-meta">@RequestBody</span> Employee employee)&#123;<br>    log.info(employee.toString());<br><br>    <span class="hljs-built_in">Long</span> empId = (<span class="hljs-built_in">Long</span>) request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>    employee.setUpdateTime(LocalDateTime.now());<br>    employee.setUpdateUser(empId);<br>    employeeService.updateById(employee);<br><br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;员工信息修改成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试过程中没有报错，但是功能并没有实现，查看数据库中的数据也没有变化。观察控制台输出的SQL:<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316998.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>SQL执行的结果是更新的数据行数为0，仔细观察id的值，和数据库中对应记录的id值并不相同<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316104.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="代码修复"><a href="#代码修复" class="headerlink" title="代码修复"></a>代码修复</h3><p>通过观察控制台输出的SQL发现页面传递过来的员工id的值和数据库中的id值不一致，这是怎么回事呢?</p>
<p>分页查询时服务端响应给页面的数据中id的值为19位数字，类型为long</p>
<p>页面中js处理long型数字只能精确到<strong>前16位</strong>，所以最终通过ajax请求提交给服务端的时候id就改变了</p>
<p>前面我们已经发现了问题的原因，即js对long型数据进行处理时<strong>丢失精度</strong>，导致提交的id和数据库中的id不一致。</p>
<p>如何解决这个问题?</p>
<p>我们可以在<strong>服务端</strong>给页面<strong>响应json数据时进行处理</strong>，<strong>将long型数据统一转为String字符串</strong>。</p>
<p><strong>具体实现步骤:</strong></p>
<p><strong>1)</strong> 提供对象转换器JacksonobjectMapper，基于Jackson进行Java对象到json数据的转换（资料中已经提供，直接复制到项目中使用)</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 对象映射器:基于jackson将Java对象转为json，或者将json转为Java对象</span><br><span class="hljs-comment"> * 将JSON解析为Java对象的过程称为 [从JSON反序列化Java对象]</span><br><span class="hljs-comment"> * 从Java对象生成JSON的过程称为 [序列化Java对象到JSON]</span><br><span class="hljs-comment"> */</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JacksonObjectMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ObjectMapper</span> </span>&#123;<br><br>    public static <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-type">DEFAULT_DATE_FORMAT</span> = <span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>;<br>    public static <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-type">DEFAULT_DATE_TIME_FORMAT</span> = <span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;<br>    public static <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-type">DEFAULT_TIME_FORMAT</span> = <span class="hljs-string">&quot;HH:mm:ss&quot;</span>;<br><br>    public <span class="hljs-type">JacksonObjectMapper</span>() &#123;<br>        <span class="hljs-keyword">super</span>();<br>        <span class="hljs-comment">//收到未知属性时不报异常</span><br>        <span class="hljs-keyword">this</span>.configure(<span class="hljs-type">FAIL_ON_UNKNOWN_PROPERTIES</span>, <span class="hljs-literal">false</span>);<br><br>        <span class="hljs-comment">//反序列化时，属性不存在的兼容处理</span><br>        <span class="hljs-keyword">this</span>.getDeserializationConfig().withoutFeatures(<span class="hljs-type">DeserializationFeature</span>.<span class="hljs-type">FAIL_ON_UNKNOWN_PROPERTIES</span>);<br><br><br>        <span class="hljs-type">SimpleModule</span> simpleModule = <span class="hljs-keyword">new</span> <span class="hljs-type">SimpleModule</span>()<br>                .addDeserializer(<span class="hljs-type">LocalDateTime</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">LocalDateTimeDeserializer</span>(<span class="hljs-type">DateTimeFormatter</span>.ofPattern(<span class="hljs-type">DEFAULT_DATE_TIME_FORMAT</span>)))<br>                .addDeserializer(<span class="hljs-type">LocalDate</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">LocalDateDeserializer</span>(<span class="hljs-type">DateTimeFormatter</span>.ofPattern(<span class="hljs-type">DEFAULT_DATE_FORMAT</span>)))<br>                .addDeserializer(<span class="hljs-type">LocalTime</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">LocalTimeDeserializer</span>(<span class="hljs-type">DateTimeFormatter</span>.ofPattern(<span class="hljs-type">DEFAULT_TIME_FORMAT</span>)))<br><br>                .addSerializer(<span class="hljs-type">BigInteger</span>.<span class="hljs-keyword">class</span>, <span class="hljs-type">ToStringSerializer</span>.instance)<br>                <span class="hljs-comment">// 将Long型转换成字符串</span><br>                .addSerializer(<span class="hljs-type">Long</span>.<span class="hljs-keyword">class</span>, <span class="hljs-type">ToStringSerializer</span>.instance)<br>                .addSerializer(<span class="hljs-type">LocalDateTime</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">LocalDateTimeSerializer</span>(<span class="hljs-type">DateTimeFormatter</span>.ofPattern(<span class="hljs-type">DEFAULT_DATE_TIME_FORMAT</span>)))<br>                .addSerializer(<span class="hljs-type">LocalDate</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">LocalDateSerializer</span>(<span class="hljs-type">DateTimeFormatter</span>.ofPattern(<span class="hljs-type">DEFAULT_DATE_FORMAT</span>)))<br>                .addSerializer(<span class="hljs-type">LocalTime</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">LocalTimeSerializer</span>(<span class="hljs-type">DateTimeFormatter</span>.ofPattern(<span class="hljs-type">DEFAULT_TIME_FORMAT</span>)));<br><br>        <span class="hljs-comment">//注册功能模块 例如，可以添加自定义序列化器和反序列化器</span><br>        <span class="hljs-keyword">this</span>.registerModule(simpleModule);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p><strong>2)</strong> 在WebMvcConfig配置类中扩展Spring mvc的消息转换器，在此消息转换器中使用提供的对象转换器进行Java对象到json数据的转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  扩展MVC框架的消息转换器-- 重写 WebMvcConfigurationSupport的extendMessageConverters方法</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> converters</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extendMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;扩展消息转换器。。。。&quot;</span>);<br>    <span class="hljs-comment">// 创建消息转换器对象</span><br>    <span class="hljs-type">MappingJackson2HttpMessageConverter</span> <span class="hljs-variable">messageConverter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2HttpMessageConverter</span>();<br>    <span class="hljs-comment">// 设置对象转换器，底层使用了Jackson将java对象（这里是Long型的数据）转换为json（字符串）</span><br>    messageConverter.setObjectMapper(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonObjectMapper</span>());<br>    <span class="hljs-comment">// 将上面的消息转换器对象追加到mvc框架的转换器集合中</span><br>    <span class="hljs-comment">// 执行完这条语句，消息转换器的对象converters的大小size会变成9，原来是8，代表扩展进去了</span><br>    converters.add(<span class="hljs-number">0</span>,messageConverter);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5、编辑员工信息"><a href="#5、编辑员工信息" class="headerlink" title="5、编辑员工信息"></a>5、编辑员工信息</h2><h3 id="需求分析-4"><a href="#需求分析-4" class="headerlink" title="需求分析"></a>需求分析</h3><p>在员工管理列表页面点击编辑按钮，跳转到编辑页面，在编辑页面回显员工信息并进行修改，最后点击保存按钮完成编辑操作</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208022316076.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="代码开发-4"><a href="#代码开发-4" class="headerlink" title="代码开发"></a>代码开发</h3><p>在开发代码之前需要梳理一下操作过程和对应的程序的执行流程:</p>
<p>1、点击编辑按钮时，页面跳转到add.html，并在url中携带参数[员工id]</p>
<p>2、在add.html页面获取url中的参数[员工id]</p>
<p>3、发送ajax请求，请求服务端，同时提交员工id参数</p>
<p>4、服务端接收请求，根据员工id查询员工信息，将员工信息以json形式响应给页面</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    *  根据id查询员工信息</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br><br>   <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)</span> <span class="hljs-comment">// 这是接收前端的请求路径（少了id属性路径）</span><br><span class="hljs-comment">// http://localhost:8080/employee/1554938060526084098的Id</span><br>    <span class="hljs-comment">// @PathVariable作用：绑定路径参数与处理器方法形参间的关系，要求路径参数名与形参名一一对应（例如接收id）</span><br>   <span class="hljs-comment">// @RequestBody用于接收json数据【application/json】</span><br>   <span class="hljs-comment">// @RequestParam用于接收url地址传参，表单传参【application/x-www-form-urlencoded】</span><br>   <span class="hljs-keyword">public</span> R&lt;Employee&gt; getById(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id)&#123; <span class="hljs-comment">// 接收请求体中的基础数据类型的值id</span><br><br>       log.info(<span class="hljs-string">&quot;根据id查询员工 信息。。。&quot;</span>);<br>       Employee employee = employeeService.getById(id);<br><br>       <span class="hljs-keyword">if</span> (employee != <span class="hljs-literal">null</span>)&#123;<br>           <span class="hljs-keyword">return</span> R.success(employee); <span class="hljs-comment">// 将查询到的对象，返回给前端</span><br>       &#125;<br>       <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;没有查询到对应的员工信息&quot;</span>);<br>   &#125;<br></code></pre></td></tr></table></figure>

<p>5、页面接收服务端响应的json数据，通过VUE的数据绑定进行员工信息回显</p>
<p>6、点击保存按钮，发送ajax请求，将页面中的员工信息以json方式提交给服务端</p>
<p>7、服务端接收员工信息，并进行处理，完成后给页面响应</p>
<p>8、页面接收到服务端响应信息后进行相应处理</p>
<p><strong>注意</strong>:add.html页面为公共页面，<strong>新增员工和编辑员工都是在此页面操作</strong>，所以该代码部分与之前添加员工代码对应，不需要重写。</p>
<h1 id="瑞吉外卖开发笔记-三"><a href="#瑞吉外卖开发笔记-三" class="headerlink" title="瑞吉外卖开发笔记 三"></a>瑞吉外卖开发笔记 三</h1><p>笔记内容为<strong>黑马程序员</strong>视频内容</p>
<h2 id="分类管理业务开发"><a href="#分类管理业务开发" class="headerlink" title="分类管理业务开发"></a>分类管理业务开发</h2><h3 id="公共字段自动填充"><a href="#公共字段自动填充" class="headerlink" title="公共字段自动填充"></a>公共字段自动填充</h3><h4 id="问题分析-1"><a href="#问题分析-1" class="headerlink" title="问题分析"></a>问题分析</h4><p>前面我们已经完成了后台系统的员工管理功能开发，在新增员工时需要设置创建时间、创建人、修改时间、修改人等字段，在编辑员工时需要设置修改时间和修改人等字段。这些字段属于公共字段，也就是很多表中都有这些字段，如下:<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030021864.png" srcset="/img/loading.gif" lazyload alt="image"><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030021906.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>能不能对于这些公共字段在某个地方统一处理，来简化开发呢?答案就是使用Mybatis Plus提供的<strong>公共字段自动填充</strong>功能。</p>
<h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><p>Mybatis Plus公共字段自动填充，也就是在插入或者更新的时候为指定字段赋予指定的值，使用它的好处就是可以统一对这些字段进行处理，避免了重复代码。</p>
<p>实现步骤:</p>
<p>1、在实体类的属性上加入@TableField注解，指定自动填充的策略，</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// fill是填充，充满的意思 FieldFill是字段填充</span><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><span class="hljs-comment">//插入时填充字段</span><br><span class="hljs-keyword">private</span> LocalDateTime createTime; <span class="hljs-comment">// 在公共字段上面使用字段填充</span><br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><span class="hljs-comment">//插入和更新时填充字段</span><br><span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><span class="hljs-comment">//插入时填充字段</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> createUser;<br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><span class="hljs-comment">//插入和更新时填充字段</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> updateUser;<br></code></pre></td></tr></table></figure>

<p>2、按照框架要求编写元数据对象处理器，在此类中统一为公共字段赋值，此类需要实现MetaObjectHandler接口</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  自定义元数据对象处理器</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@Component</span> <span class="hljs-comment">// 被Spring容器管理</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjecthandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<span class="hljs-comment">// MetaObjectHandler元对象处理程序的意思</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  插入操作，自动填充</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">metaObject</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">// 重写填充公共字段填充的方法（插入时填充）</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">insertFill</span>(<span class="hljs-params">MetaObject metaObject</span>) &#123;<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;公共字段自动填充【insert】。。。&quot;</span>);<br>        log.<span class="hljs-title function_">info</span>(metaObject.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 使用日志打印该对象</span><br>        <span class="hljs-comment">// 第一个参数是字段名-- 对应的实体类的属性名， 第二个参数是，值</span><br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;createTime&quot;</span>, <span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;updateTime&quot;</span>,<span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br>        <span class="hljs-comment">// 暂时写死，这个数据库中的id类型是bigint，对应的java类型是Long</span><br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;createUser&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(<span class="hljs-number">1</span>));<br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;updateUser&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(<span class="hljs-number">1</span>));<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  更新操作，自动填充</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">metaObject</span></span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">updateFill</span>(<span class="hljs-params">MetaObject metaObject</span>) &#123;<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;公共字段自动填充【update】。。。&quot;</span>);<br>        log.<span class="hljs-title function_">info</span>(metaObject.<span class="hljs-title function_">toString</span>());<br><span class="hljs-comment">//      修改时填充：只要填修改时间和修改人就行</span><br>        <span class="hljs-comment">// 第一个参数是字段名-- 对应的实体类的属性名， 第二个参数是，值</span><br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;updateTime&quot;</span>,<span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;updateUser&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(<span class="hljs-number">1</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="功能完善"><a href="#功能完善" class="headerlink" title="功能完善"></a>功能完善</h4><p>前面我们已经完成了公共字段自动填充功能的代码开发，但是还有一个问题没有解决，就是我们在自动填充createUser和updateUser时设置的用户id是固定值，现在我们需要改造成动态获取当前登录用户的id。</p>
<p>有的同学可能想到，用户登录成功后我们将用户id存入了HttpSession中，现在我从HttpSession中获取不就行了?</p>
<p><strong>注意</strong>，我们在MyMetaObjectHandler类中是不能获得HttpSession对象的，所以我们需要通过其他方式来获取登录用户id。</p>
<p>可以使用<strong>ThreadLocal</strong>来解决此问题,它是JDK中提供的一个类。</p>
<p>在学习ThreadLocal之前，我们需要先确认一个事情，<strong>就是客户端发送的每次http请求，对应的在服务端都会分配一个新的线程来处理</strong>，在处理过程中涉及到下面类中的方法<strong>都属于相同的一个线程</strong>:</p>
<p>1、LoginCheckFilter的doFilter方法</p>
<p>2、EmployeeContraller的update方法</p>
<p>3、MyMetaObjectHandler的updateFill方法</p>
<p>可以在上面的三个方法中分别加入下面代码（获取当前线程id):</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-type">long</span> <span class="hljs-type">id</span> = Thread.currentThread().getId() ;<br>log.info(<span class="hljs-string">&quot;线程id:&#123;&#125;&quot;</span> ,<span class="hljs-type">id</span>);<br></code></pre></td></tr></table></figure>

<p>执行编辑员工功能进行验证，通过观察控制台输出可以发现，一次请求对应的线程id是相同的:</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030021894.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>注意</strong>： &#x3D;&#x3D;前三个是同一个线程（因为是同一个http请求），但是第四个是第二次http请求（更新完数据后前端会再发一次查询页面的请求，所以会有两个线程），所以线程号不一样&#x3D;&#x3D;</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208050239566.png" srcset="/img/loading.gif" lazyload alt="image-20220805023919411"></p>
<p><strong>什么是ThreadLocal?</strong></p>
<p>ThreadLocal并不是一个Thread，而是Thread的局部变量。当使用ThreadLocal维护变量时，ThreadLocal为每个使用该变量的线程提供独立的变量副本，所以每一个线程都可以独立地改变自己的副本，而不会影响其它线程所对应的副本。<br>ThreadLocal为每个线程提供单独一份存储空间，具有线程隔离的效果，只有在线程内才能获取到对应的值，线程外则不能访问。</p>
<p>ThreadLocal常用方法：</p>
<ul>
<li>public void set(T value) 设置当前线程局部变量的值</li>
<li>public T get() 返回当前线程所对应的线程局部变量的值</li>
</ul>
<p>我们可以在LoginCheckFilter的doFilter方法中获取当前登录用户id，并调用ThreadLocal的set方法来设置当前线程的线程局部变量的值（用户id)，然后在MyMetaObjectHandler的updateFill方法中调用ThreadLocal的get方法来获得当前线程所对应的线程局部变量的值(用户id)。</p>
<p><strong>实现步骤:</strong></p>
<p>1、编写BaseContext工具类，基于ThreadLocal封装的工具类</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *   基于ThreadLocal封装工具类，用户保存和获取当前登录用户id（不会混淆，也不会覆盖，这个ThreadLcal只对当前线程有效</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BaseContext</span> &#123;<br>    <span class="hljs-comment">// 这里用静态的static，因为是一个工具类，容易不用创建对象，用类名调用即可</span><br>    <span class="hljs-comment">// 这个线程id值是Long，所以泛型是Long</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCurrentId</span>(<span class="hljs-params">Long id</span>)</span> &#123; <span class="hljs-comment">// 这个方法是在获取到session中调用，将id传给这个方法</span><br>        threadLocal.<span class="hljs-keyword">set</span>(id); <span class="hljs-comment">// 将session中的id存入到线程中</span><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Long <span class="hljs-title">getCurrentId</span>()</span>&#123;<br>        <span class="hljs-keyword">return</span> threadLocal.<span class="hljs-keyword">get</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2、在LogincheckFilter的doFilter方法中调用BaseContext来设置当前登录用户的id</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">        <span class="hljs-comment">// 4. 判断登录状态，如果已登录，则直接放行</span><br>        <span class="hljs-comment">// 如果会话中有参数则 放行</span><br>        <span class="hljs-keyword">if</span> (request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>)!=<span class="hljs-literal">null</span>)&#123;<br>            log.info(<span class="hljs-string">&quot;用户已经登录,用户id为：&#123;&#125;&quot;</span>,request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>));<br><br><span class="hljs-comment">//            // 这个项目刚开始会经过这个类，获取当前线程的id</span><br><span class="hljs-comment">//            long id = Thread.currentThread().getId();</span><br><span class="hljs-comment">//            log.info(&quot;线程id为：&#123;&#125;&quot;,id);</span><br><br>            <span class="hljs-comment">// 获取当前session，那session中的employee属性id值</span><br>            <span class="hljs-built_in">Long</span> empId = (<span class="hljs-built_in">Long</span>) request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>            <span class="hljs-comment">// 将id值存入到ThreadLocal的工具类BaseContext中</span><br>            BaseContext.setCurrentId(empId);<br><br><br>            filterChain.doFilter(request,response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br></code></pre></td></tr></table></figure>

<p>3、在MyMeta0bjectHandler的方法中调用BaseContext获取登录用户的id</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  自定义元数据对象处理器</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@Component</span> <span class="hljs-comment">// 被Spring容器管理</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjecthandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<span class="hljs-comment">// MetaObjectHandler元对象处理程序的意思</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  插入操作，自动填充</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">metaObject</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">// 重写填充公共字段填充的方法（插入时填充）</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">insertFill</span>(<span class="hljs-params">MetaObject metaObject</span>) &#123;<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;公共字段自动填充【insert】。。。&quot;</span>);<br>        log.<span class="hljs-title function_">info</span>(metaObject.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 使用日志打印该对象</span><br>        <span class="hljs-comment">// 第一个参数是字段名-- 对应的实体类的属性名， 第二个参数是，值</span><br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;createTime&quot;</span>, <span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;updateTime&quot;</span>,<span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br>        <span class="hljs-comment">// 暂时写死，这个数据库中的id类型是bigint，对应的java类型是Long</span><br><span class="hljs-comment">//        metaObject.setValue(&quot;createUser&quot;,new Long(1));</span><br><span class="hljs-comment">//        metaObject.setValue(&quot;updateUser&quot;,new Long(1));</span><br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;createUser&quot;</span>,<span class="hljs-title class_">BaseContext</span>.<span class="hljs-title function_">getCurrentId</span>());<br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;updateUser&quot;</span>,<span class="hljs-title class_">BaseContext</span>.<span class="hljs-title function_">getCurrentId</span>());<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  更新操作，自动填充</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">metaObject</span></span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">updateFill</span>(<span class="hljs-params">MetaObject metaObject</span>) &#123;<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;公共字段自动填充【update】。。。&quot;</span>);<br>        log.<span class="hljs-title function_">info</span>(metaObject.<span class="hljs-title function_">toString</span>());<br><br>        long id = <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">getId</span>();<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;线程id为：&#123;&#125;&quot;</span>,id);<br><br><br><span class="hljs-comment">//      修改时填充：只要填修改时间和修改人就行</span><br>        <span class="hljs-comment">// 第一个参数是字段名-- 对应的实体类的属性名， 第二个参数是，值</span><br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;updateTime&quot;</span>,<span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br>        <span class="hljs-comment">// 本来写死了，现在替换用ThreadLocal的工具类BaseContext</span><br><span class="hljs-comment">//        metaObject.setValue(&quot;updateUser&quot;,new Long(1));</span><br>        metaObject.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;updateUser&quot;</span>,<span class="hljs-title class_">BaseContext</span>.<span class="hljs-title function_">getCurrentId</span>());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="新增分类"><a href="#新增分类" class="headerlink" title="新增分类"></a>新增分类</h3><h4 id="需求分析-5"><a href="#需求分析-5" class="headerlink" title="需求分析"></a>需求分析</h4><p>后台系统中可以管理分类信息，分类包括两种类型，分别是菜品分类和套餐分类。当我们在后台系统中添加菜品时需要选择一个菜品分类，当我们在后台系统中添加一个套餐时需要选择一个套餐分类，在移动端也会按照菜品分类和套餐分类来展示对应的菜品和套餐。</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030021853.png" srcset="/img/loading.gif" lazyload alt="image"><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030021858.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="数据模型-1"><a href="#数据模型-1" class="headerlink" title="数据模型"></a>数据模型</h4><p>新增分类，其实就是将我们新增窗口录入的分类数据插入到category表，表结构如下:</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030021881.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="代码开发-5"><a href="#代码开发-5" class="headerlink" title="代码开发"></a>代码开发</h4><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好:</p>
<ul>
<li>实体类Category(直接从课程资料中导入即可)</li>
<li>每个实体类对应数据库中每个表，这个对应的是分类表，上一个实体类对应的是员工表</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 分类，对应的是category菜品分类表的字段</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Category</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Long id;<br><br><br>    <span class="hljs-comment">//类型 1 菜品分类 2 套餐分类</span><br>    <span class="hljs-keyword">private</span> Integer type;<br><br><br>    <span class="hljs-comment">//分类名称</span><br>    <span class="hljs-keyword">private</span> String name;<br><br><br>    <span class="hljs-comment">//顺序</span><br>    <span class="hljs-keyword">private</span> Integer sort;<br><br><br>    <span class="hljs-comment">//创建时间</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><br>    <span class="hljs-comment">//更新时间</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br>    <span class="hljs-comment">//创建人</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Long createUser;<br><br><br>    <span class="hljs-comment">//修改人</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Long updateUser;<br><br><br>    <span class="hljs-comment">//是否删除</span><br>    <span class="hljs-keyword">private</span> Integer isDeleted;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Mapper接口CategoryMapper，相对应的每个数据表的实体类对应一个接口（数据层的Mapper接口用来操作对应表）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CategoryMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Category&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>业务层接口CategoryService（对应表的业务层）</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">CategoryService</span> <span class="hljs-title">extends</span> <span class="hljs-title">IService</span>&lt;<span class="hljs-title">Category</span>&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>业务层实现类CategoryServicelmpl</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryServicelmpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;CategoryMapper</span>, <span class="hljs-title">Category&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">CategoryService</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>控制层CategoryController（对应表的Controller）</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  分类管理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-variable">@RestController</span><br><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/category&quot;</span>) <span class="hljs-comment">// 前端点击分类管理的按钮，会执行对应请求，后端接收这个url请求</span><br><span class="hljs-variable">@Slf4j</span><br>public class CategoryController &#123;<br>    <br>    <br>    <span class="hljs-variable">@Autowired</span><br>    private CategoryService categoryService; <span class="hljs-comment">// 注入业务层接口对象，可以从表现层调用业务层</span><br>    <br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>在开发代码之前，需要梳理一下整个程序的执行过程:</p>
<p>1、页面(backend&#x2F;page&#x2F;category&#x2F;list.html)发送ajax请求，将新增分类窗口输入的数据以json形式提交到服务端</p>
<p>2、服务端Controller接收页面提交的数据并调用Service将数据进行保存</p>
<p>3、Service调用Mapper操作数据库，保存数据</p>
<p>可以看到新增菜品分类和新增套餐分类请求的服务端地址和提交的json数据结构相同，所以服务端只需要提供一个方法统一处理即可<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030022293.png" srcset="/img/loading.gif" lazyload alt="image"><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030022307.png" srcset="/img/loading.gif" lazyload alt="image"><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030022300.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  新增分类</span><br><span class="hljs-comment"> * @param category</span><br><span class="hljs-comment"> * @return</span><br><span class="hljs-comment"> */</span><br><span class="hljs-variable">@PostMapping</span><br>public R&lt;String&gt; save(<span class="hljs-variable">@RequestBody</span> Category category)&#123;<br>    <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">&quot;category: &#123;&#125;&quot;</span>,category);<span class="hljs-comment">// 打印这个从前端接收过来的对象</span><br>    <span class="hljs-comment">// 调用业务层，添加菜品分类（将从前端接收过来的对象传给业务层</span><br>    <span class="hljs-selector-tag">categoryService</span><span class="hljs-selector-class">.save</span>(category);<br><br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">&quot;新增分类成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="分类信息分页查询"><a href="#分类信息分页查询" class="headerlink" title="分类信息分页查询"></a>分类信息分页查询</h3><h4 id="需求分析-6"><a href="#需求分析-6" class="headerlink" title="需求分析"></a>需求分析</h4><p>系统中的分类很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。</p>
<h4 id="代码开发-6"><a href="#代码开发-6" class="headerlink" title="代码开发"></a>代码开发</h4><p>在开发代码之前，需要梳理一下整个程序的执行过程:</p>
<p>1、点击页面分类管理按钮后：页面发送ajax请求，将分页查询参数(page.pageSize)提交到服务端</p>
<p>2、服务端Controller接收页面提交的数据并调用Service查询数据</p>
<p>3、Service调用Mapper操作数据库，查询分页数据</p>
<p>4、Controller将查询到的分页数据响应给页面</p>
<p>5、页面接收到分页数据并通过ElementUI的Table组件展示到页面上<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030022490.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  分页查询</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page 起始页码</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageSize 每页显示多少条记录</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-comment">// 返回R对象的Page类型对象的数据，所以泛型写Page</span><br><span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize)</span>&#123; <span class="hljs-comment">// 请求体中的参数不是Json格式的，所以不用加@RequestBody注解</span><br>    <span class="hljs-comment">// 创建分页构造器对象 这个分页构造器对象存储的是Category实体类对象，所以泛型也实体类</span><br>    Page&lt;Category&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, pageSize);<br><br>    <span class="hljs-comment">// 条件构造器, 为了给菜品排序</span><br>    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">// 添加排序条件，根据sort进行升序排序</span><br>    <span class="hljs-comment">// queryWrapper条件构造器相当于是生成一个sql语句，queryWrapper. 后面接的是一个方法（这里是排序方法），</span><br>    <span class="hljs-comment">// 然后参数写实体类对应的方法 -- 根据什么来升序排序，这里根据实体类中的Sort属性</span><br>    queryWrapper.orderByAsc(Category::getSort); <span class="hljs-comment">// 这里相当于生成了一个条件sql</span><br><br>    <span class="hljs-comment">// 进行分页查询</span><br>    categoryService.page(pageInfo,queryWrapper); <span class="hljs-comment">// 执行业务层分页查询的方法，页面条数信息和查询条件</span><br>    <span class="hljs-comment">// 将分页的对象返回给R，然后返回给前端</span><br>    <span class="hljs-keyword">return</span> R.success(pageInfo);<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p><strong>注意</strong>：要把Category中的<code>private Integer isDeleted;</code>注释掉才能查询到数据</p>
<h3 id="删除分类"><a href="#删除分类" class="headerlink" title="删除分类"></a>删除分类</h3><h4 id="需求分析-7"><a href="#需求分析-7" class="headerlink" title="需求分析"></a>需求分析</h4><p>在分类管理列表页面，可以对某个分类进行删除操作。需要注意的是当分类关联了菜品或者套餐时，此分类不允许删除。</p>
<h4 id="代码开发-7"><a href="#代码开发-7" class="headerlink" title="代码开发"></a>代码开发</h4><p>在开发代码之前，需要梳理一下整个程序的执行过程:</p>
<p>1、页面发送ajax请求，将参数(id)提交到服务端<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208030022326.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>2、服务端Controller接收页面提交的数据并调用Service删除数据</p>
<p>3、Service调用Mapper操作数据库</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  根据Id删除分类</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ids,url中的参数ids</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@DeleteMapping</span><span class="hljs-comment">// 不是restful风格（/users/&#123;id&#125;），所以不用加@PathVariable注解</span><br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">delete</span>(<span class="hljs-params">Long ids</span>)&#123; <span class="hljs-comment">// 这里不是restful风格，因为是（调用了category方法后）URL携带的 ？后面接的参数</span><br>                <span class="hljs-comment">// http://localhost:8080/category?ids=1397844263642378242</span><br>    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;删除分类，id为：&#123;&#125;&quot;</span>,ids);<br>    <span class="hljs-comment">// 调用业务层接口，执行数据层，操作数据库</span><br>    categoryService.<span class="hljs-title function_">removeById</span>(ids);<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;删除成功&quot;</span>);<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h4 id="代码完善"><a href="#代码完善" class="headerlink" title="代码完善"></a>代码完善</h4><p>前面我们已经实现了根据id删除分类的功能，但是并没有检查删除的分类是否关联了菜品或者套餐，所以我们需要进行功能完善。</p>
<p>要完善分类删除功能，需要先准备基础的类和接口:</p>
<p>1、实体类Dish和Setmeal （从课程资料中复制即可) – &#x3D;&#x3D;创建完实体类后，就是创建数据层接口，在到业务层&#x3D;&#x3D;</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dish</span> <span class="hljs-title">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;<br><br><br>    <span class="hljs-comment">//菜品名称</span><br>    <span class="hljs-keyword">private</span> String name;<br><br><br>    <span class="hljs-comment">//菜品分类id</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> categoryId;<br><br><br>    <span class="hljs-comment">//菜品价格</span><br>    <span class="hljs-keyword">private</span> BigDecimal price;<br><br><br>    <span class="hljs-comment">//商品码</span><br>    <span class="hljs-keyword">private</span> String code;<br><br><br>    <span class="hljs-comment">//图片</span><br>    <span class="hljs-keyword">private</span> String image;<br><br><br>    <span class="hljs-comment">//描述信息</span><br>    <span class="hljs-keyword">private</span> String description;<br><br><br>    <span class="hljs-comment">//0 停售 1 起售</span><br>    <span class="hljs-keyword">private</span> Integer status;<br><br><br>    <span class="hljs-comment">//顺序</span><br>    <span class="hljs-keyword">private</span> Integer sort;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> createUser;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> updateUser;<br><br><br>    <span class="hljs-comment">//是否删除</span><br>    <span class="hljs-keyword">private</span> Integer isDeleted;<br><br>&#125;<br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Setmeal</span> <span class="hljs-title">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;<br><br><br>    <span class="hljs-comment">//分类id</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> categoryId;<br><br><br>    <span class="hljs-comment">//套餐名称</span><br>    <span class="hljs-keyword">private</span> String name;<br><br><br>    <span class="hljs-comment">//套餐价格</span><br>    <span class="hljs-keyword">private</span> BigDecimal price;<br><br><br>    <span class="hljs-comment">//状态 0:停用 1:启用</span><br>    <span class="hljs-keyword">private</span> Integer status;<br><br><br>    <span class="hljs-comment">//编码</span><br>    <span class="hljs-keyword">private</span> String code;<br><br><br>    <span class="hljs-comment">//描述信息</span><br>    <span class="hljs-keyword">private</span> String description;<br><br><br>    <span class="hljs-comment">//图片</span><br>    <span class="hljs-keyword">private</span> String image;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> createUser;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> updateUser;<br><br><br>    <span class="hljs-comment">//是否删除</span><br>    <span class="hljs-keyword">private</span> Integer isDeleted;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2、Mapper接口DishMapper和SetmealMapper – &#x3D;&#x3D;这里的Setmeal可以理解为套餐的意思&#x3D;&#x3D;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Dish&gt; &#123;<br>&#125;<br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Setmeal&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>3、Service接口DishService和SetmealService</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">DishService</span> <span class="hljs-title">extends</span> <span class="hljs-title">IService</span>&lt;<span class="hljs-title">Dish</span>&gt; &#123;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">SetmealService</span> <span class="hljs-title">extends</span> <span class="hljs-title">IService</span>&lt;<span class="hljs-title">Setmeal</span>&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>4、Service实现类DishServicelmpl和SetmealServicelmpl  – 如果创建业务层接口对象要用日志功能，可以在实现类中添加@Slf4j</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DishServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;DishMapper</span>, <span class="hljs-title">Dish&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">DishService</span> </span>&#123;<br>&#125;<br><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SetmealServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;SetmealMapper</span>, <span class="hljs-title">Setmeal&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">SetmealService</span></span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h4><ul>
<li>在CategoryService添加remove方法</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">CategoryService</span> <span class="hljs-title">extends</span> <span class="hljs-title">IService</span>&lt;<span class="hljs-title">Category</span>&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span>(<span class="hljs-params">Long id</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>在CategoryServicelmpl实现remove方法</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;CategoryMapper</span>, <span class="hljs-title">Category&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">CategoryService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">DishService</span> dishService; <span class="hljs-comment">// 注入菜品dish业务层接口对象</span><br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">SetmealService</span> setmealService; <span class="hljs-comment">// 创建Setmeal套餐的业务层接口对象</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  根据id删除分类，删除之前需要进行判断</span><br><span class="hljs-comment">     * @param id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    public void remove(<span class="hljs-type">Long</span> id) &#123;<br><span class="hljs-comment">//        创建查询菜品实体类dish类条件的对象</span><br>        <span class="hljs-type">LambdaQueryWrapper</span>&lt;<span class="hljs-type">Dish</span>&gt; dishLambdaQueryWrapper= <span class="hljs-keyword">new</span> <span class="hljs-type">LambdaQueryWrapper</span>&lt;&gt;();<br>        <span class="hljs-comment">// 添加查询条件，根据分类id进行查询 这里是等值查询所以用eq ：相当于sql：where ？ = ？</span><br>        <span class="hljs-comment">// 在数据库相当于执行的语句是：select count(*) from dish where category_id = #&#123;id&#125;; -- 后面这个id是传入的参数id</span><br>        dishLambdaQueryWrapper.eq(<span class="hljs-type">Dish</span>::getCategoryId,id);<br>        <span class="hljs-comment">// 符合条件查询的菜品数（行数），调用菜品dish的业务层接口的count方法，参数为queryWrapper条件</span><br>        int count1 = dishService.count(dishLambdaQueryWrapper);<br><br>        <span class="hljs-comment">// 查询当前分类是否关联了菜品，如果已经关联，抛出一个业务异常</span><br>        <span class="hljs-keyword">if</span> (count1 &gt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">// 已经关联了菜品，抛出一个业务异常</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">CustomException</span>(<span class="hljs-string">&quot;当前分类下关联了菜品，不能删除&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// 查询当前分类是否关联了套餐，如果已经关联，抛出一个业务异常</span><br><br>        <span class="hljs-type">LambdaQueryWrapper</span>&lt;<span class="hljs-type">Setmeal</span>&gt; setmealLambdaQueryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-type">LambdaQueryWrapper</span>&lt;&gt;();<br>        <span class="hljs-comment">// 添加查询条件，根据分类id进行查询</span><br>        setmealLambdaQueryWrapper.eq(<span class="hljs-type">Setmeal</span>::getCategoryId,id);<br>        <span class="hljs-comment">// 根据条件，查询符合套餐数（行数）</span><br>        int count2 = setmealService.count(setmealLambdaQueryWrapper);<br>        <span class="hljs-keyword">if</span> (count2 &gt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">// 已经关联套餐，抛出一个业务异常</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">CustomException</span>(<span class="hljs-string">&quot;当前分类下关联了套餐，不能删除&quot;</span>);<br><br>        &#125;<br><br>        <span class="hljs-comment">// 正常删除分类</span><br>        <span class="hljs-keyword">super</span>.removeById(id); <span class="hljs-comment">// super是父类方法</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>定义异常类CustomException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  自定义业务异常类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span>&#123; <span class="hljs-comment">// 继承运行时异常类，要使用他的方法</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CustomException</span><span class="hljs-params">(String message)</span>&#123; <span class="hljs-comment">// 定义有参构造器，当创建对象时：给参数，就会调用父类构造器传进去</span><br>        <span class="hljs-built_in">super</span>(message); <span class="hljs-comment">// 父类构造器</span><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>在全局异常处理器<strong>GlobalExceptionHandler</strong>添加</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  异常处理方法 -- 处理 自定义的CustomException</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ExceptionHandler</span>(<span class="hljs-title class_">CustomException</span>.<span class="hljs-property">class</span>) <span class="hljs-comment">// 拦截异常，拦截类型为sql异常</span><br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">exceptionHandler</span>(<span class="hljs-params">CustomException ex</span>)&#123;<br>    <span class="hljs-comment">//  日志输出异常打印信息</span><br>    log.<span class="hljs-title function_">error</span>(ex.<span class="hljs-title function_">getMessage</span>()); <span class="hljs-comment">// 这里是调用父类的方法</span><br><br><br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">error</span>(ex.<span class="hljs-title function_">getMessage</span>());<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="修改分类"><a href="#修改分类" class="headerlink" title="修改分类"></a>修改分类</h3><h4 id="需求分析-8"><a href="#需求分析-8" class="headerlink" title="需求分析"></a>需求分析</h4><p>在分类管理列表页面点击修改按钮，弹出修改窗口，在修改窗口回显分类信息并进行修改，最后点击确定按钮完成修改操作</p>
<h4 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs less"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  根据id修改分类信息</span><br><span class="hljs-comment"> * @param category // 将传过来的json数据，封装成category对象</span><br><span class="hljs-comment"> * @return</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-variable">@PutMapping</span> <span class="hljs-comment">// 请求的路径是http://localhost:8080/category</span><br><br>                            <span class="hljs-comment">// 这里是将参数封装成category对象</span><br>public R&lt;String&gt; update(<span class="hljs-variable">@RequestBody</span> Category category)&#123; <span class="hljs-comment">// 由于请求体中是json格式，所以用@RequestBody注解接收</span><br><br>    <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">&quot;修改分类信息：&#123;&#125;&quot;</span>, category);<br><br>    <span class="hljs-selector-tag">categoryService</span><span class="hljs-selector-class">.updateById</span>(category); <span class="hljs-comment">// 调用业务层的方法，修改前端传过来的json参数</span><br><br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">&quot;修改分类信息成功&quot;</span>);<br></code></pre></td></tr></table></figure>





<h1 id="瑞吉外卖开发笔记-四"><a href="#瑞吉外卖开发笔记-四" class="headerlink" title="瑞吉外卖开发笔记 四"></a>瑞吉外卖开发笔记 四</h1><p>笔记内容为<strong>黑马程序员</strong>视频内容</p>
<h2 id="菜品管理业务开发"><a href="#菜品管理业务开发" class="headerlink" title="菜品管理业务开发"></a>菜品管理业务开发</h2><h3 id="文件上传下载"><a href="#文件上传下载" class="headerlink" title="文件上传下载"></a>文件上传下载</h3><h4 id="文件上传介绍"><a href="#文件上传介绍" class="headerlink" title="文件上传介绍"></a>文件上传介绍</h4><p>文件上传，也称为upload，是指将本地图片、视频、音频等文件上传到服务器上，可以供其他用户浏览或下载的过程。文件上传在项目中应用非常广泛，我们经常发微博、发微信朋友圈都用到了文件上传功能。</p>
<p>文件上传时，对页面的form表单有如下要求:</p>
<ul>
<li>method&#x3D;”post” 　　　　　　　　　　　采用post方式提交数据</li>
<li>enctype&#x3D;”multipart&#x2F;form-data” 　　　　采用multipart格式上传文件</li>
<li>type&#x3D;”file”　　　　　　　　　　　　 　使用input的file控件上传<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318093.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<p>目前一些前端组件库也提供了相应的上传组件，但是底层原理还是基于form表单的文件上传。例如ElementUI中提供的upload上传组件:<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318046.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>服务端要接收客户端页面上传的文件，通常都会使用Apache的两个组件:</p>
<ul>
<li>commons-fileupload</li>
<li>commons-io</li>
</ul>
<p>Spring框架在spring-web包中对文件上传进行了封装，大大简化了服务端代码，我们只需要在Controller的方法中声明一个MultipartFile类型的参数即可接收上传的文件。</p>
<h4 id="文件下载介绍"><a href="#文件下载介绍" class="headerlink" title="文件下载介绍"></a>文件下载介绍</h4><p>文件下载，也称为download，是指将文件从服务器传输到本地计算机的过程。<br>通过浏览器进行文件下载，通常有两种表现形式:</p>
<ul>
<li>以附件形式下载，弹出保存对话框，将文件保存到指定磁盘目录</li>
<li>直接在浏览器中打开</li>
</ul>
<p>通过浏览器进行文件下载，本质上就是服务端将文件以流的形式写回浏览器的过程。</p>
<h4 id="文件上传代码实现"><a href="#文件上传代码实现" class="headerlink" title="文件上传代码实现"></a>文件上传代码实现</h4><p>文件上传，页面端可以使用ElementuI提供的上传组件。<br>可以直接使用资料中提供的上传页面，位置:资料&#x2F;文件上传下载页面&#x2F;upload.html</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>文件上传<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 引入样式 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../plugins/element-ui/index.css&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../styles/common.css&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../styles/page.css&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;shortcut icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../favicon.ico&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;addBrand-container&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;food-add-app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-upload</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar-uploader&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/common/upload&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">:show-file-list</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">:on-success</span>=<span class="hljs-string">&quot;handleAvatarSuccess&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">:before-upload</span>=<span class="hljs-string">&quot;beforeUpload&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;upload&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;imageUrl&quot;</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;imageUrl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">img</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-icon-plus avatar-uploader-icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-upload</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 开发环境版本，包含了有帮助的命令行警告 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../plugins/vue/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入组件库 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../plugins/element-ui/index.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入axios --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../plugins/axios/axios.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../js/index.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#food-add-app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">imageUrl</span>: <span class="hljs-string">&#x27;&#x27;</span></span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          handleAvatarSuccess (response, file, fileList) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageUrl</span> = <span class="hljs-string">`/common/download?name=<span class="hljs-subst">$&#123;response.data&#125;</span>`</span></span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          beforeUpload (file) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">if</span>(file)&#123;</span><br><span class="language-javascript">              <span class="hljs-keyword">const</span> suffix = file.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>]</span><br><span class="language-javascript">              <span class="hljs-keyword">const</span> size = file.<span class="hljs-property">size</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> &lt; <span class="hljs-number">2</span></span><br><span class="language-javascript">              <span class="hljs-keyword">if</span>([<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;jpeg&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>].<span class="hljs-title function_">indexOf</span>(suffix) &lt; <span class="hljs-number">0</span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;上传图片只支持 png、jpeg、jpg 格式！&#x27;</span>)</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">upload</span>.<span class="hljs-title function_">clearFiles</span>()</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="language-javascript">              &#125;</span><br><span class="language-javascript">              <span class="hljs-keyword">if</span>(!size)&#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;上传文件大小不能超过 2MB!&#x27;</span>)</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="language-javascript">              &#125;</span><br><span class="language-javascript">              <span class="hljs-keyword">return</span> file</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>添加CommonController,负责文件上传与下载</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  文件上传和下载</span><br><span class="hljs-comment"> */</span><br><span class="hljs-variable">@RestController</span><br><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/common&quot;</span>)<br><span class="hljs-variable">@Slf4j</span><br>public class CommonController &#123;<br><br><br>    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/upload&quot;</span>)<br><span class="hljs-comment">//    在Controller的方法中声明一个MultipartFile接口类型的参数即可接收上传的文件。</span><br>    public R&lt;String&gt; upload(MultipartFile file)&#123; <span class="hljs-comment">// 这里的参数名要和前端发送的文件名（name = file）一致</span><br>        <span class="hljs-comment">// file是一个临时文件，需要转存到指定位置，否则本次请求完成后临时文件会删除</span><br>        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(file.toString()); <span class="hljs-comment">// 打印前端上传过来的file对象</span><br>        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">null</span>;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>MultipartFile定义的file变量必须与name保持一致<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318011.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>完整代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  文件上传和下载</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">&quot;/common&quot;</span>)<br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonController</span> &#123;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  文件上传</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-comment">// 定义一个存储路径的遍历</span><br>    <span class="hljs-comment">// 使用@Value这个注解会注入配置文件对应的值，赋值给basePath遍历</span><br>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">&quot;$&#123;reggie.path&#125;&quot;</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> basePath;<br><br><br>    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/upload&quot;</span>)<br><span class="hljs-comment">//    在Controller的方法中声明一个MultipartFile接口类型的参数即可接收上传的文件。</span><br>    <span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">upload</span>(<span class="hljs-params">MultipartFile file</span>)&#123; <span class="hljs-comment">// 这里的参数名要和前端发送的文件名（name = file）一致</span><br>        <span class="hljs-comment">// file是一个临时文件，需要转存到指定位置，否则本次请求完成后临时文件会删除</span><br>        log.<span class="hljs-title function_">info</span>(file.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 打印前端上传过来的file对象</span><br><br>        <span class="hljs-comment">// 获取原始文件名</span><br>        <span class="hljs-title class_">String</span> originalFilename = file.<span class="hljs-title function_">getOriginalFilename</span>(); <span class="hljs-comment">// xxx.jpg</span><br>        <span class="hljs-comment">// 获取后缀名：  xxx.jpg</span><br>        <span class="hljs-comment">// String类中的substring方法，可以从传入的索引处截取，截取到末尾，得到新的字符串</span><br>        <span class="hljs-comment">// lastIndexOf是返回指定字符在此字符串中最后一次出现处的索引</span><br>        <span class="hljs-title class_">String</span> suffix = originalFilename.<span class="hljs-title function_">substring</span>(originalFilename.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&quot;.&quot;</span>)); <span class="hljs-comment">// 得到后缀</span><br><br>        <span class="hljs-comment">// 使用UUID重新生成文件名，防止文件名称重复造成文件覆盖</span><br>        <span class="hljs-comment">//UUID：通用唯一识别码，保证唯一性</span><br>        <span class="hljs-comment">// 随机生成的UUID + 后缀即可</span><br>        <span class="hljs-title class_">String</span> fileName = <span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>() + suffix;<span class="hljs-comment">// dsfdss.jpg</span><br><br>        <span class="hljs-comment">// 创建一个目录对象</span><br>        <span class="hljs-title class_">File</span> dir = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath); <span class="hljs-comment">// 这个路径写配置文件中的路径</span><br>        <span class="hljs-comment">// 判断当前目录是否存在</span><br>        <span class="hljs-keyword">if</span> (!dir.<span class="hljs-title function_">exists</span>())&#123;<br>            <span class="hljs-comment">// 如果目录不存在，需要创建</span><br>            dir.<span class="hljs-title function_">mkdir</span>();<br>        &#125;<br><br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 将临时文件转存到指定位置</span><br><span class="hljs-comment">//            file.transferTo(new File(&quot;C:\\Users\\aufs\\UserFile\\hello.jpg&quot;));// 这个相当于把这个图片名字写死了</span><br>            file.<span class="hljs-title function_">transferTo</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath + fileName));<br>        &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">IOException</span> e) &#123;<br>            e.<span class="hljs-title function_">printStackTrace</span>();<br>        &#125;<br><br><br>        <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(fileName); <span class="hljs-comment">// 将文件名返回给前端</span><br><br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="文件下载代码实现"><a href="#文件下载代码实现" class="headerlink" title="文件下载代码实现"></a>文件下载代码实现</h4><p>文件下载，页面端可以使用<img src="/" srcset="/img/loading.gif" lazyload alt="img">标签展示下载的图片<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318049.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  文件下载</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> name 文件名</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response 响应对象，通过响应对象可以创建其对应的输出流，将文件写回浏览器，在浏览器展示图片</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/download&quot;)</span> <span class="hljs-comment">// 这个是前端的路径</span><br><span class="hljs-comment">// 定义一个文件下载的方法，下载的路径和前端代码一致</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">download</span><span class="hljs-params">(String name, HttpServletResponse response)</span>&#123;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 创建一个输入流对象，通过输入流读取文件内容</span><br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath + name));<br><br>        <span class="hljs-comment">// 创建一个输出流对象，通过输出流将文件写回浏览器，在浏览器展示图片</span><br>        <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> response.getOutputStream();<br><br>        <span class="hljs-comment">// 设置响应的内容类型  图片格式</span><br>        response.setContentType(<span class="hljs-string">&quot;image/jpeg&quot;</span>);<br><br>        <span class="hljs-comment">// 输入流去读，读到的数据去写</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 定义一个初始的长度length</span><br>        <span class="hljs-comment">// 创建一个字节数组对象长度为1024，通过这个长度，可以让输入流，每次读1MB</span><br>        <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>        <span class="hljs-keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="hljs-number">1</span>)&#123; <span class="hljs-comment">// 这里不等于-1 的意思是没有读完，就执行下面的语句（读完了是-1）</span><br>            <span class="hljs-comment">// 读到多少，就往浏览器写多少，从0开始写，写完len这个全部长度</span><br>            outputStream.write(bytes,<span class="hljs-number">0</span>,len);<br>            outputStream.flush(); <span class="hljs-comment">// 刷新流</span><br>        &#125;<br><br>        <span class="hljs-comment">// 关闭两个流</span><br>        outputStream.close();<br>        fileInputStream.close();<br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="新增菜品"><a href="#新增菜品" class="headerlink" title="新增菜品"></a>新增菜品</h3><h4 id="需求分析-9"><a href="#需求分析-9" class="headerlink" title="需求分析"></a>需求分析</h4><p>后台系统中可以管理菜品信息，通过新增功能来添加一个新的菜品，在添加菜品时需要选择当前菜品所属的菜品分类,并且需要上传菜品图片，在移动端会按照菜品分类来展示对应的菜品信息。<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318043.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="数据模型-2"><a href="#数据模型-2" class="headerlink" title="数据模型"></a>数据模型</h4><p>新增菜品，其实就是将新增页面录入的菜品信息插入到dish表，如果添加了口味做法，还需要向dish_flavor表插入数据。所以在新增菜品时，涉及到两个表:</p>
<ul>
<li>dish(菜品表)<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318064.png" srcset="/img/loading.gif" lazyload alt="image"></li>
<li>dish_flavor(菜品口味表)<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318624.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<h4 id="代码开发-准备工作"><a href="#代码开发-准备工作" class="headerlink" title="代码开发-准备工作"></a>代码开发-准备工作</h4><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好:</p>
<ul>
<li>实体类DishFlavor(直接从课程资料中导入即可，Dish实体前面课程中已经导入过了)</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DishFlavor</span> <span class="hljs-title">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;<br><br><br>    <span class="hljs-comment">//菜品id</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> dishId;<br><br><br>    <span class="hljs-comment">//口味名称</span><br>    <span class="hljs-keyword">private</span> String name;<br><br><br>    <span class="hljs-comment">//口味数据list</span><br>    <span class="hljs-keyword">private</span> String value;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> createUser;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> updateUser;<br><br><br>    <span class="hljs-comment">//是否删除</span><br>    <span class="hljs-keyword">private</span> Integer isDeleted;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Mapper接口DishFlavorMapper</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishFlavorMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;DishFlavor&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>业务层接口DishFlavorService</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">DishFlavorService</span> <span class="hljs-title">extends</span> <span class="hljs-title">IService</span>&lt;<span class="hljs-title">DishFlavor</span>&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>业务层实现类 DishFlavorServicelmpl</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DishFlavorServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;DishFlavorMapper</span>, <span class="hljs-title">DishFlavor&gt;implements</span> <span class="hljs-title">DishFlavorService</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>控制层 DishController</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RestController</span><br><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/dish&quot;</span>)<br>public class DishController &#123;<br>    <span class="hljs-variable">@Autowired</span><br>    private DishService dishService;<br>    <span class="hljs-variable">@Autowired</span><br>    private DishFlavorService dishFlavorService;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="代码开发-梳理交互过程"><a href="#代码开发-梳理交互过程" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下新增菜品时前端页面和服务端的交互过程:</p>
<p>1、页面(backend&#x2F;page&#x2F;food&#x2F;add.html)发送ajax请求，请求服务端获取菜品分类数据并展示到下拉框中</p>
<p>2、页面发送请求进行图片上传，请求服务端将图片保存到服务器</p>
<p>3、页面发送请求进行图片下载，将上传的图片进行回显</p>
<p>4、点击保存按钮，发送ajax请求，将菜品相关数据以json形式提交到服务端</p>
<p>开发新增菜品功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可。</p>
<p><strong>菜品分类下拉框</strong>：在CategoryController添加</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  根据条件查询分类数据</span><br><span class="hljs-comment"> * @param category 将type参数封装称category实体类作为参数</span><br><span class="hljs-comment"> * @return</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/list&quot;</span>)<br><br>                            <span class="hljs-comment">// 将参数type，用category对象来封装</span><br>                            <span class="hljs-comment">// 对应：http://localhost:8080/category/list?type=1</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">R</span>&lt;<span class="hljs-type">List</span>&lt;<span class="hljs-type">Category</span>&gt;&gt; list(<span class="hljs-type">Category</span> category)&#123; <span class="hljs-comment">// 返回的是一个list集合 -- 查询菜品分类</span><br><br>    <span class="hljs-comment">// 条件构造器</span><br>    <span class="hljs-type">LambdaQueryWrapper</span>&lt;<span class="hljs-type">Category</span>&gt; queryWrapper <span class="hljs-operator">=</span> new <span class="hljs-type">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">// 添加条件</span><br>    <span class="hljs-comment">// 从前端得到的参数中的type属性（对应数据库字段）不为null，执行后面语句</span><br>    <span class="hljs-comment">// 条件生成： 实体类中的type = 参数中的type值（例如type = 1）</span><br>    queryWrapper.eq(category.getType() <span class="hljs-operator">!=</span> null,Category::getType,category.getType());<br>    <span class="hljs-comment">// 添加排序条件</span><br>    <span class="hljs-comment">// 条件生成：根据sort字段升序排序，根据UpdateTime字段倒叙排序</span><br>    queryWrapper.orderByAsc(Category::getSort).orderByDesc(Category::getUpdateTime);<br><br>    <span class="hljs-comment">// 使用业务层的list方法，查询数据库  得到符合条件type =1 为  菜品分类的集合</span><br>    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Category</span>&gt; list <span class="hljs-operator">=</span> categoryService.list(queryWrapper);<br><br>    <span class="hljs-comment">// 将查询到的list集合对象，返回给前端页面</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-type">R</span>.success(list);<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>导入DishDto（位置:资料&#x2F;dto)，用于封装页面提交的数据</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Data</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DishDto</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Dish</span> </span>&#123; <span class="hljs-comment">// 继承了Dish这个实体类（扩展了Dish实体类中的属性和方法)</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">DishFlavor</span>&gt; flavors = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> categoryName;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> copies;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>注意</strong>：&#x3D;&#x3D;DTO，全称为Data Transfer object，即数据传输对象，一般用于展示层与服务层之间的数据传输。&#x3D;&#x3D;（DTO最大作用是用于多表查询，简化了操作）</p>
<p>新增菜品同时插入菜品对应的口味数据,需要操作两张表：dish、dishflavor</p>
<p>在DishService接口中添加方法saveWithFlavor,在DishServiceImpl实现</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DishServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;DishMapper</span>, <span class="hljs-title">Dish&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">DishService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">DishFlavorService</span> dishFlavorService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Transactional</span><br>    public void saveWithFlavor(<span class="hljs-type">DishDto</span> dishDto) &#123;<br>        <span class="hljs-comment">//保存菜品基本信息到菜品表dish</span><br>        <span class="hljs-keyword">this</span>.save(dishDto);<br><br>        <span class="hljs-type">Long</span> dishid = dishDto.getId();<br>        <span class="hljs-comment">//菜品口味</span><br>        <span class="hljs-type">List</span>&lt;<span class="hljs-type">DishFlavor</span>&gt; flavors = dishDto.getFlavors();<br>        flavors = flavors.stream().map((item) -&gt; &#123;<br>            item.setDishId(dishid);<br>            <span class="hljs-keyword">return</span> item;<br>        &#125;).collect(<span class="hljs-type">Collectors</span>.toList());<br>        <span class="hljs-comment">//dishFlavorService.saveBatch(dishDto.getFlavors());</span><br>        <span class="hljs-comment">//保存菜品口味到菜品数据表dish_flavor</span><br>        dishFlavorService.saveBatch(flavors);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>由于以上代码涉及多表操作，<strong>在启动类上开启事务支持</strong>添加<code>@EnableTransactionManagement</code>注解，但是本人添加该注解会报错，项目启动会失败，并且springboot该注解应该是默认开启的，故没有添加</p>
<p>新增菜品</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PostMapping</span><br>public R&lt;String&gt; save(<span class="hljs-variable">@RequestBody</span> DishDto dishDto)&#123;<br>    <span class="hljs-selector-tag">dishService</span><span class="hljs-selector-class">.saveWithFlavor</span>(dishDto);<br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">&quot;新增菜品成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="菜品信息分页查询"><a href="#菜品信息分页查询" class="headerlink" title="菜品信息分页查询"></a>菜品信息分页查询</h3><h4 id="需求分析-10"><a href="#需求分析-10" class="headerlink" title="需求分析"></a>需求分析</h4><p>系统中的菜品数据很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318669.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="代码开发-梳理交互过程-1"><a href="#代码开发-梳理交互过程-1" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下菜品分页查询时前端页面和服务端的交互过程:</p>
<p>1、页面(backend&#x2F;page&#x2F;food&#x2F;list.html)发送ajax请求，将分页查询参数(page、pageSize、name)提交到服务端，获取分页数据</p>
<p>2、页面发送请求，请求服务端进行图片下载，用于页面图片展示</p>
<p>开发菜品信息分页查询功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p>
<p>请求URL：</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208070404255.png" srcset="/img/loading.gif" lazyload alt="image-20220807040431182"></p>
<p>Page类中的records（记录的意思）属性，是一个列表集合，这个参数是前端页面展现出来的数据，承载的集合，– 后面将其遍历，将遍历后对象赋值给dishDto这个多表关联的实体类  </p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080017255.png" srcset="/img/loading.gif" lazyload alt="image-20220808001742097"></p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080020977.png" srcset="/img/loading.gif" lazyload alt="image-20220808002022889"></p>
<p>由于请求体中含有属性：categoryName（分类名称）    copies（副本的意思）</p>
<p>所以在对应的实体类DishDto中也添加了对应属性，用来接收前端传过来的数据</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208070410526.png" srcset="/img/loading.gif" lazyload alt="image-20220807041050444"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, String name)</span> &#123;<br>  <span class="hljs-comment">//构造分页构造器</span><br>  Page&lt;Dish&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, pageSize);<br><br>  Page&lt;DishDto&gt; dishDtoPage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;();<br><br>  <span class="hljs-comment">//构造条件构造器</span><br>  LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br><br>  <span class="hljs-comment">//添加过滤条件</span><br>  queryWrapper.like(!StringUtils.isEmpty(name), Dish::getName, name);<br><br>  <span class="hljs-comment">//添加排序条件</span><br>  queryWrapper.orderByDesc(Dish::getUpdateTime);<br><br>  <span class="hljs-comment">//进行分页查询</span><br>  dishService.page(pageInfo, queryWrapper);<br><br>  <span class="hljs-comment">//对象拷贝 -- 将源对象pageInfo中的属性，拷贝一份到dishDtoPage对象中去，排除pageInfo中的records属性，单独处理这个属性</span><br>  BeanUtils.copyProperties(pageInfo,dishDtoPage,<span class="hljs-string">&quot;records&quot;</span>); <span class="hljs-comment">// 第三个参数是排除records属性</span><br><br>  List&lt;Dish&gt; records = pageInfo.getRecords();<span class="hljs-comment">// 拿到records属性，进行处理（因为records是一个集合，</span><br>    <span class="hljs-comment">// 遍历其属性records</span><br>  List&lt;DishDto&gt; list=records.stream().map((item)-&gt;&#123;<br>    DishDto dishDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DishDto</span>();<br><span class="hljs-comment">//  将遍历到的对象，拷贝一份到dishDto对象中去</span><br>    BeanUtils.copyProperties(item,dishDto);<br>      <span class="hljs-comment">// 根据item对象，得到其对应的CategoryId</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> item.getCategoryId();<br>    <span class="hljs-comment">//根据id查分类对象</span><br>    <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br>    <span class="hljs-keyword">if</span>(category!=<span class="hljs-literal">null</span>)&#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">categoryName</span> <span class="hljs-operator">=</span> category.getName();<br>      dishDto.setCategoryName(categoryName);<br>    &#125;<br>    <span class="hljs-keyword">return</span> dishDto;<br>  &#125;).collect(Collectors.toList());<br><br>  dishDtoPage.setRecords(list);<br><br>  <span class="hljs-keyword">return</span> R.success(dishDtoPage);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="修改菜品"><a href="#修改菜品" class="headerlink" title="修改菜品"></a>修改菜品</h3><h4 id="需求分析-11"><a href="#需求分析-11" class="headerlink" title="需求分析"></a>需求分析</h4><p>在菜品管理列表页面点击修改按钮，跳转到修改菜品页面，在修改页面回显菜品相关信息并进行修改，最后点击确定按钮完成修改操作<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318610.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="代码开发-梳理交互过程-2"><a href="#代码开发-梳理交互过程-2" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下修改菜品时前端页面（ add.html)和服务端的交互过程:</p>
<p>1、页面发送ajax请求，请求服务端获取分类数据，用于菜品分类下拉框中数据展示</p>
<p>2、页面发送ajax请求，请求服务端，根据id查询当前菜品信息，用于菜品信息回显</p>
<ul>
<li>DishController处理Get请求</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  根据id查询菜品信息和对应的口味信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><span class="hljs-comment">//根据Id查询菜品信息与对应的口味信息</span><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)</span> <span class="hljs-comment">//  http://localhost:8080/dish/1555991783994073090</span><br>    <span class="hljs-keyword">public</span> R&lt;DishDto&gt; getById(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id)&#123;<br>        DishDto dishDto = dishService.getByIdWithFlavor(id);<br>        <span class="hljs-keyword">return</span> R.success(dishDto);<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>在DishService接口中创建getByIdWithFlavor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Dish&gt; &#123;<br>    <span class="hljs-comment">// 新增菜品，同时插入菜品对应的口味数据，需要操作两张表：dish（菜品表）、dish_flavor（菜品口味表)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithFlavor</span><span class="hljs-params">(DishDto dishDto)</span>;<br><br>    <span class="hljs-comment">// 根据id查询对应的菜品信息和口味信息</span><br>    <span class="hljs-keyword">public</span> DishDto <span class="hljs-title function_">getByIdWithFlavor</span><span class="hljs-params">(Long id)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>在DishServiceImpl添加getByIdWithFlavor方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> DishDto <span class="hljs-title function_">getByIdWithFlavor</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">//查询菜品基本信息</span><br>    <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getById(id);<br><br>    DishDto dishDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DishDto</span>();<br>    BeanUtils.copyProperties(dish,dishDto);<br><br>    <span class="hljs-comment">//查询菜品口味信息</span><br>    LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    queryWrapper.eq(DishFlavor::getDishId,dish.getId());<br>    List&lt;DishFlavor&gt; list = dishFlavorService.list(queryWrapper);<br><br>    dishDto.setFlavors(list);<br><br>    <span class="hljs-keyword">return</span> dishDto;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062318617.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>3、页面发送请求，请求服务端进行图片下载，用于页图片回显</p>
<p>4、点击保存按钮，页面发送ajax请求，将修改后的菜品相关数据以json形式提交到服务端</p>
<ul>
<li>在DishController添加put方法</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">//修改菜品</span><br><span class="hljs-variable">@PutMapping</span><br>public R&lt;String&gt; update(<span class="hljs-variable">@RequestBody</span> DishDto dishDto)&#123;<br>    <span class="hljs-selector-tag">dishService</span><span class="hljs-selector-class">.updateWithFlavor</span>(dishDto);<br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">&quot;修改菜品成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>在DishServiceImpl添加updateWithFlavor方法</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs perl">@Override<br>public void updateWithFlavor(DishDto dishDto) &#123;<br>    <span class="hljs-regexp">//</span> 更新dish表中的基本信息<br>    // 调用业务层接口（本身就是业务层，所以用this）<br>    this.updateById(dishDto); <span class="hljs-regexp">//</span> 当中updateById方法中要的是dish对象，我们可以传他的子类dishDto，同样可以修改dish表中的基础信息<br><br>    // 清理当前菜品对应口味数据 -- dish_flavor表中的<span class="hljs-keyword">delete</span>操作<br>    LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();<br>    <span class="hljs-regexp">//</span> 最终要执行的sql为：<span class="hljs-keyword">delete</span> *  from dish_flavor where id = ???<br>    queryWrapper.e<span class="hljs-string">q(DishFlavor::getDishId,dishDto.getId()</span>);<span class="hljs-regexp">//</span> 这个dishDto是前端传过来的对象，删除其原来的对象<br><br>    // 调用口味表相关的业务层接口，中的remove方法<br>    dishFlavorService.remove(queryWrapper);<br><br>    <span class="hljs-regexp">//</span> 添加当前提交过来的口味数据  --dish_flavor表中的insert操作<br>    List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();<br><br>    flavors = flavors.stream().map((item) -&gt; &#123;<br>        item.setDishId(dishDto.getId());<br>        <span class="hljs-keyword">return</span> item;<br>    &#125;).collect(Collectors.toList());<br><br><br>    dishFlavorService.saveBatch(flavors); <span class="hljs-regexp">//</span> 将其集合对象添加到数据库中去<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>开发修改菜品功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可。</p>
<h3 id="停售-x2F-起售菜品，删除菜品"><a href="#停售-x2F-起售菜品，删除菜品" class="headerlink" title="停售&#x2F;起售菜品，删除菜品"></a>停售&#x2F;起售菜品，删除菜品</h3><h4 id="需求分析-12"><a href="#需求分析-12" class="headerlink" title="需求分析"></a>需求分析</h4><p>在商品买卖过程中，商品停售，起售可以更加方便的让用户知道店家还有什么类型的商品在卖。删除方法也更方便的管理菜品</p>
<h4 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h4><p>在DishController添加sale方法与delete方法,通过数组保存ids，批量起售停售、删除都能生效</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs typescript"> <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *    根据id，停售起售菜品</span><br><span class="hljs-comment">     *    这是批量停售和起售的url， 第一个参数0（状态码），第二个参数（id集合)</span><br><span class="hljs-comment">     *     http://localhost:8080/dish/status/0?ids=1555991783994073090,1413384757047271425,1413385247889891330</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status，状态码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ids id集合</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/status/&#123;status&#125;&quot;</span>)  <span class="hljs-comment">// 如果url中有&#123;&#125;占位符，就用@PathVariable</span><br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">sale</span>(<span class="hljs-params"><span class="hljs-meta">@PathVariable</span> int status,</span><br><span class="hljs-params">                      <span class="hljs-built_in">String</span>[] ids</span>)&#123; <span class="hljs-comment">// 第一个参数是接收状态码（停售0，起售1）</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-title class_">String</span> <span class="hljs-attr">id</span>: ids)&#123;<br>        <span class="hljs-comment">// 根据id查询对象</span><br>        <span class="hljs-title class_">Dish</span> dish = dishService.<span class="hljs-title function_">getById</span>(id);<br>        <span class="hljs-comment">//设置其状态</span><br>        dish.<span class="hljs-title function_">setStatus</span>(status);<br>        <span class="hljs-comment">// 更新其对象</span><br>        dishService.<span class="hljs-title function_">updateById</span>(dish);<br>    &#125;<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>&#125;<br><span class="hljs-comment">//删除菜品</span><br><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">delete</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] ids</span>)&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> <span class="hljs-attr">id</span>:ids) &#123;<br>        dishService.<span class="hljs-title function_">removeById</span>(id);<br>    &#125;<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;删除成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>





<h1 id="瑞吉外卖开发笔记-五"><a href="#瑞吉外卖开发笔记-五" class="headerlink" title="瑞吉外卖开发笔记 五"></a>瑞吉外卖开发笔记 五</h1><p>笔记内容为<strong>黑马程序员</strong>视频内容</p>
<h2 id="套餐管理业务开发"><a href="#套餐管理业务开发" class="headerlink" title="套餐管理业务开发"></a>套餐管理业务开发</h2><h3 id="新增套餐"><a href="#新增套餐" class="headerlink" title="新增套餐"></a>新增套餐</h3><h4 id="需求分析-13"><a href="#需求分析-13" class="headerlink" title="需求分析"></a>需求分析</h4><p>套餐就是菜品的集合。</p>
<p>后台系统中可以管理套餐信息，通过新增套餐功能来添加一个新的套餐，在添加套餐时需要选择当前套餐所属的套餐分类和包含的菜品，并且需要上传套餐对应的图片，在移动端会按照套餐分类来展示对应的套餐。</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319429.png" srcset="/img/loading.gif" lazyload alt="image"><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319415.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="数据模型-3"><a href="#数据模型-3" class="headerlink" title="数据模型"></a>数据模型</h4><p>新增套餐，其实就是将新增页面录入的套餐信息插入到setmeal表，还需要向setmeal_dish表插入套餐和菜品关联数据。所以在新增套餐时，涉及到两个表:</p>
<ul>
<li>setmeal　　　　　　　　　 套餐表<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319541.png" srcset="/img/loading.gif" lazyload alt="image"></li>
<li>setmeal_dish　　　　　　　套餐菜品关系表<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319426.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<h4 id="代码开发-准备工作-1"><a href="#代码开发-准备工作-1" class="headerlink" title="代码开发-准备工作"></a>代码开发-准备工作</h4><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好:</p>
<ul>
<li><strong>实体类SetmealDish</strong>(直接从课程资料中导入即可，Setmeal实体前面+ 课程中已经导入过了) – setmeal可以理解为套餐的意思</li>
<li>DTO <strong>SetmealDto</strong>(直接从课程资料中导入即可)</li>
<li>Mapper接口SetmealDishMapper</li>
<li>业务层接口SetmealDishService</li>
<li>业务层实现类SetmealDishServicelmpl</li>
<li>控制层SetmealController</li>
</ul>
<h4 id="代码开发-梳理交互过程-3"><a href="#代码开发-梳理交互过程-3" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下新增套餐时前端页面和服务端的交互过程:</p>
<p>1、页面(backend&#x2F; page&#x2F;comboladd.html)发送ajax请求，请求服务端获取套餐分类数据并展示到下拉框中</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319365.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>2、页面发送ajax请求，请求服务端获取菜品分类数据并展示到添加菜品窗口中</p>
<p>3、页面发送ajax请求，请求服务端，根据菜品分类查询对应的菜品数据并展示到添加菜品窗口中</p>
<p>在DishController添加list方法</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs perl">//根据条件查询对应菜品数据<br>@GetMapping(<span class="hljs-string">&quot;/list&quot;</span>)<br>// URL：localhost:<span class="hljs-number">8080</span>/dish/list?categoryId=<span class="hljs-number">1555297971076354050</span><br>// 使用参数(Long categoryId) 接收也可以，但是这里最好封装它，用Dish对象（里面有categoryId属性）<br>public R&lt;List&lt;Dish&gt;&gt; list(Dish dish)&#123;<br><br>    <span class="hljs-regexp">//</span>构造查询条件<br>    LambdaQueryWrapper&lt;Dish&gt; lambdaQueryWrapper=new LambdaQueryWrapper&lt;&gt;();<br>    <span class="hljs-regexp">//</span>添加条件，查询状态为<span class="hljs-number">1</span>的（起售状态）<br>    lambdaQueryWrapper.e<span class="hljs-string">q(Dish::getStatus,1)</span>;<br>    lambdaQueryWrapper.e<span class="hljs-string">q(dish.getCategoryId()</span>!=null,Dish::getCategoryId,dish.getCategoryId());<br>    <span class="hljs-regexp">//</span>条件排序条件<br>    lambdaQueryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);<br><br>    List&lt;Dish&gt; list=dishService.list(lambdaQueryWrapper);<br><br>    <span class="hljs-keyword">return</span> R.success(list);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319412.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>4、页面发送请求进行图片上传，请求服务端将图片保存到服务器</p>
<p>5、页面发送请求进行图片下载，将上传的图片进行回显</p>
<p>6、点击保存按钮，发送ajax请求，将套餐相关数据以json形式提交到服务端</p>
<p>在SetmealServiceImpl实现saveWithDish方法：新增套餐，同时要保持与菜品的关联关系</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SetmealServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;SetmealMapper</span>, <span class="hljs-title">Setmeal&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">SetmealService</span></span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">SetmealDishService</span> setmealDishService;<br><br>    <span class="hljs-comment">//新增套餐，同时要保持与菜品的关联关系</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Transactional</span><br>    public void saveWithDish(<span class="hljs-type">SetmealDto</span> setmealDto) &#123;<br>        <span class="hljs-comment">//保存套餐基本信息，操作setmeal，执行insert操作</span><br>        <span class="hljs-keyword">this</span>.save(setmealDto);<br><br>        <span class="hljs-type">List</span>&lt;<span class="hljs-type">SetmealDish</span>&gt; setmealDishes = setmealDto.getSetmealDishes();<br><br>        setmealDishes.stream().map((item)-&gt;&#123;<br>            item.setSetmealId(setmealDto.getId());<span class="hljs-comment">// 这里得到的id是套餐setmeal_id，将setmeal_id赋值给菜品套餐表中去</span><br>            <span class="hljs-keyword">return</span> item;<br>        &#125;).collect(<span class="hljs-type">Collectors</span>.toList());<br><br>        <span class="hljs-comment">//保存套餐和菜品的关联信息，操作setmeal_dish，执行insert操作</span><br>        setmealDishService.saveBatch(setmealDishes);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在SetmealController添加save方法</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RestController</span><br><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/setmeal&quot;</span>)<br><span class="hljs-variable">@Slf4j</span><br>public class SetmealController &#123;<br>    <span class="hljs-variable">@Autowired</span><br>    private SetmealService setmealService;<br><br>    <span class="hljs-variable">@Autowired</span><br>    private SetmealDishService setmealDishService;<br><br>    <span class="hljs-variable">@PostMapping</span><br>    public R&lt;String&gt; save(<span class="hljs-variable">@RequestBody</span> SetmealDto setmealDto)&#123;<br>        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">&quot;setmeal:&#123;&#125;&quot;</span>,setmealDto);<br>        <span class="hljs-selector-tag">setmealService</span><span class="hljs-selector-class">.saveWithDish</span>(setmealDto);<br>        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">&quot;新增套餐成功&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>开发新增套餐功能，其实就是在服务端编写代码去处理前端页面发送的这6次请求即可。</p>
<h3 id="套餐分页查询"><a href="#套餐分页查询" class="headerlink" title="套餐分页查询"></a>套餐分页查询</h3><h4 id="需求分析-14"><a href="#需求分析-14" class="headerlink" title="需求分析"></a>需求分析</h4><p>系统中的套餐数据很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。</p>
<p>注意：有一个注意点：如果将以下代码运行不会报错，但是浏览器页面不会显示套餐分类这个字段内容，</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080115089.png" srcset="/img/loading.gif" lazyload alt="image-20220808011516986"></p>
<p>在SetmealDto有这个属性字段，可以用这个参数来显示套餐分类字段 – 使用对象拷贝到SetmealDto中去</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080121485.png" srcset="/img/loading.gif" lazyload alt="image-20220808012139340"></p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080114217.png" srcset="/img/loading.gif" lazyload alt="image-20220808011452128"></p>
<h4 id="代码开发-梳理交互过程-4"><a href="#代码开发-梳理交互过程-4" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下套餐分页查询时前端页面和服务端的交互过程:</p>
<p>1、页面(backend&#x2F;page&#x2F;combo&#x2F;list.html)发送ajax请求，将分页查询参数(page、pageSize、name)提交到服务端，获取分页数据</p>
<p>2、页面发送请求，请求服务端进行图片下载，用于页面图片展示</p>
<p>开发套餐信息分页查询功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p>
<p>这个Page类中的records属性；就是页面存储的记录条数信息的对象</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080138018.png" srcset="/img/loading.gif" lazyload alt="image-20220808013816923"></p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080136419.png" srcset="/img/loading.gif" lazyload alt="image-20220808013650318"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize,String name)</span>&#123;<br>    <span class="hljs-comment">//构造分页构造器</span><br>    Page&lt;Setmeal&gt; pageInfo=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page,pageSize);<br><span class="hljs-comment">// 创建这个SetmealDto泛型的对象可以让前端显示  套餐分类这个字段了</span><br>    Page&lt;SetmealDto&gt; pageDtoInfo=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;();<br>    <span class="hljs-comment">//构造条件构造器</span><br>    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">//根据name进行模糊查询</span><br>    queryWrapper.like(!StringUtils.isEmpty(name),Setmeal::getName,name);<br>    <span class="hljs-comment">//添加排序条件，根据sort进行排序</span><br>    queryWrapper.orderByDesc(Setmeal::getUpdateTime);<br>    <span class="hljs-comment">//进行分页查询</span><br>    setmealService.page(pageInfo,queryWrapper);<br><br>    <span class="hljs-comment">//对象拷贝</span><br>    BeanUtils.copyProperties(pageInfo,pageDtoInfo,<span class="hljs-string">&quot;records&quot;</span>);<br><br>    List&lt;Setmeal&gt; records=pageInfo.getRecords();<br><br>    List&lt;SetmealDto&gt; list= records.stream().map((item)-&gt;&#123;<br>        SetmealDto setmealDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">SetmealDto</span>();<br><br>        BeanUtils.copyProperties(item,setmealDto);<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> item.getCategoryId();<br>        <span class="hljs-comment">//根据id查分类对象</span><br>        <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br>        <span class="hljs-keyword">if</span>(category!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">// 拿到套餐分类对象的名称，返回给setmealDto，</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">categoryName</span> <span class="hljs-operator">=</span> category.getName();<br>            setmealDto.setCategoryName(categoryName);<br>        &#125;<br>        <span class="hljs-keyword">return</span> setmealDto;<br>    &#125;).collect(Collectors.toList());<br><br>    pageDtoInfo.setRecords(list); <span class="hljs-comment">// 将新的list对象赋值给自己新定义pageDto对象</span><br><br>    <span class="hljs-keyword">return</span> R.success(pageDtoInfo);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="删除、起售、停售套餐"><a href="#删除、起售、停售套餐" class="headerlink" title="删除、起售、停售套餐"></a>删除、起售、停售套餐</h3><h4 id="需求分析-15"><a href="#需求分析-15" class="headerlink" title="需求分析"></a>需求分析</h4><p>在套餐管理列表页面点击删除按钮，可以删除对应的套餐信息。也可以通过复选框选择多个套餐，点击批量删除按钮一次删除多个套餐。注意，对于状态为售卖中的套餐不能删除，需要先停售，然后才能删除。</p>
<h4 id="代码实现-4"><a href="#代码实现-4" class="headerlink" title="代码实现"></a>代码实现</h4><p>开发删除套餐功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。<br>观察删除单个套餐和批量删除套餐的请求信息可以发现，两种请求的地址和请求方式都是相同的，不同的则是传递的id个数，所以在服务端可以提供一个方法来统一处理。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  删除套餐</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">ids</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-comment">//    集合保存普通参数：请求参数名与形参集合对象名相同且请求参数为多个，@RequestParam绑定参数关系</span><br>                            <span class="hljs-comment">// http://localhost:8080/setmeal?ids=1556324903628898306,1415580119015145474</span><br>                            <span class="hljs-comment">// 由于请求的是一个参数中是一个集合对象的参数，这个时候形参要用@RequestParam注解</span><br>                            <span class="hljs-comment">// 当然如果用数组接收的话，就不用@RequestParam注解了</span><br>    <span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">delete</span>(<span class="hljs-params"><span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids</span>) &#123; <span class="hljs-comment">// 将参数封装到list集合中，也可以封装到Long数组中去</span><br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;ids:&#123;&#125;&quot;</span>,ids);<br><br>        setmealService.<span class="hljs-title function_">removeWithDish</span>(ids); <span class="hljs-comment">// 这个removeWithDish是mp的方法，删除对应的集合</span><br>        <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;套餐数据删除成功&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  套餐停售功能</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status // 接收前端传过来的状态码 点击停售，传过来 0</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ids // 要删除的套餐id集合</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/status/&#123;status&#125;&quot;</span>) <span class="hljs-comment">//http://localhost:8080/setmeal/status/0?ids=1415580119015145474</span><br>    <span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">sale</span>(<span class="hljs-params"><span class="hljs-meta">@PathVariable</span> int status,<span class="hljs-built_in">String</span>[] ids</span>)&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> <span class="hljs-attr">id</span>:ids)&#123;<br>            <span class="hljs-comment">// 根据id拿到对应的对象</span><br>            <span class="hljs-title class_">Setmeal</span> setmeal = setmealService.<span class="hljs-title function_">getById</span>(id);<br>            <span class="hljs-comment">// 设置状态码，值为前端传过来的值</span><br>            setmeal.<span class="hljs-title function_">setStatus</span>(status);<br>            <span class="hljs-comment">// 执行sql，更新操作</span><br>            setmealService.<span class="hljs-title function_">updateById</span>(setmeal);<br>        &#125;<br>        <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<p>定义业务层删除套餐对应的SetmealServiceImpl实现类的removeWithDish方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  删除套餐，同时需要删除套餐和菜品的关联数据</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// 由于删除了两张表，所以加一个事务注解，保证数据的一致性</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeWithDish</span><span class="hljs-params">(List&lt;Long&gt; ids)</span> &#123;<br><br>    <span class="hljs-comment">// 执行条件的sql为： select count(*) from setmeal where id in (1,2,3) and status = 1</span><br>    <span class="hljs-comment">// 查询套餐状态，确定是否可用删除</span><br>    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    queryWrapper.in(Setmeal::getId,ids);<br>    queryWrapper.eq(Setmeal::getStatus,<span class="hljs-number">1</span>); <span class="hljs-comment">// 查询起售的商品</span><br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.count(queryWrapper); <span class="hljs-comment">// 这个count是mq框架的方法</span><br><br>    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-comment">// 如果不能删除，抛出一个业务异常，自己定义了</span><br>        <span class="hljs-keyword">throw</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomException</span>(<span class="hljs-string">&quot;套餐正在售卖中，不能删除&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 如果可以删除，先删除套餐表中的数据-- setmeal表</span><br>    <span class="hljs-built_in">this</span>.removeByIds(ids); <span class="hljs-comment">// 这个removeByIds是mq提供的方法，参数提供一个集合，把集合中符合条件的都删除</span><br><br>    <span class="hljs-comment">// 删除关系表中的数据---setmeal_dish表</span><br>    <span class="hljs-comment">// delete from setmeal_dish where setmeal_id in (1,2,3) 这里的123是集合中的数据</span><br>    LambdaQueryWrapper&lt;SetmealDish&gt; lambdaQueryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">// 相当于sqldelete from setmeal_dish where setmeal_id in (1,2,3)</span><br>    lambdaQueryWrapper.in(SetmealDish::getSetmealId,ids);<br>    <span class="hljs-comment">// 删除关系表中的数据--setmeal_dish 删除哪张表，就调用对应的业务层</span><br>    setmealDishService.remove(lambdaQueryWrapper);<br><br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="修改套餐"><a href="#修改套餐" class="headerlink" title="修改套餐"></a>修改套餐</h3><h4 id="需求分析-16"><a href="#需求分析-16" class="headerlink" title="需求分析"></a>需求分析</h4><p>在套餐管理列表页面点击修改按钮，跳转到修改套餐页面，在修改页面回显套餐相关信息并进行修改，最后点击确定按钮完成修改操作</p>
<h4 id="代码开发-梳理交互过程-5"><a href="#代码开发-梳理交互过程-5" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下修改套餐时前端页面（ add.html)和服务端的交互过程:</p>
<p>1、页面发送ajax请求，请求服务端获取分类数据，用于套餐分类下拉框中数据展示</p>
<p>2、页面发送ajax请求，请求服务端，根据id查询当前套餐信息，用于套餐信息回显</p>
<ul>
<li>SetmealController处理Get请求</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//根据Id查询套餐信息</span><br><span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)</span><br><span class="hljs-keyword">public</span> R&lt;SetmealDto&gt; getById(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id)&#123;<br>    SetmealDto setmealDto=setmealService.getByIdWithDish(id);<br><br>    <span class="hljs-keyword">return</span> R.success(setmealDto);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>SetmealServiceImpl添加getByIdWithDish方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> SetmealDto <span class="hljs-title function_">getByIdWithDish</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">//查询套餐基本信息</span><br>    <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getById(id);<br>    <span class="hljs-type">SetmealDto</span> <span class="hljs-variable">setmealDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetmealDto</span>();<br>    BeanUtils.copyProperties(setmeal, setmealDto);<br><br>    <span class="hljs-comment">//查询套餐菜品信息</span><br>    LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    queryWrapper.eq(SetmealDish::getSetmealId,setmeal.getId());<br>    List&lt;SetmealDish&gt; list = setmealDishService.list(queryWrapper);<br><br>    setmealDto.setSetmealDishes(list);<br>    <span class="hljs-keyword">return</span> setmealDto;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319723.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>3、页面发送请求，请求服务端进行图片下载，用于页图片回显</p>
<p>4、点击保存按钮，页面发送ajax请求，将修改后的菜品相关数据以json形式提交到服务端</p>
<ul>
<li>在SetmealServiceImpl添加updateWithDish方法</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs perl">@Override<br>public void updateWithDish(SetmealDto setmealDto) &#123;<br>    <span class="hljs-regexp">//</span>更新setmeal表基本信息<br>    this.updateById(setmealDto);<br><br>    <span class="hljs-regexp">//</span>更新setmeal_dish表信息<span class="hljs-keyword">delete</span>操作<br>    LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();<br>    queryWrapper.e<span class="hljs-string">q(SetmealDish::getSetmealId, setmealDto.getId()</span>);<br>    setmealDishService.remove(queryWrapper);<br><br>    <span class="hljs-regexp">//</span>更新setmeal_dish表信息insert操作<br>    List&lt;SetmealDish&gt; SetmealDishes = setmealDto.getSetmealDishes();<br><br>    SetmealDishes = SetmealDishes.stream().map((item) -&gt; &#123;<br>        item.setSetmealId(setmealDto.getId());<br>        <span class="hljs-keyword">return</span> item;<br>    &#125;).collect(Collectors.toList());<br><br>    setmealDishService.saveBatch(SetmealDishes);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>在SetmealController处理put请求</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">//修改套餐</span><br><span class="hljs-variable">@PutMapping</span><br>public R&lt;String&gt; update(<span class="hljs-variable">@RequestBody</span> SetmealDto setmealDto)&#123;<br>    <span class="hljs-selector-tag">setmealService</span><span class="hljs-selector-class">.updateWithDish</span>(setmealDto);<br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>注意：</strong>开发修改套餐功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可。</p>
<h2 id="手机验证码登录"><a href="#手机验证码登录" class="headerlink" title="手机验证码登录"></a>手机验证码登录</h2><h3 id="短信发送"><a href="#短信发送" class="headerlink" title="短信发送"></a>短信发送</h3><h4 id="短信服务介绍"><a href="#短信服务介绍" class="headerlink" title="短信服务介绍"></a>短信服务介绍</h4><p>目前市面上有很多第三方提供的短信服务，这些第三方短信服务会和各个运营商（移动、联通、电信)对接，我们只需要注册成为会员并且按照提供的开发文档进行调用就可以发送短信。需要说明的是，这些短信服务一般都是收费服务。</p>
<p>常用短信服务:</p>
<ul>
<li>阿里云</li>
<li>华为云</li>
<li>腾讯云</li>
<li>京东</li>
<li>梦网</li>
<li>乐信</li>
</ul>
<h4 id="阿里云短信服务-介绍"><a href="#阿里云短信服务-介绍" class="headerlink" title="阿里云短信服务-介绍"></a>阿里云短信服务-介绍</h4><p>阿里云短信服务（Short Message Service)是广大企业客户快速触达手机用户所优选使用的通信能力。调用API或用群发助手，即可发送验证码、通知类和营销类短信;国内验证短信秒级触达，到达率最高可达99%;国际&#x2F;港澳台短信覆盖200多个国家和地区，安全稳定，广受出海企业选用。</p>
<p>应用场景:</p>
<ul>
<li>验证码</li>
<li>短信通知</li>
<li>推广短信</li>
</ul>
<h4 id="阿里云短信服务-注册账号"><a href="#阿里云短信服务-注册账号" class="headerlink" title="阿里云短信服务-注册账号"></a>阿里云短信服务-注册账号</h4><p>阿里云官网: <a target="_blank" rel="noopener" href="https://www.aliyun.com/">https://www.aliyun.com/</a></p>
<p>点击官网首页注册按钮。</p>
<h4 id="阿里云短信服务-设置短信签名"><a href="#阿里云短信服务-设置短信签名" class="headerlink" title="阿里云短信服务-设置短信签名"></a>阿里云短信服务-设置短信签名</h4><p>注册成功后，点击登录按钮进行登录。登录后进入短信服务管理页面，选择国内消息菜单:</p>
<img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319840.png" srcset="/img/loading.gif" lazyload alt="image"  />

<p>短信签名是短信发送者的署名，表示发送方的身份。</p>
<h4 id="阿里云短信服务-设置短信模板"><a href="#阿里云短信服务-设置短信模板" class="headerlink" title="阿里云短信服务-设置短信模板"></a>阿里云短信服务-设置短信模板</h4><p>切换到【模板管理】标签页:<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319842.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>短信模板包含短信发送内容、场景、变量信息。</p>
<h4 id="阿里云短信服务-设置AccessKey"><a href="#阿里云短信服务-设置AccessKey" class="headerlink" title="阿里云短信服务-设置AccessKey"></a>阿里云短信服务-设置AccessKey</h4><p>光标移动到用户头像上，在弹出的窗口中点击【AccessKey管理】∶<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319866.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="注意：腾讯云使用的方法不一样："><a href="#注意：腾讯云使用的方法不一样：" class="headerlink" title="注意：腾讯云使用的方法不一样："></a>注意：腾讯云使用的方法不一样：</h4><p>参考文档：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_56233219/article/details/118015291">https://blog.csdn.net/qq_56233219/article/details/118015291</a></p>
<p>​					<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38007185/article/details/108245766?spm=1001.2014.3001.5506">https://blog.csdn.net/weixin_38007185/article/details/108245766?spm=1001.2014.3001.5506</a></p>
<p>​				<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38007185/article/details/108245766">https://blog.csdn.net/weixin_38007185/article/details/108245766</a></p>
<p>申请公众号的方式：<a target="_blank" rel="noopener" href="https://icode.best/i/05667645150915">https://icode.best/i/05667645150915</a></p>
<h4 id="代码开发-8"><a href="#代码开发-8" class="headerlink" title="代码开发"></a>代码开发</h4><p>使用阿里云短信服务发送短信，可以参照官方提供的文档即可。<br>具体开发步骤:</p>
<p>1、导入maven坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.5.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>2、调用API</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SMSUtils</span> &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 发送短信</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> signName 签名</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> templateCode 模板</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> phoneNumbers 手机号</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> param 参数</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> signName, <span class="hljs-built_in">String</span> templateCode,<span class="hljs-built_in">String</span> phoneNumbers,<span class="hljs-built_in">String</span> param</span>)&#123;<br>		<span class="hljs-title class_">DefaultProfile</span> profile = <span class="hljs-title class_">DefaultProfile</span>.<span class="hljs-title function_">getProfile</span>(<span class="hljs-string">&quot;cn-hangzhou&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>		<span class="hljs-title class_">IAcsClient</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAcsClient</span>(profile);<br><br>		<span class="hljs-title class_">SendSmsRequest</span> request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendSmsRequest</span>();<br>		request.<span class="hljs-title function_">setSysRegionId</span>(<span class="hljs-string">&quot;cn-hangzhou&quot;</span>);<br>		request.<span class="hljs-title function_">setPhoneNumbers</span>(phoneNumbers);<br>		request.<span class="hljs-title function_">setSignName</span>(signName);<br>		request.<span class="hljs-title function_">setTemplateCode</span>(templateCode);<br>		request.<span class="hljs-title function_">setTemplateParam</span>(<span class="hljs-string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span>+param+<span class="hljs-string">&quot;\&quot;&#125;&quot;</span>);<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-title class_">SendSmsResponse</span> response = client.<span class="hljs-title function_">getAcsResponse</span>(request);<br>			<span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">&quot;短信发送成功&quot;</span>);<br>		&#125;<span class="hljs-keyword">catch</span> (<span class="hljs-title class_">ClientException</span> e) &#123;<br>			e.<span class="hljs-title function_">printStackTrace</span>();<br>		&#125;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;如果是模拟的话，可以定义一个随机验证码的工具类：&#x3D;&#x3D;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 随机生成验证码工具类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ValidateCodeUtils</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 随机生成验证码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> length 长度为4位或者6位</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title function_">generateValidateCode</span><span class="hljs-params">(<span class="hljs-type">int</span> length)</span>&#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span><span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span>(length == <span class="hljs-number">4</span>)&#123;<br>            code = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">9999</span>);<span class="hljs-comment">//生成随机数，最大为9999</span><br>            <span class="hljs-keyword">if</span>(code &lt; <span class="hljs-number">1000</span>)&#123;<br>                code = code + <span class="hljs-number">1000</span>;<span class="hljs-comment">//保证随机数为4位数字</span><br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(length == <span class="hljs-number">6</span>)&#123;<br>            code = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">999999</span>);<span class="hljs-comment">//生成随机数，最大为999999</span><br>            <span class="hljs-keyword">if</span>(code &lt; <span class="hljs-number">100000</span>)&#123;<br>                code = code + <span class="hljs-number">100000</span>;<span class="hljs-comment">//保证随机数为6位数字</span><br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;只能生成4位或6位数字验证码&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 随机生成指定长度字符串验证码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> length 长度</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateValidateCode4String</span><span class="hljs-params">(<span class="hljs-type">int</span> length)</span>&#123;<br>        <span class="hljs-type">Random</span> <span class="hljs-variable">rdm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">hash1</span> <span class="hljs-operator">=</span> Integer.toHexString(rdm.nextInt());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">capstr</span> <span class="hljs-operator">=</span> hash1.substring(<span class="hljs-number">0</span>, length);<br>        <span class="hljs-keyword">return</span> capstr;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="手机验证码登录-1"><a href="#手机验证码登录-1" class="headerlink" title="手机验证码登录"></a>手机验证码登录</h3><h4 id="需求分析-17"><a href="#需求分析-17" class="headerlink" title="需求分析"></a>需求分析</h4><p>为了方便用户登录，移动端通常都会提供通过手机验证码登录的功能。</p>
<p>手机验证码登录的优点:</p>
<ul>
<li>方便快捷，无需注册，直接登录</li>
<li>使用短信验证码作为登录凭证，无需记忆密码</li>
<li>安全</li>
</ul>
<p>登录流程:<br>输入手机号&gt;获取验证码&gt;输入验证码&gt;点击登录&gt;登录成功</p>
<p>注意:通过手机验证码登录，手机号是区分不同用户的标识。</p>
<h4 id="数据模型-4"><a href="#数据模型-4" class="headerlink" title="数据模型"></a>数据模型</h4><p>通过手机验证码登录时，涉及的表为user表，即用户表。结构如下:<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319888.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="代码开发-9"><a href="#代码开发-9" class="headerlink" title="代码开发"></a>代码开发</h4><p>在开发代码之前，需要梳理一下登录时前端页面和服务端的交互过程:</p>
<p>1、在登录页面(front&#x2F;page&#x2F;login.html)输入手机号，点击【获取验证码】按钮，页面发送ajax请求，在服务端调用短信服务API给指定手机号发送验证码短信</p>
<p>2、在登录页面输入验证码，点击【登录】按钮，发送ajax请求，在服务端处理登录请求</p>
<p>开发手机验证码登录功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p>
<p>在开发业务功能前，先将需要用到的类和接口基本结构创建好:</p>
<ul>
<li>实体类User(直接从课程资料中导入即可)</li>
<li>Mapper接口UserMapper</li>
<li>业务层接口UserService</li>
<li>业务层实现类UserServicelmpl</li>
<li>控制层UserController</li>
<li>工具类SMSutils、 ValidateCodeutils（直接从课程资料中导入即可)</li>
</ul>
<p>前面我们已经完成了LogincheckFilter过滤器的开发，此过滤器用于检查用户的登录状态。我们在进行手机验证码登录时，发送的请求需要在此过滤器处理时直接放行。</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319966.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>LoginCheckFilter过滤器添加</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//        4-2、判断登录状态，如果已登录，则直接放行</span><br><span class="hljs-keyword">if</span> (request.getSession().getAttribute(<span class="hljs-string">&quot;user&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>    log.info(<span class="hljs-string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>, request.getSession().getAttribute(<span class="hljs-string">&quot;user&quot;</span>));<br><br>    <span class="hljs-built_in">Long</span> userId= (<span class="hljs-built_in">Long</span>) request.getSession().getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<br><br>    BaseContext.setCurrentId(userId);<br><br>    filterChain.doFilter(request, response);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>由于资料中代码不全login.js自行添加</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">function sendMsgApi(<span class="hljs-keyword">data</span>) &#123;<br>    <span class="hljs-keyword">return</span> $axios(&#123;<br>        <span class="hljs-string">&#x27;url&#x27;</span>:<span class="hljs-string">&#x27;/user/sendMsg&#x27;</span>,<br>        <span class="hljs-string">&#x27;method&#x27;</span>:<span class="hljs-string">&#x27;post&#x27;</span>,<br>        <span class="hljs-keyword">data</span><br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>login.html</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// this.form.code = (Math.random()*1000000).toFixed(0)</span><br>sendMsgApi(&#123;phone:<span class="hljs-keyword">this</span>.form.phone&#125;)<br></code></pre></td></tr></table></figure>

<p>UserController处理post请求（发送验证码的请求）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/sendMsg&quot;</span>)<br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">sendMsg</span>(<span class="hljs-params"><span class="hljs-meta">@RequestBody</span> User user, HttpSession session</span>)&#123;<br>    <span class="hljs-comment">//获取手机号</span><br>    <span class="hljs-title class_">String</span> phone=user.<span class="hljs-title function_">getPhone</span>();<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isEmpty</span>(phone)) &#123;<br>        <span class="hljs-comment">//生成随机的4位验证码</span><br>        <span class="hljs-title class_">String</span> code = <span class="hljs-title class_">ValidateCodeUtils</span>.<span class="hljs-title function_">generateValidateCode</span>(<span class="hljs-number">4</span>).<span class="hljs-title function_">toString</span>();<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;code=&#123;&#125;&quot;</span>,code);<br>        <span class="hljs-comment">//调用阿里云提供的短信服务API完成发送短信</span><br>        <span class="hljs-comment">//SMSUtils.sendMessage(&quot;瑞吉外卖&quot;,&quot;&quot;,phone,code);</span><br><br>        <span class="hljs-comment">//需要将生成的验证码保存到Session</span><br>        session.<span class="hljs-title function_">setAttribute</span>(phone,code); <span class="hljs-comment">// 键值对的类型，属性名位phone，值为code</span><br>        <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;手机验证码短信发送成功&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;手机短信发送失败&quot;</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>由于前端页面有部分代码缺失，建议拷贝资料中day05的front代码</p>
<p>在UserController编写login处理post请求</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  移动端用户登录</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">map</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">session</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/login&quot;</span>)<br>                            <span class="hljs-comment">// 使用Map类来封装，键值对，phone：code</span><br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">User</span>&gt; <span class="hljs-title function_">login</span>(<span class="hljs-params"><span class="hljs-meta">@RequestBody</span> <span class="hljs-built_in">Map</span> map, HttpSession session</span>) &#123;<br><br>    log.<span class="hljs-title function_">info</span>(map.<span class="hljs-title function_">toString</span>());<br><br>    <span class="hljs-comment">// 获取手机号</span><br>    <span class="hljs-title class_">String</span> phone = map.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;phone&quot;</span>).<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// 将得到的value转换成字符串类型</span><br><br>    <span class="hljs-comment">// 获取验证码</span><br>    <span class="hljs-title class_">String</span> code = map.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;code&quot;</span>).<span class="hljs-title function_">toString</span>();<br>    <span class="hljs-comment">// 从Session中获取保存的验证码</span><br>    <span class="hljs-title class_">Object</span> codeInSession = session.<span class="hljs-title function_">getAttribute</span>(phone);<br><br>    <span class="hljs-comment">// 进行验证码比对（页面提交的验证码和Session中保存的验证码比对）</span><br>    <span class="hljs-keyword">if</span> (codeInSession !=<span class="hljs-literal">null</span> &amp;&amp; codeInSession.<span class="hljs-title function_">equals</span>(code))&#123;<br><br>        <span class="hljs-comment">// 如果能够比对成功，说明登录成功</span><br>        <span class="hljs-comment">// 判断当前手机号对应的用户是否为新用户，如果是新用户就自动完成注册</span><br>        <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;<span class="hljs-title class_">User</span>&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        queryWrapper.<span class="hljs-title function_">eq</span>(<span class="hljs-title class_">User</span>::getPhone,phone); <span class="hljs-comment">// 如果手机号码和数据库中的号码相等，说明已经注册过</span><br><br>        <span class="hljs-title class_">User</span> user = userService.<span class="hljs-title function_">getOne</span>(queryWrapper);<br><br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>)&#123; <span class="hljs-comment">// 说明是新用户</span><br>            <span class="hljs-comment">// 不为空则是新用户，自动完成注册</span><br>            user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<span class="hljs-comment">// 重新创建一个新的对象，覆盖原来的，重置设置其属性值</span><br>            user.<span class="hljs-title function_">setPhone</span>(phone);<br>            user.<span class="hljs-title function_">setStatus</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 状态：1表示正常</span><br>            userService.<span class="hljs-title function_">save</span>(user); <span class="hljs-comment">// 添加到数据库中</span><br>        &#125;<br><br>        <span class="hljs-comment">// 登录成功后，将登录后的id，传给session</span><br>        <span class="hljs-comment">// 当http请求中session有id时：就不会闪退页面，</span><br>        session.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;user&quot;</span>,user.<span class="hljs-title function_">getId</span>()); <span class="hljs-comment">// key为“user”，value为：id</span><br><br>        <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(user);<br>    &#125;<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;短信发送失败&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h4><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319079.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208062319287.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h1 id="瑞吉外卖开发笔记-六"><a href="#瑞吉外卖开发笔记-六" class="headerlink" title="瑞吉外卖开发笔记 六"></a>瑞吉外卖开发笔记 六</h1><p>笔记内容为<strong>黑马程序员</strong>视频内容</p>
<h2 id="导入用户地址簿相关功能代码"><a href="#导入用户地址簿相关功能代码" class="headerlink" title="导入用户地址簿相关功能代码"></a>导入用户地址簿相关功能代码</h2><h3 id="需求分析-18"><a href="#需求分析-18" class="headerlink" title="需求分析"></a>需求分析</h3><p>地址簿，指的是移动端消费者用户的地址信息，用户登录成功后可以维护自己的地址信息。同一个用户可以有多个地址信息，但是只能有一个<strong>默认地址</strong>。</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354154.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="数据模型-5"><a href="#数据模型-5" class="headerlink" title="数据模型"></a>数据模型</h3><p>用户的地址信息会存储在address_book表，即地址簿表中。具体表结构如下:</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354166.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="导入功能代码"><a href="#导入功能代码" class="headerlink" title="导入功能代码"></a>导入功能代码</h3><p>功能代码清单:</p>
<ul>
<li>实体类AddressBook(直接从课程资料中导入即可)</li>
<li>Mapper接口AddressBookMapper</li>
<li>业务层接口AddressBookService</li>
<li>业务层实现类AddressBookServicelmpl</li>
<li>控制层AddressBookController(直接从课程资料中导入即可)</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/addressBook&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddressBookController</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AddressBookService addressBookService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 新增</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> R&lt;AddressBook&gt; save(<span class="hljs-meta">@RequestBody</span> AddressBook addressBook) &#123;<br>        addressBook.setUserId(BaseContext.getCurrentId());<br>        log.info(<span class="hljs-string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);<br>        addressBookService.save(addressBook);<br>        <span class="hljs-keyword">return</span> R.success(addressBook);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 设置默认地址</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PutMapping(<span class="hljs-string">&quot;default&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> R&lt;AddressBook&gt; setDefault(<span class="hljs-meta">@RequestBody</span> AddressBook addressBook) &#123;<br>        log.info(<span class="hljs-string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);<br>        LambdaUpdateWrapper&lt;AddressBook&gt; wrapper = new LambdaUpdateWrapper&lt;&gt;();<br>        wrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());<br>        wrapper.<span class="hljs-keyword">set</span>(AddressBook::getIsDefault, <span class="hljs-number">0</span>);<br>        <span class="hljs-comment">//SQL:update address_book set is_default = 0 where user_id = ?</span><br>        addressBookService.update(wrapper);<br><br>        addressBook.setIsDefault(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">//SQL:update address_book set is_default = 1 where id = ?</span><br>        addressBookService.updateById(addressBook);<br>        <span class="hljs-keyword">return</span> R.success(addressBook);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据id查询地址</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> R <span class="hljs-keyword">get</span>(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id) &#123;<br>        AddressBook addressBook = addressBookService.getById(id);<br>        <span class="hljs-keyword">if</span> (addressBook != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> R.success(addressBook);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;没有找到该对象&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询默认地址</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;default&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> R&lt;AddressBook&gt; getDefault() &#123;<br>        LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();<br>        queryWrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());<br>        queryWrapper.eq(AddressBook::getIsDefault, <span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">//SQL:select * from address_book where user_id = ? and is_default = 1</span><br>        AddressBook addressBook = addressBookService.getOne(queryWrapper);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == addressBook) &#123;<br>            <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;没有找到该对象&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> R.success(addressBook);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询指定用户的全部地址</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/list&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> R&lt;List&lt;AddressBook&gt;&gt; list(AddressBook addressBook) &#123;<br>        addressBook.setUserId(BaseContext.getCurrentId());<br>        log.info(<span class="hljs-string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);<br><br>        <span class="hljs-comment">//条件构造器</span><br>        LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();<br>        queryWrapper.eq(<span class="hljs-literal">null</span> != addressBook.getUserId(), AddressBook::getUserId, addressBook.getUserId());<br>        queryWrapper.orderByDesc(AddressBook::getUpdateTime);<br><br>        <span class="hljs-comment">//SQL:select * from address_book where user_id = ? order by update_time desc</span><br>        <span class="hljs-keyword">return</span> R.success(addressBookService.list(queryWrapper));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="功能测试-1"><a href="#功能测试-1" class="headerlink" title="功能测试"></a>功能测试</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354046.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="菜品展示"><a href="#菜品展示" class="headerlink" title="菜品展示"></a>菜品展示</h2><h3 id="需求分析-19"><a href="#需求分析-19" class="headerlink" title="需求分析"></a>需求分析</h3><p>用户登录成功后跳转到系统首页，在首页需要根据分类来展示菜品和套餐。如果菜品设置了口味信息需要展示 [选择规格] 按钮，否则显示 [+] 按钮。</p>
<h3 id="代码开发-10"><a href="#代码开发-10" class="headerlink" title="代码开发"></a>代码开发</h3><h4 id="代码开发-梳理交互过程-6"><a href="#代码开发-梳理交互过程-6" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下前端页面和服务端的交互过程:</p>
<p>1、页面(front&#x2F;index.html)发送ajax请求，获取分类数据（菜品分类和套餐分类)</p>
<p>2、页面发送ajax请求，获取第一个分类下的菜品或者套餐</p>
<p>开发菜品展示功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p>
<p>注意:首页加载完成后，还发送了一次ajax请求用于加载购物车数据，此处可以将这次请求的地址暂时修改一下，从静态json文件获取数据，等后续开发购物车功能时再修改回来，如下:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//获取购物车内商品的集合</span><br>function cartListApi(<span class="hljs-keyword">data</span>) &#123;<br>    <span class="hljs-keyword">return</span> $axios(&#123;<br>        <span class="hljs-comment">// &#x27;url&#x27;: &#x27;/shoppingCart/list&#x27;,</span><br>        <span class="hljs-string">&#x27;url&#x27;</span>:<span class="hljs-string">&#x27;/front/cartData.json&#x27;</span>,<br>        <span class="hljs-string">&#x27;method&#x27;</span>: <span class="hljs-string">&#x27;get&#x27;</span>,<br>        params:&#123;...<span class="hljs-keyword">data</span>&#125;<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>cartData.json:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&#123;<span class="hljs-string">&quot;code&quot;</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span>,<span class="hljs-string">&quot;msg&quot;</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">&quot;data&quot;</span><span class="hljs-symbol">:[]</span>,<span class="hljs-string">&quot;map&quot;</span><span class="hljs-symbol">:</span>&#123;&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>改造DishController中的list方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  根据条件查询对应的菜品数据（改造后的，用于移动端显示）</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Dish dish)</span>&#123;<br>    <span class="hljs-comment">//构造查询条件</span><br>    LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    queryWrapper.eq(dish.getCategoryId() != <span class="hljs-literal">null</span> ,Dish::getCategoryId,dish.getCategoryId());<br>    <span class="hljs-comment">//添加条件，查询状态为1（起售状态）的菜品</span><br>    queryWrapper.eq(Dish::getStatus,<span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">//添加排序条件</span><br>    queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);<br><br>    List&lt;Dish&gt; list = dishService.list(queryWrapper);<br><br>    List&lt;DishDto&gt; dishDtoList = list.stream().map((item) -&gt; &#123;<br>        <span class="hljs-type">DishDto</span> <span class="hljs-variable">dishDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DishDto</span>();<br><br>        BeanUtils.copyProperties(item,dishDto);<br><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> item.getCategoryId();<span class="hljs-comment">//分类id</span><br>        <span class="hljs-comment">//根据id查询分类对象</span><br>        <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br><br>        <span class="hljs-keyword">if</span>(category != <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">categoryName</span> <span class="hljs-operator">=</span> category.getName();<br>            dishDto.setCategoryName(categoryName);<br>        &#125;<br><br>        <span class="hljs-comment">//当前菜品的id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">dishId</span> <span class="hljs-operator">=</span> item.getId();<br>        LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        lambdaQueryWrapper.eq(DishFlavor::getDishId,dishId);<br>        <span class="hljs-comment">//SQL:select * from dish_flavor where dish_id = ?</span><br>        List&lt;DishFlavor&gt; dishFlavorList = dishFlavorService.list(lambdaQueryWrapper);<br>        dishDto.setFlavors(dishFlavorList);<br>        <span class="hljs-keyword">return</span> dishDto;<br>    &#125;).collect(Collectors.toList());<br><br>    <span class="hljs-keyword">return</span> R.success(dishDtoList);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在SetmealController里添加list方法显示套餐信息</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs perl">/**<br> *  显示套餐信息<br> * @param setmeal，传过来的long型categoryId参数封装成setmeal对象<br> * @return<br> *  <span class="hljs-regexp">//</span> 请求的URL http:<span class="hljs-regexp">//l</span>ocalhost:<span class="hljs-number">8080</span>/setmeal/list?categoryId=<span class="hljs-number">1413342269393674242</span>&amp;status=<span class="hljs-number">1</span><br> *<span class="hljs-regexp">/</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">@GetMapping(&quot;/lis</span>t<span class="hljs-string">&quot;)</span><br><span class="hljs-string">public R&lt;List&lt;Setmeal&gt;&gt; list(Setmeal setmeal)&#123;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="hljs-string">    queryWrapper.eq(setmeal !=null, Setmeal::getCategoryId,setmeal.getCategoryId());</span><br><span class="hljs-string">    // 查询套餐售卖状态，</span><br><span class="hljs-string">    queryWrapper.eq(setmeal!=null, Setmeal::getStatus,setmeal.getStatus());</span><br><span class="hljs-string">    // 设置条件：排序展示</span><br><span class="hljs-string">    queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    List&lt;Setmeal&gt; list = setmealService.list(queryWrapper);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    return R.success(list);</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<h3 id="功能测试-2"><a href="#功能测试-2" class="headerlink" title="功能测试"></a>功能测试</h3><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354160.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h2><h3 id="需求分析-20"><a href="#需求分析-20" class="headerlink" title="需求分析"></a>需求分析</h3><p>移动端用户可以将菜品或者套餐添加到购物车。对于菜品来说，如果设置了口味信息，则需要选择规格后才能加入购物车;对于套餐来说，可以直接点击 <strong>[+]</strong> 将当前套餐加入购物车。在购物车中可以修改菜品和套餐的数量,也可以清空购物车。</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354360.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="数据模型-6"><a href="#数据模型-6" class="headerlink" title="数据模型"></a>数据模型</h3><p>购物车对应的数据表为shopping_cart表，具体表结构如下:<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354139.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="代码开发-11"><a href="#代码开发-11" class="headerlink" title="代码开发"></a>代码开发</h3><h4 id="代码开发-梳理交互过程-7"><a href="#代码开发-梳理交互过程-7" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下购物车操作时前端页面和服务端的交互过程:</p>
<p>1、点击 <strong>[加入购物车]</strong> 或者 <strong>[+]</strong> 按钮，页面发送ajax请求，请求服务端，将菜品或者套餐添加到购物车</p>
<p>2、点击购物车图标，页面发送ajax请求，请求服务端查询购物车中的菜品和套餐</p>
<p>3、点击清空购物车按钮，页面发送ajax请求，请求服务端来执行清空购物车操作</p>
<p>开发购物车功能，其实就是在服务端编写代码去处理前端页面发送的这3次请求即可。</p>
<h4 id="代码开发-准备工作-2"><a href="#代码开发-准备工作-2" class="headerlink" title="代码开发-准备工作"></a>代码开发-准备工作</h4><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好:</p>
<ul>
<li>实体类ShoppingCart(直接从课程资料中导入即可)</li>
<li>Mapper接口ShoppingCartMapper</li>
<li>业务层接口ShoppingcartService</li>
<li>业务层实现类ShoppingCartServicelmpl</li>
<li>控制层ShoppingCartController</li>
</ul>
<h4 id="代码开发-添加购物车"><a href="#代码开发-添加购物车" class="headerlink" title="代码开发-添加购物车"></a>代码开发-添加购物车</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs perl">/**<br> *  添加购物车<br> * @param shoppingCart<br> * @return<br> *<span class="hljs-regexp">/</span><br><span class="hljs-regexp">@PostMapping(&quot;/add</span><span class="hljs-string">&quot;)</span><br><span class="hljs-string">public R&lt;ShoppingCart&gt; add(@RequestBody ShoppingCart shoppingCart)&#123;</span><br><span class="hljs-string">    log.info(&quot;</span>购物车数据：&#123;&#125;<span class="hljs-string">&quot;, shoppingCart);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    // 设置用户id，指定当前是哪个用户的购物车数据</span><br><span class="hljs-string">    Long currentId = BaseContext.getCurrentId();// 获取当前线程的用户id（对应的是user表），用来当作用户id</span><br><span class="hljs-string">    shoppingCart.setUserId(currentId);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    // 查询当前菜品或者套餐是否在购物车中</span><br><span class="hljs-string">    Long dishId = shoppingCart.getDishId();// 从请求的参数中获取菜品id</span><br><span class="hljs-string"></span><br><span class="hljs-string">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="hljs-string">    queryWrapper.eq(ShoppingCart::getUserId,currentId); // 查询线程id的值</span><br><span class="hljs-string"></span><br><span class="hljs-string">    if (dishId !=null)&#123;</span><br><span class="hljs-string">        // 前端代表传过来的是菜品id，添加到购物车的是菜品dish</span><br><span class="hljs-string">        queryWrapper.eq(ShoppingCart::getDishId,dishId);</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">    &#125;else &#123;</span><br><span class="hljs-string">        // 添加到购物车的是套餐</span><br><span class="hljs-string">        // 定义查询条件</span><br><span class="hljs-string">        queryWrapper.eq(ShoppingCart::getSetmealId,shoppingCart.getSetmealId());</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    // 查询当前菜品或者套餐是否在购物车中</span><br><span class="hljs-string">    // SQL: select * from shopping_cart where user_id = ? and dish_id/setmeal_id = ?</span><br><span class="hljs-string">    ShoppingCart cartServiceOne = shoppingCartService.getOne(queryWrapper);// 根据条件调用业务层方法查询</span><br><span class="hljs-string"></span><br><span class="hljs-string">    if (cartServiceOne !=null)&#123;</span><br><span class="hljs-string">        // 不为空，说明查到了，这个菜品/套餐已存在，，在原来的基础上加1</span><br><span class="hljs-string">        Integer number = cartServiceOne.getNumber();</span><br><span class="hljs-string">        cartServiceOne.setNumber(number + 1);</span><br><span class="hljs-string">        shoppingCartService.updateById(cartServiceOne); // 更新数据库对象</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &#125;else &#123;</span><br><span class="hljs-string">        // 为空，就代表没查到，菜品/套餐不存在，则添加到购物车，数据默认就是1</span><br><span class="hljs-string">        shoppingCart.setNumber(1);</span><br><span class="hljs-string">         // 设置入库的create_time</span><br><span class="hljs-string">        shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="hljs-string">        shoppingCartService.save(shoppingCart);// 将对象添加进去</span><br><span class="hljs-string">        cartServiceOne = shoppingCart; // cartServiceOne是根据queryWrapper条件查询到的对象，将新的参数对象赋值</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">    return R.success(cartServiceOne);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<h4 id="代码开发-查看购物车"><a href="#代码开发-查看购物车" class="headerlink" title="代码开发-查看购物车"></a>代码开发-查看购物车</h4><p>把前端假数据改回来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">function <span class="hljs-title function_">cartListApi</span><span class="hljs-params">(data)</span> &#123;<br>    <span class="hljs-keyword">return</span> $axios(&#123;<br>        <span class="hljs-string">&#x27;url&#x27;</span>: <span class="hljs-string">&#x27;/shoppingCart/list&#x27;</span>,<br>        <span class="hljs-comment">// &#x27;url&#x27;:&#x27;/front/cartData.json&#x27;,</span><br>        <span class="hljs-string">&#x27;method&#x27;</span>: <span class="hljs-string">&#x27;get&#x27;</span>,<br>        params:&#123;...data&#125;<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>查看购物车  – 不用user账号中的购物车信息都不一样，因为购物车数据表和user数据表中的userid关联了，会根据不同的userid，不查询购物车表对应的数据</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs swift"> <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  清空购物车</span><br><span class="hljs-comment">     * @return</span><br><span class="hljs-comment">     */</span><br><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/list&quot;</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-type">R</span>&lt;<span class="hljs-type">List</span>&lt;<span class="hljs-type">ShoppingCart</span>&gt;&gt; list()&#123;<br>    log.info(<span class="hljs-string">&quot;查看购物车&quot;</span>);<br>    <span class="hljs-type">LambdaQueryWrapper</span>&lt;<span class="hljs-type">ShoppingCart</span>&gt; queryWrapper<span class="hljs-operator">=</span>new <span class="hljs-type">LambdaQueryWrapper</span>&lt;&gt;();<br>    queryWrapper.eq(ShoppingCart::getUserId,<span class="hljs-type">BaseContext</span>.getCurrentId());<br>    queryWrapper.orderByDesc(ShoppingCart::getCreateTime);<br>    <span class="hljs-type">List</span>&lt;<span class="hljs-type">ShoppingCart</span>&gt; list <span class="hljs-operator">=</span> shoppingcartService.list(queryWrapper);<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">R</span>.success(list);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="代码开发-清空购物车"><a href="#代码开发-清空购物车" class="headerlink" title="代码开发-清空购物车"></a>代码开发-清空购物车</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs perl">@DeleteMapping(<span class="hljs-string">&quot;/clean&quot;</span>)<br>public R&lt;String&gt; clean()&#123;<br><br>    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper=new LambdaQueryWrapper&lt;&gt;();<br>    queryWrapper.e<span class="hljs-string">q(ShoppingCart::getUserId,BaseContext.getCurrentId()</span>);<br>    shoppingcartService.remove(queryWrapper);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;清空购物车成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="代码开发-减少菜品"><a href="#代码开发-减少菜品" class="headerlink" title="代码开发-减少菜品"></a>代码开发-减少菜品</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs perl"> /**<br>     *  删除购物车菜品<br>     * @param shoppingCart<br>     * @return<br>     *<span class="hljs-regexp">/</span><br><span class="hljs-regexp">@PostMapping(&quot;/su</span>b<span class="hljs-string">&quot;)</span><br><span class="hljs-string">public R&lt;ShoppingCart&gt; sub(@RequestBody ShoppingCart shoppingCart)&#123;</span><br><span class="hljs-string">    Long setmealId = shoppingCart.getSetmealId();</span><br><span class="hljs-string">    Long dishId = shoppingCart.getDishId();</span><br><span class="hljs-string">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper=new LambdaQueryWrapper&lt;&gt;();</span><br><span class="hljs-string">    queryWrapper.eq(ShoppingCart::getUserId,BaseContext.getCurrentId());</span><br><span class="hljs-string"></span><br><span class="hljs-string">    if (setmealId!=null)&#123;</span><br><span class="hljs-string">        queryWrapper.eq(ShoppingCart::getSetmealId,setmealId);</span><br><span class="hljs-string">    &#125;else &#123;</span><br><span class="hljs-string">        queryWrapper.eq(ShoppingCart::getDishId,dishId);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    ShoppingCart one = shoppingcartService.getOne(queryWrapper);</span><br><span class="hljs-string">    Integer number = one.getNumber();</span><br><span class="hljs-string">    if(number==1)&#123;</span><br><span class="hljs-string">        shoppingcartService.remove(queryWrapper);</span><br><span class="hljs-string">    &#125;else &#123;</span><br><span class="hljs-string">        one.setNumber(number-1);</span><br><span class="hljs-string">        shoppingcartService.updateById(one);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    return R.success(one);</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354695.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="下单"><a href="#下单" class="headerlink" title="下单"></a>下单</h2><h3 id="需求分析-21"><a href="#需求分析-21" class="headerlink" title="需求分析"></a>需求分析</h3><p>移动端用户将菜品或者套餐加入购物车后，可以点击购物车中的 <strong>【去结算】</strong> 按钮，页面跳转到订单确认页面，点击 <strong>【去支付】</strong> 按钮则完成下单操作。</p>
<h3 id="数据模型-7"><a href="#数据模型-7" class="headerlink" title="数据模型"></a>数据模型</h3><p>用户下单业务对应的数据表为orders表和order_detail表:</p>
<ul>
<li>orders:订单表<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354660.png" srcset="/img/loading.gif" lazyload alt="image"></li>
<li>order_detail:订单明细表<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354672.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<h3 id="代码开发-12"><a href="#代码开发-12" class="headerlink" title="代码开发"></a>代码开发</h3><h4 id="代码开发-梳理交互过程-8"><a href="#代码开发-梳理交互过程-8" class="headerlink" title="代码开发-梳理交互过程"></a>代码开发-梳理交互过程</h4><p>在开发代码之前，需要梳理一下用户下单操作时前端页面和服务端的交互过程:</p>
<p>1、在购物车中点击 <strong>【去结算】</strong> 按钮，页面跳转到订单确认页面</p>
<p>2、在订单确认页面，发送ajax请求，请求服务端获取当前登录用户的默认地址</p>
<p>3、在订单确认页面，发送ajax请求，请求服务端获取当前登录用户的购物车数据</p>
<p>4、在订单确认页面点击 <strong>【去支付】</strong> 按钮，发送ajax请求，请求服务端完成下单操作</p>
<p>开发用户下单功能，其实就是在服务端编写代码去处理前端页面发送的请求即可。</p>
<h4 id="代码开发-准备工作-3"><a href="#代码开发-准备工作-3" class="headerlink" title="代码开发-准备工作"></a>代码开发-准备工作</h4><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好:</p>
<ul>
<li>实体类Orders、OrderDetail（直接从课程资料中导入即可)</li>
<li>Mapper接口OrderMapper、OrderDetailMapper</li>
<li>业务层接口OrderService、OrderDetailService</li>
<li>业务层实现类OrderServicelmpl、OrderDetailServicelmpl</li>
<li>控制层OrderController、OrderDetailController</li>
</ul>
<h4 id="代码开发-13"><a href="#代码开发-13" class="headerlink" title="代码开发"></a>代码开发</h4><p>在OrderService添加submit方法用于用户下单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;OrderMapper, Orders&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShoppingCartService shoppingCartService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AddressBookService addressBookService;<br>    <span class="hljs-comment">// 注入订单明细的对象</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderDetailService orderDetailService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  用户下单</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orders</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Transactional</span> <span class="hljs-comment">// 由于要操作多次数据库，和多张表，要保证事务的一致性，</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submit</span><span class="hljs-params">(Orders orders)</span> &#123;<br><br>        <span class="hljs-comment">// 获得当前用户id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>        <span class="hljs-comment">// 查询当前用户的购物车数据</span><br>        LambdaQueryWrapper&lt;ShoppingCart&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        wrapper.eq(ShoppingCart::getUserId, userId);<br>        <span class="hljs-comment">// 根据条件userId查询购物车的数据（所以调用购物车的业务层对象）</span><br>        List&lt;ShoppingCart&gt; shoppingCarts = shoppingCartService.list(wrapper);<span class="hljs-comment">// 查到的是一个集合</span><br><br>        <span class="hljs-keyword">if</span> (shoppingCarts == <span class="hljs-literal">null</span> || shoppingCarts.size() == <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 如果购物车对象为null，或者购物车对象的数量为0</span><br>            <span class="hljs-comment">// 就抛异常</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomException</span>(<span class="hljs-string">&quot;购物车为空，不能下单&quot;</span>);<br><br>        &#125;<br>        <span class="hljs-comment">// 查询用户数据</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getById(userId);<br><br>        <span class="hljs-comment">// 查询地址数据</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">addressBookId</span> <span class="hljs-operator">=</span> orders.getAddressBookId();<br>        <span class="hljs-type">AddressBook</span> <span class="hljs-variable">addressBook</span> <span class="hljs-operator">=</span> addressBookService.getById(addressBookId);<br>        <span class="hljs-keyword">if</span> (addressBook == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomException</span>(<span class="hljs-string">&quot;用户地址信息有误，不能下单&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//IdWorker 是mp提供的类，使用其getId方法，生成唯一id，当作我们的订单号</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> IdWorker.getId(); <span class="hljs-comment">// 订单号</span><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * AtomicInteger是一个提供原子操作的Integer类，通过线程安全的方式操作加减。</span><br><span class="hljs-comment">         * AtomicInteger 是对int 类型的一个封装，提供原子性的访问和更新操作</span><br><span class="hljs-comment">         * 其原子性的操作实现是基于CAS (compare-and-swap)技术</span><br><span class="hljs-comment">         * 如果当前数值不变，代码没有其他线程进行并发修改，则成功更新。</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-comment">// 这里简单理解就是创建了一个更加安全的Integer类，起始值为0，这个类在多线程保证安全</span><br>        <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// amout是金额对象</span><br><br><br>        List&lt;OrderDetail&gt; orderDetails = shoppingCarts.stream().map((item) -&gt; &#123;<br>            <span class="hljs-type">OrderDetail</span> <span class="hljs-variable">orderDetail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDetail</span>();<br>            orderDetail.setOrderId(orderId);<br>            orderDetail.setNumber(item.getNumber());<br>            orderDetail.setDishFlavor(item.getDishFlavor());<br>            orderDetail.setDishId(item.getDishId());<br>            orderDetail.setSetmealId(item.getSetmealId());<br>            orderDetail.setName(item.getName());<br>            orderDetail.setImage(item.getImage());<br>            orderDetail.setAmount(item.getAmount());<br>            amount.addAndGet(item.getAmount().multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(item.getNumber())).intValue());<br>            <span class="hljs-keyword">return</span> orderDetail;<br>        &#125;).collect(Collectors.toList());<br><br><br>        <span class="hljs-comment">// 向订单表插入数据，一条数据</span><br>        orders.setId(orderId);<br>        orders.setOrderTime(LocalDateTime.now());<br>        orders.setCheckoutTime(LocalDateTime.now());<br><span class="hljs-comment">//        订单状态 1待付款，2待派送，3已派送，4已完成，5已取消</span><br>        orders.setStatus(<span class="hljs-number">2</span>);<br>        orders.setAmount(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(amount.get()));<span class="hljs-comment">//计算总金额</span><br>        orders.setUserId(userId);<br>        orders.setUserName(user.getName());<br>        orders.setConsignee(addressBook.getConsignee()); <span class="hljs-comment">// 获取收货人属性对象</span><br>        orders.setPhone(addressBook.getPhone());<br>        orders.setAddress((addressBook.getProvinceName() == <span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;&quot;</span> : addressBook.getProvinceName())<br>                + (addressBook.getCityName() == <span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;&quot;</span> : addressBook.getCityName())<br>                + (addressBook.getDistrictName() == <span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;&quot;</span> : addressBook.getDistrictName())<br>                + (addressBook.getDetail() == <span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;&quot;</span> : addressBook.getDetail()));<br><br>        <span class="hljs-comment">// 向订单表插入数据，一条数据</span><br>        <span class="hljs-built_in">this</span>.save(orders);<br><br>        <span class="hljs-comment">// 向订单明细表插入数据，多条数据</span><br>        orderDetailService.saveBatch(orderDetails);<span class="hljs-comment">// saveBatch是mp添加一个集合对象，list()是查询一个集合</span><br><br>        <span class="hljs-comment">// 清空购物车数据</span><br>        shoppingCartService.remove(wrapper);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在OrderController的submit方法处理post请求实现上面的方法</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">//用户下单</span><br><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/submit&quot;</span>)<br>public R&lt;String&gt; submit(<span class="hljs-variable">@RequestBody</span> Orders orders)&#123;<br>    <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">&quot;订单数据:&#123;&#125;&quot;</span>,orders);<br>    <span class="hljs-selector-tag">orderService</span><span class="hljs-selector-class">.submit</span>(orders);<br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">&quot;下单成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="功能测试-3"><a href="#功能测试-3" class="headerlink" title="功能测试"></a>功能测试</h4><p>下单界面：<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354608.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>下单成功界面：<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354606.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="功能补充"><a href="#功能补充" class="headerlink" title="功能补充"></a>功能补充</h2><p>补充教程视频中未实现的方法（纯菜鸡手打，若读者发现bug或者更好的方法，欢迎评论补充TVT,虽然肯定没人看）</p>
<h3 id="用户登出"><a href="#用户登出" class="headerlink" title="用户登出"></a>用户登出</h3><p>在UserController添加loginout方法</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//用户登出</span><br><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/loginout&quot;</span>)<br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">loginout</span>(<span class="hljs-params">HttpServletRequest request</span>)&#123;<br>    <span class="hljs-comment">//清理Session中保存的当前用户登录的id</span><br>    request.<span class="hljs-title function_">getSession</span>().<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-string">&quot;user&quot;</span>);<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;退出成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="订单管理"><a href="#订单管理" class="headerlink" title="订单管理"></a>订单管理</h3><p>导入OrderDto需手动添加<code>private int sumNum;</code>（前端会计算数量）</p>
<p>在OrderController添加userPage方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//订单管理</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-meta">@GetMapping(&quot;/userPage&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">userPage</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize)</span>&#123;<br>    <span class="hljs-comment">//构造分页构造器</span><br>    Page&lt;Orders&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, pageSize);<br><br>    Page&lt;OrdersDto&gt; ordersDtoPage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;();<br><br>    <span class="hljs-comment">//构造条件构造器</span><br>    LambdaQueryWrapper&lt;Orders&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br><br>    <span class="hljs-comment">//添加排序条件</span><br>    queryWrapper.orderByDesc(Orders::getOrderTime);<br><br>    <span class="hljs-comment">//进行分页查询</span><br>    orderService.page(pageInfo,queryWrapper);<br><br>    <span class="hljs-comment">//对象拷贝</span><br>    BeanUtils.copyProperties(pageInfo,ordersDtoPage,<span class="hljs-string">&quot;records&quot;</span>);<br><br>    List&lt;Orders&gt; records=pageInfo.getRecords();<br><br>    List&lt;OrdersDto&gt; list = records.stream().map((item) -&gt; &#123;<br>        <span class="hljs-type">OrdersDto</span> <span class="hljs-variable">ordersDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrdersDto</span>();<br><br>        BeanUtils.copyProperties(item, ordersDto);<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">Id</span> <span class="hljs-operator">=</span> item.getId();<br>        <span class="hljs-comment">//根据id查分类对象</span><br>        <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> orderService.getById(Id);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> orders.getNumber();<br>        LambdaQueryWrapper&lt;OrderDetail&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        lambdaQueryWrapper.eq(OrderDetail::getOrderId,number);<br>        List&lt;OrderDetail&gt; orderDetailList = orderDetailService.list(lambdaQueryWrapper);<br>        <span class="hljs-type">int</span> num=<span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">for</span>(OrderDetail l:orderDetailList)&#123;<br>            num+=l.getNumber().intValue();<br>        &#125;<br><br>        ordersDto.setSumNum(num);<br>        <span class="hljs-keyword">return</span> ordersDto;<br>    &#125;).collect(Collectors.toList());<br><br>    ordersDtoPage.setRecords(list);<br>    <br>    <span class="hljs-keyword">return</span> R.success(ordersDtoPage);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="再来一单"><a href="#再来一单" class="headerlink" title="再来一单"></a>再来一单</h3><p>用户可以通过该方法快速再下一单</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354849.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>在OrderController中添加again方法处理post请求</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//再来一单</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/again&quot;</span>)<br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">again</span>(<span class="hljs-params"><span class="hljs-meta">@RequestBody</span> Orders order1</span>)&#123;<br>    <span class="hljs-comment">//取得orderId</span><br>    <span class="hljs-title class_">Long</span> id = order1.<span class="hljs-title function_">getId</span>();<br>    <span class="hljs-title class_">Orders</span> orders = orderService.<span class="hljs-title function_">getById</span>(id);<br>    <span class="hljs-comment">//设置订单号码</span><br>    long orderId = <span class="hljs-title class_">IdWorker</span>.<span class="hljs-title function_">getId</span>();<br>    orders.<span class="hljs-title function_">setId</span>(orderId);<br>    <span class="hljs-comment">//设置订单号码</span><br>    <span class="hljs-title class_">String</span> <span class="hljs-built_in">number</span> = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">IdWorker</span>.<span class="hljs-title function_">getId</span>());<br>    orders.<span class="hljs-title function_">setNumber</span>(<span class="hljs-built_in">number</span>);<br>    <span class="hljs-comment">//设置下单时间</span><br>    orders.<span class="hljs-title function_">setOrderTime</span>(<span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br>    orders.<span class="hljs-title function_">setCheckoutTime</span>(<span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br>    orders.<span class="hljs-title function_">setStatus</span>(<span class="hljs-number">2</span>);<br>    <span class="hljs-comment">//向订单表中插入一条数据</span><br>    orderService.<span class="hljs-title function_">save</span>(orders);<br>    <span class="hljs-comment">//修改订单明细表</span><br>    <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;<span class="hljs-title class_">OrderDetail</span>&gt; queryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    queryWrapper.<span class="hljs-title function_">eq</span>(<span class="hljs-title class_">OrderDetail</span>::getOrderId,id);<br>    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">OrderDetail</span>&gt; list = orderDetailService.<span class="hljs-title function_">list</span>(queryWrapper);<br>    list.<span class="hljs-title function_">stream</span>().<span class="hljs-title function_">map</span>((item)-&gt;&#123;<br>        <span class="hljs-comment">//订单明细表id</span><br>        long detailId = <span class="hljs-title class_">IdWorker</span>.<span class="hljs-title function_">getId</span>();<br>        <span class="hljs-comment">//设置订单号码</span><br>        item.<span class="hljs-title function_">setOrderId</span>(orderId);<br>        item.<span class="hljs-title function_">setId</span>(detailId);<br>        <span class="hljs-keyword">return</span> item;<br>    &#125;).<span class="hljs-title function_">collect</span>(<span class="hljs-title class_">Collectors</span>.<span class="hljs-title function_">toList</span>());<br><br>    <span class="hljs-comment">//向订单明细表中插入多条数据</span><br>    orderDetailService.<span class="hljs-title function_">saveBatch</span>(list);<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;再来一单&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="管理端订单明细"><a href="#管理端订单明细" class="headerlink" title="管理端订单明细"></a>管理端订单明细</h3><p>在OrderController添加page方法处理get请求</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/page&quot;</span>)<br><span class="hljs-keyword">public</span> R&lt;<span class="hljs-title class_">Page</span>&gt; <span class="hljs-title function_">page</span>(<span class="hljs-params">int page, int pageSize, <span class="hljs-built_in">String</span> <span class="hljs-built_in">number</span>,<span class="hljs-built_in">String</span> beginTime,<span class="hljs-built_in">String</span> endTime</span>)&#123;<br>    <span class="hljs-comment">//构造分页构造器</span><br>    <span class="hljs-title class_">Page</span>&lt;<span class="hljs-title class_">Orders</span>&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, pageSize);<br><br>    <span class="hljs-title class_">Page</span>&lt;<span class="hljs-title class_">OrdersDto</span>&gt; ordersDtoPage=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;();<br>    <span class="hljs-comment">//构造条件构造器</span><br>    <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;<span class="hljs-title class_">Orders</span>&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">//根据number进行模糊查询</span><br>    queryWrapper.<span class="hljs-title function_">like</span>(!<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-built_in">number</span>),<span class="hljs-title class_">Orders</span>::getNumber,<span class="hljs-built_in">number</span>);<br>    <span class="hljs-comment">//根据Datetime进行时间范围查询</span><br><br><span class="hljs-comment">//        log.info(&quot;开始时间：&#123;&#125;&quot;,beginTime);</span><br><span class="hljs-comment">//        log.info(&quot;结束时间：&#123;&#125;&quot;,endTime);</span><br>    <span class="hljs-keyword">if</span>(beginTime!=<span class="hljs-literal">null</span>&amp;&amp;endTime!=<span class="hljs-literal">null</span>)&#123;<br>        queryWrapper.<span class="hljs-title function_">ge</span>(<span class="hljs-title class_">Orders</span>::getOrderTime,beginTime);<br>        queryWrapper.<span class="hljs-title function_">le</span>(<span class="hljs-title class_">Orders</span>::getOrderTime,endTime);<br>    &#125;<br>    <span class="hljs-comment">//添加排序条件</span><br>    queryWrapper.<span class="hljs-title function_">orderByDesc</span>(<span class="hljs-title class_">Orders</span>::getOrderTime);<br><br>    <span class="hljs-comment">//进行分页查询</span><br>    orderService.<span class="hljs-title function_">page</span>(pageInfo,queryWrapper);<br><br>    <span class="hljs-comment">//对象拷贝</span><br>    <span class="hljs-title class_">BeanUtils</span>.<span class="hljs-title function_">copyProperties</span>(pageInfo,ordersDtoPage,<span class="hljs-string">&quot;records&quot;</span>);<br><br>    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Orders</span>&gt; records=pageInfo.<span class="hljs-title function_">getRecords</span>();<br><br>    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">OrdersDto</span>&gt; list=records.<span class="hljs-title function_">stream</span>().<span class="hljs-title function_">map</span>((item)-&gt;&#123;<br>        <span class="hljs-title class_">OrdersDto</span> ordersDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrdersDto</span>();<br><br>        <span class="hljs-title class_">BeanUtils</span>.<span class="hljs-title function_">copyProperties</span>(item,ordersDto);<br>        <span class="hljs-title class_">String</span> name=<span class="hljs-string">&quot;用户&quot;</span>+item.<span class="hljs-title function_">getUserId</span>();<br>        ordersDto.<span class="hljs-title function_">setUserName</span>(name);<br>        <span class="hljs-keyword">return</span> ordersDto;<br>    &#125;).<span class="hljs-title function_">collect</span>(<span class="hljs-title class_">Collectors</span>.<span class="hljs-title function_">toList</span>());<br><br>    ordersDtoPage.<span class="hljs-title function_">setRecords</span>(list);<br>    <span class="hljs-keyword">return</span> R.<span class="hljs-title function_">success</span>(ordersDtoPage);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354161.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="外卖订单派送"><a href="#外卖订单派送" class="headerlink" title="外卖订单派送"></a>外卖订单派送</h3><p>在OrderController处理post请求修改status</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@PutMapping</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">send</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Orders orders)</span>&#123;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> orders.getId();<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> orders.getStatus();<br>    LambdaQueryWrapper&lt;Orders&gt; queryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    queryWrapper.eq(Orders::getId,id);<br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> orderService.getOne(queryWrapper);<br>    one.setStatus(status);<br>    orderService.updateById(one);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;派送成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/202208080354171.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p><strong>为什么要学Linux ?</strong></p>
<ul>
<li>企业用人要求</li>
<li>个人发展要求</li>
</ul>
<p><strong>学习后能干什么？</strong><br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164500769-412957756.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h2 id="Linux简介"><a href="#Linux简介" class="headerlink" title="Linux简介"></a>Linux简介</h2><h3 id="不同应用领域的主流操作系统"><a href="#不同应用领域的主流操作系统" class="headerlink" title="不同应用领域的主流操作系统"></a>不同应用领域的主流操作系统</h3><ul>
<li>桌面操作系统<ul>
<li>Windows （用户数量最多)</li>
<li>Mac OS（操作体验好，办公人士首选)</li>
<li>Linux（用户数量少)</li>
</ul>
</li>
<li>服务器操作系统<ul>
<li>UNIX（安全、稳定、付费)</li>
<li>Linux（安全、稳定、免费、占有率高)</li>
<li>Windows Server (付费、占有率低)</li>
</ul>
</li>
<li>移动设备操作系统<ul>
<li>Android (基于Linux 、开源，主要用于智能手机、平板电脑和智能电视)</li>
<li>ios（苹果公司开发、不开源，用于苹果公司的产品，例如: iPhone、iPad )</li>
</ul>
</li>
<li>嵌入式操作系统<ul>
<li>Linux（机顶盒、路由器、交换机)</li>
</ul>
</li>
</ul>
<h3 id="Linux发展历史"><a href="#Linux发展历史" class="headerlink" title="Linux发展历史"></a>Linux发展历史</h3><p>Linux系统历史</p>
<ul>
<li>时间:1991年</li>
<li>地点:芬兰赫尔辛基大学</li>
<li>人物:Linus Torvalds ( 21岁)</li>
<li>语言:C语言、汇编语言</li>
<li>logo:企鹅</li>
<li>特点:免费、开源、多用户、多任务</li>
</ul>
<h3 id="Linux系统版本"><a href="#Linux系统版本" class="headerlink" title="Linux系统版本"></a>Linux系统版本</h3><p>Linux系统分为内核版和发行版</p>
<ul>
<li>内核版<ul>
<li>由Linus Torvalds及其团队开发、维护</li>
<li>免费、开源</li>
<li>负责控制硬件</li>
</ul>
</li>
<li>发行版<ul>
<li>基于Linux内核版进行扩展</li>
<li>由各个Linux厂商开发、维护</li>
<li>有收费版本和免费版本</li>
</ul>
</li>
</ul>
<p><strong>Linux系统发行版</strong>:</p>
<ul>
<li>ubuntu:以桌面应用为主·</li>
<li>RedHat:应用最广泛、收费</li>
<li>CentOs: RedHat的社区版、免费·</li>
<li>opensuSE:对个人完全免费、图形界面华丽</li>
<li>Fedora:功能完备、快速更新、免费</li>
<li>红旗Linux:北京中科红旗软件技术有限公司开发<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164510201-1893673796.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<h2 id="Linux安装"><a href="#Linux安装" class="headerlink" title="Linux安装"></a>Linux安装</h2><h3 id="安装方式介绍"><a href="#安装方式介绍" class="headerlink" title="安装方式介绍"></a>安装方式介绍</h3><p>Linux系统的安装方式</p>
<ul>
<li>物理机安装:直接将操作系统安装到服务器硬件上</li>
<li>虚拟机安装:通过虚拟机软件安装</li>
</ul>
<p><strong>虚拟机</strong>( Virtual Machine)指通过<strong>软件</strong>模拟的具有完整硬件系统功能、运行在完全隔离环境中的完整计算机系统。</p>
<p>常用虚拟机软件</p>
<ul>
<li>VMware</li>
<li>VirtualBox</li>
<li>VMLite workStation</li>
<li>Qemu</li>
<li>HopeddotVos</li>
</ul>
<h3 id="安装Linux"><a href="#安装Linux" class="headerlink" title="安装Linux"></a>安装Linux</h3><p><strong>安装方式-安装VMWare</strong></p>
<p>直接双击运行资料中的VMware安装程序，根据提示完成安装即可</p>
<p><strong>安装CentOS镜像</strong></p>
<p>使用资料中提供的CentOS镜像文件来完成Linux系统的安装</p>
<h3 id="网卡设置"><a href="#网卡设置" class="headerlink" title="网卡设置"></a>网卡设置</h3><p>由于启动服务器时未加载网卡，导致IP地址初始化失败</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164517145-1413567992.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>修改网络初始化配置，设定网卡在系统启动时初始化<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164525095-1179631425.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="安装SSH连接工具"><a href="#安装SSH连接工具" class="headerlink" title="安装SSH连接工具"></a>安装SSH连接工具</h3><p>SSH ( Secure Shell)，建立在应用层基础上的安全协议</p>
<p>常用的SSH连接工具</p>
<ul>
<li>putty</li>
<li>secureCRT</li>
<li>xshell</li>
<li>finalshell</li>
</ul>
<p>通过SSH连接工具就可以实现从本地连接到远程的Linux服务器</p>
<h3 id="Linux和windows目录结构对比"><a href="#Linux和windows目录结构对比" class="headerlink" title="Linux和windows目录结构对比"></a>Linux和windows目录结构对比</h3><p>Linux系统中的目录</p>
<ul>
<li>&#x2F;是所有目录的顶点</li>
<li>目录结构像一颗倒挂的树<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164532669-2029309901.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<h3 id="Linux目录结构"><a href="#Linux目录结构" class="headerlink" title="Linux目录结构"></a>Linux目录结构</h3><ul>
<li>bin存放二进制可执行文件</li>
<li>boot存放系统引导时使用的各种文件</li>
<li>dev存放设备文件</li>
<li>etc存放系统配置文件</li>
<li>home存放系统用户的文件</li>
<li>lib存放程序运行所需的共享库和内核模块</li>
<li>opt额外安装的可选应用程序包所放置的位置</li>
<li>root超级用户目录</li>
<li>sbin存放二进制可执行文件，只有root用户才能访问</li>
<li>tmp存放临时文件</li>
<li>usr存放系统应用程序</li>
<li>var存放运行时需要改变数据的文件，例如日志文件<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164538098-689217035.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<h2 id="Linux常用命令"><a href="#Linux常用命令" class="headerlink" title="Linux常用命令"></a>Linux常用命令</h2><h3 id="Linux命令初体验"><a href="#Linux命令初体验" class="headerlink" title="Linux命令初体验"></a>Linux命令初体验</h3><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>ls</td>
<td>list</td>
<td>查看当前目录下的内容</td>
</tr>
<tr>
<td>2</td>
<td>pwd</td>
<td>print work directory</td>
<td>查看当前所在目录</td>
</tr>
<tr>
<td>3</td>
<td>cd [目录名]</td>
<td>change directory</td>
<td>切换目录</td>
</tr>
<tr>
<td>4</td>
<td>touch [文件名]</td>
<td>touch</td>
<td>如果文件不存在，新建文件</td>
</tr>
<tr>
<td>5</td>
<td>mkdir [目录名]</td>
<td>make directory</td>
<td>创建目录</td>
</tr>
<tr>
<td>6</td>
<td>rm [文件名]</td>
<td>remove</td>
<td>删除指定文件</td>
</tr>
</tbody></table>
<p><strong>使用技巧</strong></p>
<ul>
<li>Tab键自动补全</li>
<li>连续两次Tab键，给出操作提示</li>
<li>使用上下箭头快速调出曾经使用过的命令</li>
<li>使用clear命令或者Ctrl+l快捷键实现清屏</li>
</ul>
<p><strong>命令格式</strong></p>
<p>command 【-options】【parameter】</p>
<p>说明:</p>
<ul>
<li>command:命令名</li>
<li>【-options】:选项，可用来对命令进行控制，也可以省略</li>
<li>【parameter】:传给命令的参数，可以是零个、一个或者多个</li>
</ul>
<p>注意:</p>
<p>[]代表可选</p>
<p>命令名、选项、参数之间有空格进行分隔</p>
<h3 id="文件目录操作命令"><a href="#文件目录操作命令" class="headerlink" title="文件目录操作命令"></a>文件目录操作命令</h3><h4 id="文件目录操作命令ls"><a href="#文件目录操作命令ls" class="headerlink" title="文件目录操作命令ls"></a>文件目录操作命令<strong>ls</strong></h4><p>作用:显示指定目录下的内容</p>
<p>语法:ls [-al] [dir]</p>
<p>说明:</p>
<ul>
<li>-a显示所有文件及目录(.开头的隐藏文件也会列出)</li>
<li>-l除文件名称外，同时将文件型态(d表示目录，-表示文件)、权限、拥有者、文件大小等信息详细列出</li>
</ul>
<p>注意:<br>由于我们使用ls命令时经常需要加入-l选项，所以Linux为ls -l命令提供了一种简写方式，即ll</p>
<h4 id="文件目录操作命令cd"><a href="#文件目录操作命令cd" class="headerlink" title="文件目录操作命令cd"></a>文件目录操作命令<strong>cd</strong></h4><p>作用:用于切换当前工作目录，即进入指定目录</p>
<p>语法:cd [dirName]</p>
<p>特殊说明:</p>
<ul>
<li>~表示用户的home目录</li>
<li>.表示目前所在的目录</li>
<li>..表示目前目录位置的上级目录</li>
</ul>
<p>举例:</p>
<ul>
<li>cd ..<br>切换到当前目录的上级目录</li>
<li>cd ~<br>切换到用户的home目录</li>
<li>cd &#x2F;usr&#x2F;local 切换到&#x2F;usr&#x2F;local目录</li>
</ul>
<h4 id="文件目录操作命令cat"><a href="#文件目录操作命令cat" class="headerlink" title="文件目录操作命令cat"></a>文件目录操作命令<strong>cat</strong></h4><p>作用:用于显示文件内容</p>
<p>语法: cat [-n] fileName</p>
<p>说明:</p>
<ul>
<li>-n :由1开始对所有输出的行数编号</li>
</ul>
<p>举例:</p>
<ul>
<li>cat &#x2F;etc&#x2F;profile<br>查看&#x2F;etc目录下的profile文件内容</li>
</ul>
<h4 id="文件目录操作命令more"><a href="#文件目录操作命令more" class="headerlink" title="文件目录操作命令more"></a>文件目录操作命令<strong>more</strong></h4><p>作用:以分页的形式显示文件内容</p>
<p>语法: more fileName</p>
<p>操作说明:</p>
<ul>
<li>回车键<br>向下滚动一行</li>
<li>空格键<br>向下滚动一屏</li>
<li>b<br>返回上一屏</li>
<li>q或者Ctrl+C<br>退出more</li>
</ul>
<p>举例:</p>
<p>more &#x2F;etc&#x2F;profile<br>以分页方式显示&#x2F;etc目录下的profile文件内容</p>
<h4 id="文件目录操作命令tail"><a href="#文件目录操作命令tail" class="headerlink" title="文件目录操作命令tail"></a>文件目录操作命令<strong>tail</strong></h4><p>作用:查看文件末尾的内容</p>
<p>语法:tail [-f] fileName</p>
<p>说明:</p>
<ul>
<li>-f :动态读取文件末尾内容并显示，通常用于日志文件的内容输出</li>
</ul>
<p>举例:</p>
<ul>
<li>tail &#x2F;etc&#x2F;profile<br>显示&#x2F;etc目录下的profile文件末尾10行的内容</li>
<li>tail -20 &#x2F;etc&#x2F;profile<br>显示&#x2F;etc目录下的profile文件末尾20行的内容</li>
<li>tail -f &#x2F;itcast&#x2F;my.log<br>动态读取&#x2F;itcast目录下的my.log文件末尾内容并显示</li>
</ul>
<h4 id="文件目录操作命令mkdir"><a href="#文件目录操作命令mkdir" class="headerlink" title="文件目录操作命令mkdir"></a>文件目录操作命令<strong>mkdir</strong></h4><p>作用:创建目录</p>
<p>语法:mkdir [-p] dirName</p>
<p>说明:</p>
<ul>
<li>-p︰确保目录名称存在，不存在的就创建一个。通过此选项，可以实现多层目录同时创建</li>
</ul>
<p>举例:</p>
<ul>
<li>mkdir itcast　在当前目录下，建立一个名为itcast的子目录</li>
<li>mkdir-p itcast&#x2F;test　在工作目录下的itcast目录中建立一个名为test的子目录，若itcast目录不存在，则建立一个</li>
</ul>
<h4 id="文件目录操作命令rmdir"><a href="#文件目录操作命令rmdir" class="headerlink" title="文件目录操作命令rmdir"></a>文件目录操作命令rmdir</h4><p>作用:删除空目录</p>
<p>语法:rmdir [-p] dirName</p>
<p>说明:</p>
<ul>
<li>-p:当子目录被删除后使父目录为空目录的话，则一并删除</li>
</ul>
<p>举例:</p>
<ul>
<li>rmdir itcast　删除名为itcast的空目录</li>
<li>rmdir-p itcast&#x2F;test　删除itcast目录中名为test的子目录，若test目录删除后itcast目录变为空目录，则也被删除</li>
<li>rmdir itcast*　删除名称以itcast开始的空目录</li>
</ul>
<h4 id="文件目录操作命令rm"><a href="#文件目录操作命令rm" class="headerlink" title="文件目录操作命令rm"></a>文件目录操作命令rm</h4><p>作用:删除文件或者目录</p>
<p>语法:rm[-rf] name</p>
<p>说明:</p>
<ul>
<li>-r:将目录及目录中所有文件（目录）逐一删除，即递归删除</li>
<li>-f:无需确认，直接删除</li>
</ul>
<p>举例:</p>
<ul>
<li>rm -r itcast&#x2F;删除名为itcast的目录和目录中所有文件，删除前需确认</li>
<li>rm -rf itcast&#x2F;无需确认，直接删除名为itcast的目录和目录中所有文件</li>
<li>rm -f hello.txt无需确认，直接删除hello.txt文件</li>
</ul>
<h3 id="拷贝移动命令"><a href="#拷贝移动命令" class="headerlink" title="拷贝移动命令"></a>拷贝移动命令</h3><h4 id="拷贝移动命令cp"><a href="#拷贝移动命令cp" class="headerlink" title="拷贝移动命令cp"></a>拷贝移动命令cp</h4><p>作用:用于复制文件或目录语法:cp [-r] source dest</p>
<p>说明:</p>
<ul>
<li>-r:如果复制的是目录需要使用此选项，此时将复制该目录下所有的子目录和文件</li>
</ul>
<p>举例:</p>
<ul>
<li>cp hello.txt itcast&#x2F;<br>将hello.txt复制到itcast目录中</li>
<li>cp hello.txt . &#x2F; hi.txt<br>将hello.txt复制到当前目录，并改名为hi.txt</li>
<li>cp -r itcast&#x2F; .&#x2F;itheimal将itcast目录和目录下所有文件复制到itheima目录下</li>
<li>cp -r itcast&#x2F;* .&#x2F; itheima&#x2F;将itcast目录下所有文件复制到itheima目录下</li>
</ul>
<h4 id="拷贝移动命令mv"><a href="#拷贝移动命令mv" class="headerlink" title="拷贝移动命令mv"></a>拷贝移动命令mv</h4><p>作用:为文件或目录改名、或将文件或目录移动到其它位置</p>
<p>语法: mv source dest</p>
<p>举例:</p>
<ul>
<li>mv hello.txt hi.txt<br>将hello.txt改名为hi.txt</li>
<li>mv hi.txt itheima&#x2F;<br>将文件hi.txt移动到itheima目录中</li>
<li>mv hi.txt itheima&#x2F; hello.txt将hi.txt移动到itheima目录中，并改名为hello.txt</li>
<li>mv itcast&#x2F; itheima&#x2F;如果itheima目录不存在，将itcast目录改名为itheima</li>
<li>mv itcast&#x2F; itheima&#x2F;<br>如果itheima目录存在，将itcast目录移动到itheima目录中</li>
</ul>
<h3 id="打包压缩命令tar"><a href="#打包压缩命令tar" class="headerlink" title="打包压缩命令tar"></a>打包压缩命令tar</h3><p>作用:对文件进行打包、解包、压缩、解压</p>
<p>语法: tar [-zcxvf] fileName [files]</p>
<p>包文件后缀为.tar表示只是完成了打包，并没有压缩</p>
<p>包文件后缀为.tar.gz表示打包的同时还进行了压缩</p>
<p>说明:</p>
<ul>
<li>-z∶ z代表的是gzip，通过gzip命令处理文件，gzip可以对文件压缩或者解压</li>
<li>-c: c代表的是create，即创建新的包文件</li>
<li>-x: x代表的是extract，实现从包文件中还原文件</li>
<li>-v: v代表的是verbose，显示命令的执行过程</li>
<li>-f: f代表的是file，用于指定包文件的名称</li>
</ul>
<h3 id="文本编辑命令vi-x2F-vim"><a href="#文本编辑命令vi-x2F-vim" class="headerlink" title="文本编辑命令vi&#x2F;vim"></a>文本编辑命令vi&#x2F;vim</h3><p>作用: vi命令是Linux系统提供的一个文本编辑工具，可以对文件内容进行编辑，类似于Windows中的记事本</p>
<p>语法: vi fileName</p>
<p>说明:</p>
<p>1、 vim是从vi发展来的一个功能更加强大的文本编辑工具，在编辑文件时可以对文本内容进行着色，方便我们对文件进行编辑处理，所以实际工作中vim更加常用。</p>
<p>2、要使用vim命令，需要我们自己完成安装。可以使用该命令来完成安装:yum install vim</p>
<h4 id="文本编辑命令vim"><a href="#文本编辑命令vim" class="headerlink" title="文本编辑命令vim"></a>文本编辑命令vim</h4><p>作用:对文件内容进行编辑，vim其实就是一个文本编辑器</p>
<p>语法:vim fileName</p>
<p>说明:</p>
<p>1、在使用vim命令编辑文件时，如果指定的文件存在则直接打开此文件。如果指定的文件不存在则新建文件。</p>
<p>2、vim在进行文本编辑时共分为三种模式，分别是命令模式(Command mode)，插入模式（Insert mode)和底行模式(Last line mode)。这三种模式之间可以相互切换。我们在使用vim时一定要注意我们当前所处的是哪种模式。</p>
<p>针对vim中的三种模式说明如下:</p>
<p>1、命令模式</p>
<ul>
<li>命令模式下可以查看文件内容、移动光标（上下左右箭头、gg、G)</li>
<li>通过vim命令打开文件后，默认进入命令模式</li>
<li>另外两种模式需要首先进入命令模式，才能进入彼此</li>
</ul>
<p>2、插入模式</p>
<ul>
<li>插入模式下可以对文件内容进行编辑</li>
<li>在命令模式下按下[i,a,o]任意一个，可以进入插入模式。进入插入模式后，下方会出现【insert】字样</li>
<li>在插入模式下按下ESC键，回到命令模式</li>
</ul>
<p>3、底行模式</p>
<ul>
<li>底行模式下可以通过命令对文件内容进行查找、显示行号、退出等操作</li>
<li>在命令模式下按下[:,&#x2F;]任意一个，可以进入底行模式</li>
<li>通过&#x2F;方式进入底行模式后，可以对文件内容进行查找</li>
<li>通过:方式进入底行模式后，可以输入wq（保存并退出）、q!(不保存退出） 、 set nu(显示行号)</li>
</ul>
<h3 id="查找命令"><a href="#查找命令" class="headerlink" title="查找命令"></a>查找命令</h3><h4 id="查找命令find"><a href="#查找命令find" class="headerlink" title="查找命令find"></a>查找命令find</h4><p>作用:在指定目录下查找文件</p>
<p>语法:find dirName -option fileName</p>
<p>举例:</p>
<ul>
<li>find . -name “*.java”<br>在当前目录及其子目录下查找.java结尾文件</li>
<li>find &#x2F;itcast -name “*.java”<br>在&#x2F;itcast目录及其子目录下查找.java结尾的文件</li>
</ul>
<h4 id="查找命令grep"><a href="#查找命令grep" class="headerlink" title="查找命令grep"></a>查找命令grep</h4><p>作用:从指定文件中查找指定的文本内容</p>
<p>语法: grep word fileName</p>
<p>举例:</p>
<ul>
<li>grep Hello Helloworld.java<br>查找Helloworld.java文件中出现的Hello字符串的位置</li>
<li>grep hello *.java<br>查找当前目录中所有.java结尾的文件中包含hello字符串的位置</li>
</ul>
<h2 id="Linux软件安装"><a href="#Linux软件安装" class="headerlink" title="Linux软件安装"></a>Linux软件安装</h2><h3 id="软件安装方式"><a href="#软件安装方式" class="headerlink" title="软件安装方式"></a>软件安装方式</h3><ul>
<li>二进制发布包安装<ul>
<li>软件已经针对具体平台编译打包发布，只要解压，修改配置即可</li>
</ul>
</li>
<li>rpm安装<ul>
<li>软件已经按照redhat的包管理规范进行打包，使用rpm命令进行安装，不能自行解决库依赖问题</li>
</ul>
</li>
<li>yum安装<ul>
<li>一种在线软件安装方式，本质上还是rpm安装，自动下载安装包并安装，安装过程中自动解决库依赖问题</li>
</ul>
</li>
<li>源码编译安装<ul>
<li>软件以源码工程的形式发布，需要自己编译打包</li>
</ul>
</li>
</ul>
<h3 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h3><p>操作步骤:</p>
<p>1、使用FinalShell自带的上传工具将jdk的二进制发布包上传到Linux jdk-8u171-linux-×64.tar.gz</p>
<p>2、解压安装包，命令为tar -zxvf jdk-8u171-linux-x64.tar.gz -C&#x2F;usr&#x2F;local</p>
<p>3、配置环境变量，使用vim命令修改&#x2F;etc&#x2F;profile文件，在文件末尾加入如下配置</p>
<ul>
<li>JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;jdk1.8.0_171</li>
<li>PATH&#x3D;$JAVA_HOME&#x2F;bin :$PATH</li>
</ul>
<p>4、重新加载profile文件，使更改的配置立即生效，命令为source &#x2F;etc&#x2F;profile</p>
<p>5、检查安装是否成功，命令为java -version</p>
<h3 id="安装Tomcat"><a href="#安装Tomcat" class="headerlink" title="安装Tomcat"></a>安装Tomcat</h3><h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤:"></a>操作步骤:</h4><p>1、使用FinalShell自带的上传工具将Tomcat的二进制发布包上传到Linuxapache-tomcat-7.0.57.tar.gz</p>
<p>2、解压安装包，命令为tar -zxvf apache-tomcat-7.0.57.tar.gz -C&#x2F;usr&#x2F;local</p>
<p>3、进入Tomcat的bin目录启动服务，命令为sh startup.sh或者.&#x2F;startup.sh</p>
<h4 id="验证Tomcat启动是否成功，有多种方式"><a href="#验证Tomcat启动是否成功，有多种方式" class="headerlink" title="验证Tomcat启动是否成功，有多种方式:"></a>验证Tomcat启动是否成功，有多种方式:</h4><ul>
<li><p>查看启动日志</p>
<p>more &#x2F;usr&#x2F;local&#x2F;apache-tomcat-7.0.57&#x2F;logs&#x2F;catalina.out</p>
<p>tail -50 &#x2F;usr&#x2F;local&#x2F;apache-tomcat-7.0.57&#x2F;logs&#x2F;catalina.out</p>
</li>
<li><p>查看进程 ps -ef | grep tomcat<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164559036-587234087.png" srcset="/img/loading.gif" lazyload alt="image"></p>
</li>
</ul>
<p><strong>注意:</strong></p>
<ul>
<li>ps命令是linux下非常强大的进程查看命令，通过ps -ef可以查看当前运行的所有进程的详细信息</li>
<li>“|”在Linux中称为管道符，可以将前一个命令的结果输出给后一个命令作为输入</li>
<li>使用ps命令查看进程时，经常配合管道符和查找命令grep一起使用，来查看特定进程</li>
</ul>
<h4 id="防火墙操作"><a href="#防火墙操作" class="headerlink" title="防火墙操作:"></a>防火墙操作:</h4><ul>
<li>查看防火墙状态(systemctl status firewalld、firewall-cmd –state)</li>
<li>暂时关闭防火墙(systemctl stop firewalld)</li>
<li>永久关闭防火墙(systemctl disable firewalld)</li>
<li>开启防火墙(systemctl start firewalld)</li>
<li>开放指定端口(firewall-cmd –zone&#x3D;public –add-port&#x3D;8080&#x2F;tcp –permanent)</li>
<li>关闭指定端口(firewall-cmd –zone&#x3D;public –remove-port&#x3D;8080&#x2F;tcp –permanent)</li>
<li>立即生效(firewall-cmd –reload)</li>
<li>查看开放的端口(firewall-cmd –zone&#x3D;public –list-ports)</li>
</ul>
<p><strong>注意:</strong></p>
<p>1、systemctl是管理Linux中服务的命令，可以对服务进行启动、停止、重启、查看状态等操作</p>
<p>2、firewall-cmd是Linux中专门用于控制防火墙的命令</p>
<p>3、为了保证系统安全，服务器的防火墙不建议关闭</p>
<h4 id="停止Tomcat服务的方式"><a href="#停止Tomcat服务的方式" class="headerlink" title="停止Tomcat服务的方式:"></a>停止Tomcat服务的方式:</h4><ul>
<li><p>运行Tomcat的bin目录中提供的停止服务的脚本文件<code>shutdown.sh</code></p>
<p>sh shutdown.sh</p>
<p>.&#x2F;shutdown.sh</p>
</li>
<li><p>结束Tomcat进程<br>查看Tomcat进程，获得进程id<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164615590-1183764675.png" srcset="/img/loading.gif" lazyload alt="image"><br>执行命令结束进程<strong>kill -9 7742</strong></p>
</li>
</ul>
<p><strong>注意:</strong><br>kill命令是Linux提供的用于结束进程的命令，-9表示强制结束</p>
<h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><p>1、检测当前系统中是否安装MySQL数据库</p>
<ul>
<li>rpm -qa<br>查询当前系统中安装的所有软件</li>
<li>rpm -qa l grep mysql<br>查询当前系统中安装的名称带mysql的软件</li>
<li>rpm -qa l grep mariadb<br>查询当前系统中安装的名称带mariadb的软件<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164632289-1107734166.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<p>RPM（ Red-Hat Package Manager ）RPM软件包管理器，是红帽Linux用于管理和安装软件的工具</p>
<p><strong>注意</strong>：如果当前系统中已经安装有MySQL数据库，安装将失败。CentoS7自带mariadb，与My5QL数据库冲突</p>
<p>2、卸载已经安装的冲突软件</p>
<ul>
<li>rpm -e –nodeps 软件名称 　　　　卸载软件</li>
<li>rpm -e –nodeps mariadb-libs-5.5.60-1.el7_5.x86_64</li>
</ul>
<p>3、将资料中提供的MySQL安装包上传到Linux并解压</p>
<ul>
<li>mkdir &#x2F;usr&#x2F;local&#x2F;mysql</li>
<li>tar -zxvf mysql-5.7.25-1.el7.x86_64.rpm-bundle.tar.gz -C &#x2F;usr&#x2F;local&#x2F;mysql</li>
</ul>
<p>4、按照顺序安装rpm软件包</p>
<ul>
<li><p>rpm -ivh mysql-community-common-5.7.25-1.el7.x86_64.rpm</p>
</li>
<li><p>rpm -ivh mysql-community-libs-5.7.25-1.el7.x86_64.rpm</p>
</li>
<li><p>rpm -ivh mysql-community-devel-5.7.25-1.el7.x86_64.rpm</p>
</li>
<li><p>rpm -ivh mysql-community-libs-compat-5.7.25-1.el7.x86_64.rpm</p>
</li>
<li><p>rpm -ivh mysql-community-client-5.7.25-1.el7.x86_64.rpm</p>
</li>
<li><p>yum install libaio</p>
</li>
<li><p>yum install net-tools</p>
</li>
<li><p>rpm -ivh mysql-community-server-5.7.25-1.el7.x86_64.rpm</p>
<p>说明1:安装过程中提示缺少net-tools依赖，使用yum安装</p>
<p>说明2:可以通过指令升级现有软件及系统内核</p>
</li>
<li><p>yum update</p>
</li>
</ul>
<p>5、启动mysql</p>
<ul>
<li>systemctl status mysqld<br>查看mysql服务状态</li>
<li>systemctl start mysqld<br>启动mysql服务<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164641114-1683153309.png" srcset="/img/loading.gif" lazyload alt="image"></li>
</ul>
<p>说明:可以设置开机时启动mysql服务，避免每次开机启动mysql</p>
<ul>
<li>systemctl enable mysqld<br>开机启动mysql服务</li>
<li>netstat -tunlp<br>查看已经启动的服务</li>
<li>netstat -tunlp | grep mysql</li>
<li>ps -ef | grep mysql<br>查看mysql进程</li>
</ul>
<p>6、登录MySQL数据库，查阅临时密码</p>
<ul>
<li>cat &#x2F;var&#x2F;log&#x2F;mysqld.log<br>查看文件内容</li>
<li>cat &#x2F;var&#x2F;log&#x2F;mysqld.log l grep password<br>查看文件内容中包含password的行信息</li>
</ul>
<p>7、登录MySQL，修改密码，开放访问权限</p>
<ul>
<li>mysql -urpot -p<br>登录mysql（使用临时密码登录)</li>
</ul>
<p>修改密码</p>
<ul>
<li>set global validate_password_length&#x3D;4;<br>设置密码长度最低位数</li>
<li>set global validate_password_policy&#x3D;LOW;<br>设置密码安全等级低，便于密码可以修改成root</li>
<li>set password &#x3D; password(‘root’);<br>设置密码为root</li>
</ul>
<p>开启访问权限</p>
<ul>
<li><p>grant all on <em>.</em> to ‘root‘@’%’ identified by ‘root’;</p>
<p>flush privileges;</p>
</li>
</ul>
<p>8、测试Mysql数据库是否正常工作</p>
<ul>
<li>showdatabase;</li>
</ul>
<h3 id="安装lrzsz"><a href="#安装lrzsz" class="headerlink" title="安装lrzsz"></a>安装lrzsz</h3><p><strong>操作步骤:</strong></p>
<p>1、搜索lrzsz安装包，命令为 <strong>yum list lrzsz</strong></p>
<p>2、使用yum命令在线安装，命令为<strong>yum install lrzsz.x86_64</strong></p>
<p><strong>注意：</strong> Yum(全称为Yellow dog Updater, Modified)是一个在Fedora和RedHat以及CentoS中的Shell前端软件包管理器。基于RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。</p>
<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><h3 id="手工部署项目"><a href="#手工部署项目" class="headerlink" title="手工部署项目"></a>手工部署项目</h3><p>一、在IDEA中开发SpringBoot项目并打成jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>pom文件必须加入上面代码</p>
<p>二、将jar包上传到Linux服务器</p>
<ul>
<li>mkdir &#x2F;usr&#x2F;local&#x2F;app创建目录，将项目jar包放到此目录</li>
</ul>
<p>三、启动Spring程序<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164657090-508266715.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164651066-1125429480.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>四、检查防火墙，确保8080端口对外开放，访问SpringBoot项目</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164701736-1278145242.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>五、改为后台运行SpringBoot程序，并将日志输出到日志文件目前程序运行的问题</p>
<ul>
<li>线上程序不会采用控制台霸屏的形式运行程序，而是将程序在后台运行</li>
<li>线上程序不会将日志输出到控制台，而是输出到日志文件，方便运维查阅信息</li>
</ul>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164708361-1366414462.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>六、停止SpringBoot程序<br><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164714373-1729045522.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h3 id="通过Shell脚本自动部署项目"><a href="#通过Shell脚本自动部署项目" class="headerlink" title="通过Shell脚本自动部署项目"></a>通过Shell脚本自动部署项目</h3><p>操作步骤:</p>
<ul>
<li>1、在Linux中安装Git</li>
<li>2、使用Git克隆代码</li>
<li>3、在Linux中安装maven</li>
<li>4、编写Shell脚本（拉取代码、编译、打包、启动）</li>
<li>5、为用户授予执行Shell脚本的权限</li>
<li>6、执行Shell脚本</li>
</ul>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164722000-1572884584.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="1、在Linux中安装Git"><a href="#1、在Linux中安装Git" class="headerlink" title="1、在Linux中安装Git"></a>1、在Linux中安装Git</h4><ul>
<li>yum list git<br>列出git安装包</li>
<li>yum install git<br>在线安装git</li>
</ul>
<h4 id="2、使用Git克隆代码"><a href="#2、使用Git克隆代码" class="headerlink" title="2、使用Git克隆代码"></a>2、使用Git克隆代码</h4><ul>
<li>cd &#x2F;usr&#x2F;local&#x2F;</li>
<li>git clone <a target="_blank" rel="noopener" href="https://github.com/SummerW1nd/helloworld.git">https://github.com/SummerW1nd/helloworld.git</a></li>
</ul>
<h4 id="3、在Linux中安装maven"><a href="#3、在Linux中安装maven" class="headerlink" title="3、在Linux中安装maven"></a>3、在Linux中安装maven</h4><p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164728977-1234910859.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="4、将资料中提供的Shell脚本文件复制到Linux-bootStart-sh"><a href="#4、将资料中提供的Shell脚本文件复制到Linux-bootStart-sh" class="headerlink" title="4、将资料中提供的Shell脚本文件复制到Linux (bootStart.sh)"></a>4、将资料中提供的Shell脚本文件复制到Linux (bootStart.sh)</h4><ul>
<li>Shell脚本(shell script)，是一种Linux系统中的脚本程序。</li>
<li>使用Shell脚本编程跟JavaScript、Java编程一样，只要有一个能编写代码的文本编辑器和一个能解释执行的脚本解释器就可以了.</li>
<li>对于Shell脚本编写不作为本课程重点内容，直接使用课程资料中提供的脚本文件bootStart.sh即可。</li>
</ul>
<h4 id="五、为用户授权"><a href="#五、为用户授权" class="headerlink" title="五、为用户授权"></a>五、为用户授权</h4><p>chmod（英文全拼: change mode）命令是控制用户对文件的权限的命令</p>
<p>Linux中的权限分为:读(r)、写(w)、执行(x)三种权限</p>
<p>Linux的文件调用权限分为三级︰文件所有者（Owner)、用户组（Group)、其它用户(Other Users)</p>
<p>只有文件的所有者和超级用户可以修改文件或目录的权限</p>
<p>要执行Shell脚本需要有对此脚本文件的执行权限，如果没有则不能执行</p>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164739518-66571149.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>chmod命令可以使用八进制数来指定权限</p>
<p><strong>举例</strong>:</p>
<ul>
<li>chmod 777 bootStart.sh为所有用户授予读、写、执行权限</li>
<li>chmod 755 bootStart.sh为文件拥有者授予读、写、执行权限，同组用户和其他用户授予读、执行权限</li>
<li>chmod 210 bootstart.sh为文件拥有者授予写权限，同组用户授予执行权限，其他用户没有任何权限</li>
</ul>
<p><strong>注意</strong>:三位数字分别代表不同用户的权限</p>
<ul>
<li>第1位表示文件拥有者的权限</li>
<li>第2位表示同组用户的权限</li>
<li>第3位表示其他用户的权限</li>
</ul>
<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164747415-1856910097.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h4 id="设置静态ip"><a href="#设置静态ip" class="headerlink" title="设置静态ip"></a>设置静态ip</h4><p>修改文件&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33，内容如下:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">TYPE</span>=<span class="hljs-string">&quot;Ethernet&quot;</span><br><span class="hljs-attr">PROXY_METHOD</span>=<span class="hljs-string">&quot;none&quot;</span><br><span class="hljs-attr">BROWSER_ONLY</span>=<span class="hljs-string">&quot;no&quot;</span><br><span class="hljs-attr">BOOTPROTO</span>=<span class="hljs-string">&quot;static&quot;</span><span class="hljs-comment">#使用静态IP地址，默认为dhcp</span><br><span class="hljs-attr">IPADDR</span>=<span class="hljs-string">&quot;192.168.138.100&quot;</span><span class="hljs-comment">#设置的静态IP地址</span><br><span class="hljs-attr">NETMASK</span>=<span class="hljs-string">&quot;255.255.255.0&quot;</span><span class="hljs-comment">#子网掩码</span><br><span class="hljs-attr">GATEWAY</span>=<span class="hljs-string">&quot;192.168.138.2&quot;</span><span class="hljs-comment">#网关地址</span><br><span class="hljs-attr">DNS1</span>=<span class="hljs-string">&quot;192.168.138. 2&quot;</span><span class="hljs-comment">#DNS服务器</span><br><span class="hljs-attr">DEFROUTE</span>=<span class="hljs-string">&quot;yes&quot;</span><br><span class="hljs-attr">IPV4_FAILURE_FATAL</span>=<span class="hljs-string">&quot;no&quot;</span><br><span class="hljs-attr">IPV6INIT</span>=<span class="hljs-string">&quot;yes &quot;</span><br><span class="hljs-attr">IPV6_AUTOCONF</span>=<span class="hljs-string">&quot;yes&quot;</span><br><span class="hljs-attr">IPV6_DEFROUTE</span>=<span class="hljs-string">&quot;yes&quot;</span><br><span class="hljs-attr">IPV6_FAILURE_FATAL</span>=<span class="hljs-string">&quot;no&quot;</span><br><span class="hljs-attr">IPV6_ADDR_GEN_MODE</span>=<span class="hljs-string">&quot;stable-privacy&quot;</span><br><span class="hljs-attr">NAME</span>=<span class="hljs-string">&quot;ens33&quot;</span><br><span class="hljs-attr">UUID</span>=<span class="hljs-string">&quot;95b614cd-79b0-4755-be8d-99f1cca7271b&quot;</span><br><span class="hljs-attr">DEVICE</span>=<span class="hljs-string">&quot;ens33&quot;</span><br><span class="hljs-attr">ONBOOT</span>=<span class="hljs-string">&quot;yes&quot;</span><span class="hljs-comment">#是否开机启用</span><br></code></pre></td></tr></table></figure>

<p><img src="https://typora011.oss-cn-guangzhou.aliyuncs.com/2592691-20220522164757410-1051230850.png" srcset="/img/loading.gif" lazyload alt="image"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E9%BA%A6%E5%90%89%E9%A1%B9%E7%9B%AE/">#麦吉项目</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>麦吉外卖笔记day01-03</div>
      <div>http://example.com/2022/08/03/瑞吉外卖开发笔记 day1-3/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>flowersea</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年8月3日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/10/README/" title="">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/07/26/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/" title="Springboot原理篇">
                        <span class="hidden-mobile">Springboot原理篇</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"uJ813FraAgdWfO9A0C4tCk8w-gzGzoHsz","appKey":"tGt6nPWqmrHkVie023eG0wbU","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
